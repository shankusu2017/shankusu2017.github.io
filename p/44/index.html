<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
	<meta name="generator" content="Hugo 0.147.3">
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Golang入门指南 - Golang入门指南</title>
    <meta name="keywords" content="Golang,golang,go,git,Git,Lua,lua">
    
    <meta property="og:title" content="Golang入门指南">
    <meta property="og:site_name" content="Golang入门指南">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Golang入门指南 - Golang入门指南" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: false, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang入门指南</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/todo/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />todo
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />思考
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/life/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />life
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/food/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />food
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ebpf/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />ebpf
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/p4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />p4
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/dns/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />DNS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/distributed/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />distributed
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/finance/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />投资
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/ftp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />FTP
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
    
 <section id="posts" class="posts-expand">

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B6-%E9%97%B4%E6%8E%A5%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/" itemprop="url">
        Wasm介绍之6: 间接函数调用
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-29">
    2021-10-29
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/wasm" itemprop="url" rel="index">
        <span itemprop="name">wasm</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">2405 字 ~5分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/3/12/170ccd25b6a16402~tplv-t2oaga2asx-zoom-crop-mark:1304:1304:1304:734.awebp" alt="img"></p>
<h1 id="-wasm介绍之6间接函数调用"># Wasm介绍之6：间接函数调用</h1>
<p>在前面的5篇文章里，我们详细讨论了<a href="https%3A%2F%2Fwebassembly.org%2F">WebAssembly</a>（简称Wasm）<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Findex.html">二进制格式</a>和除<code>call_indirect</code>之外的所有指令。这篇文章将详细介绍Wasm间接函数调用机制和<code>call_indirect</code>指令。</p>
<h2 id="call_indirect指令">call_indirect指令</h2>
<p>为了更好的理解<code>call_indirect</code>指令，我们首先来回顾一下<code>call</code>指令的工作方式。根据之前文章的介绍 可知，<code>call</code>指令带有一个立即数参数，指定被调用函数的索引。在Wasm实现执行<code>call</code>指令之前，必须保证要传递给被调用函数的参数已经在栈顶，且参数的顺序和类型必须完全匹配被调函数的签名。<code>call</code>指令执行完毕之后，参数已经从栈顶弹出，函数的返回值（如果有的话）会出现在栈顶。我们假设被调用函数接收两个参数，类型分别是<code>f32</code>和<code>f64</code>，返回值类型是<code>i64</code>，下面是<code>call</code>指令的示意图：</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B6-%E9%97%B4%E6%8E%A5%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B5%E6%8E%A7%E5%88%B6%E6%8C%87%E4%BB%A4/" itemprop="url">
        Wasm介绍之5：控制指令
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-29">
    2021-10-29
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/wasm" itemprop="url" rel="index">
        <span itemprop="name">wasm</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">2760 字 ~6分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://juejin.cn/post/6844904082071617544">原文链接</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/3/5/170a96e59f4522e8~tplv-t2oaga2asx-zoom-crop-mark:1304:1304:1304:734.awebp" alt="img"></p>
<h1 id="-wasm介绍之5控制指令"># Wasm介绍之5：控制指令</h1>
<p>[WebAssembly]https%3A%2F%2Fwebassembly.org%2F)（简称Wasm）<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Finstructions.html%23control-instructions">控制指令</a>一共有11条，其中<code>unreachable</code>指令（操作码<code>0x00</code>）和<code>nop</code>指令（操作码<code>0x01</code>）比较简单，不介绍。<code>call</code>指令（操作码<code>0x10</code>）已经在上一篇文章里介绍，<code>call_indirect</code>指令（操作码<code>0x11</code>）将在下一篇文章里介绍。本文重点讨论<code>block</code>（操作码<code>0x02</code>）、<code>loop</code>（操作码<code>0x03</code>）、<code>if</code>（操作码<code>0x04</code>）、<code>br</code>（操作码<code>0x0C</code>）、<code>br_if</code>（操作码<code>0x0D</code>）、<code>br_table</code>（操作码<code>0x0E</code>）和<code>return</code>（操作码<code>0x0F</code>）这7条指令。</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B5%E6%8E%A7%E5%88%B6%E6%8C%87%E4%BB%A4/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B4%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/" itemprop="url">
        Wasm介绍之4：函数调用
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-29">
    2021-10-29
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/wasm" itemprop="url" rel="index">
        <span itemprop="name">wasm</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">1828 字 ~4分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://juejin.cn/post/6844904077411745800">原文链接</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/28/1708b4c47191d9b5~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<p>上一篇文章介绍了<a href="https%3A%2F%2Fwebassembly.org%2F">WebAssembly</a>（简称Wasm）内存和相关指令，这篇文章将介绍<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Finstructions.html%23variable-instructions">变量指令</a>和函数调用指令。</p>
<h2 id="全局变量">全局变量</h2>
<p>Wasm<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fsyntax%2Fmodules.html">模块</a>可以<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fsyntax%2Fmodules.html%23globals">定义</a>或者<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fsyntax%2Fmodules.html%23imports">导入</a>全局变量。导入时，可以限定全局变量的类型和可修改性（mutability）。定义时，除了限定类型和可修改性还可以给定初始值。下面是一个<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Ftext%2Fconventions.html">WAT</a>例子，展示了全局变量的导入和定义：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>(module
</span></span><span style="display:flex;"><span>  (import <span style="color:#009c00">&#34;env&#34;</span> <span style="color:#009c00">&#34;g1&#34;</span> (global $g1 i32))       ;; immutable
</span></span><span style="display:flex;"><span>  (import <span style="color:#009c00">&#34;env&#34;</span> <span style="color:#009c00">&#34;g2&#34;</span> (global $g2 (mut f32))) ;; mutable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (global $g3 (mut i32) (i32.<span style="color:#00f">const</span> 123)) ;; mutable
</span></span><span style="display:flex;"><span>  (global $g4 (mut i64) (i64.<span style="color:#00f">const</span> 456)) ;; mutable
</span></span><span style="display:flex;"><span>  (global $g5 f32 (f32.<span style="color:#00f">const</span> 1.5))       ;; immutable
</span></span><span style="display:flex;"><span>  (global $g6 f64 (f64.<span style="color:#00f">const</span> 2.5))       ;; immutable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">func</span> $main
</span></span><span style="display:flex;"><span>    ;; $g3 = $g1
</span></span><span style="display:flex;"><span>    (global.get $g1)
</span></span><span style="display:flex;"><span>    (global.set $g3)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>复制代码
</span></span></code></pre></div><p>变量指令一共5条，其中2条用来读写全局变量，下面分别介绍。</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B4%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B3%E5%86%85%E5%AD%98/" itemprop="url">
        Wasm介绍之3：内存
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-29">
    2021-10-29
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/wasm" itemprop="url" rel="index">
        <span itemprop="name">wasm</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">1923 字 ~4分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://juejin.cn/post/6844904069186715656">原文链接</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/21/17066003f2cbfc43~tplv-t2oaga2asx-watermark.awebp" alt="1.jpg"></p>
<p>上一篇文章介绍了<a href="target=https%3A%2F%2Fwebassembly.org%2F">WebAssembly</a>（简称Wasm）<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fsyntax%2Finstructions.html">指令集</a>以及指令的操作码（Opcode）、立即数（Immediate Arguments）、操作数（Operands）、操作数栈（Operand Stack，简称栈）等概念，并且详细介绍了<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Finstructions.html%23parametric-instructions">参数指令</a>和<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Finstructions.html%23numeric-instructions">数值指令</a>。这篇文章将介绍Wasm内存和相关指令。</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B3%E5%86%85%E5%AD%98/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B2%E6%8C%87%E4%BB%A4%E9%9B%86%E5%92%8C%E6%A0%88/" itemprop="url">
        Wasm介绍之2：指令集和栈
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-29">
    2021-10-29
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/wasm" itemprop="url" rel="index">
        <span itemprop="name">wasm</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">2990 字 ~6分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://juejin.cn/post/6844904065411842056">原文链接</a></p>
<p>上一篇文章介绍了<a href="https%3A%2F%2Fwebassembly.org%2F">WebAssembly</a>（后文简称Wasm）<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Findex.html">二进制格式</a>，这一篇文章将介绍Wasm<a href="https%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fsyntax%2Finstructions.html">指令集</a>、操作数栈和部分指令。</p>
<h2 id="wasm指令集">Wasm指令集</h2>
<p>和真实的<a href="https://link.juejin.cn/?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FMachine_code">机器码</a>一样，Wasm二进制文件中的代码也由一条一条的<strong>指令</strong>构成。同样，Wasm指令也包含两部分信息：<strong>操作码</strong>（Opcode）和<strong>操作数</strong> （Operands）。Wasm操作码固定为一个字节，因此最多能表示256条指令，这一点和<a href="https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FJava_bytecode">Java字节码</a>一样。Wasm1.0规范一共定义了172条指令，这些指令按功能可以分为5大类，分别是：</p>
<ul>
<li><strong>控制指令</strong>（Control Instructions），共13条。</li>
<li><strong>参数指令</strong>（Parametric Instructions），共2条。</li>
<li><strong>变量指令</strong>（Variable Instructions），共5条。</li>
<li><strong>内存指令</strong>（Memory Instructions），共25条。</li>
<li><strong>数值指令</strong>（Numeric Instructions），共127条。</li>
</ul>
<p>可以看到，已经定义的指令中，有超过2/3属于数值指令。为了方便人类书写和理解，Wasm规范给也给每个操作码定义了<strong>助记符</strong>（<a href="https://link.juejin.cn/?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FAssembly_language%23Opcode_mnemonics_and_extended_mnemonics">Mnemonic</a>），比如说操作码<code>0x41</code>的助记符是<code>i32.const</code>。下面是已定义指令的操作码分布示意图：</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B2%E6%8C%87%E4%BB%A4%E9%9B%86%E5%92%8C%E6%A0%88/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B1%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%A0%BC%E5%BC%8F/" itemprop="url">
        Wasm介绍之1：二进制格式
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-29">
    2021-10-29
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/wasm" itemprop="url" rel="index">
        <span itemprop="name">wasm</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">5320 字 ~11分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://juejin.cn/post/6844904062148689933">原文链接</a></p>
<p>关于<a href="https%3A%2F%2Fwebassembly.org%2F">WebAssembly</a>（下文简称Wasm）的介绍已经有很多了，本文不打算再多啰嗦。本文介绍的重点是Wasm<a href="https://link.juejin.cn/?target=https%3A%2F%2Flinks.jianshu.com%2Fgo%3Fto%3Dhttps%3A%2F%2Fwebassembly.github.io%2Fspec%2Fcore%2Fbinary%2Findex.html">二进制格式</a>，我们会把一个最简单的<a href="https://link.juejin.cn/?target=https%3A%2F%2Flinks.jianshu.com%2Fgo%3Fto%3Dhttps%3A%2F%2Fwww.rust-lang.org%2F">Rust</a>程序（没错，就是<code>Hello，World！</code>程序）编译成Wasm二进制格式，然后以Go伪代码结合<code>xxd</code>命令的形式来剖析Wasm二进制格式 。下面是这个Rust程序的完整代码（如果不了解如何将Rust编译成Wasm，请看<a href="https%3A%2F%2Fdev.to%2Fdandyvica%2Fwasm-in-rust-without-nodejs-2e0c">这篇文章</a>）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#![no_std]</span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#![no_main]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">extern</span> <span style="color:#009c00">&#34;C&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">fn</span> <span style="color:#c34e00">print_str</span>(ptr: *<span style="color:#00f">const</span> <span style="color:#00f">u8</span>, len: <span style="color:#00f">usize</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#[panic_handler]</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">fn</span> <span style="color:#c34e00">panic</span>(_info: <span style="color:#00f">&amp;</span><span style="color:#007575">core</span>::panic::PanicInfo) -&gt; ! {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">loop</span> {}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#[no_mangle]</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">pub</span> <span style="color:#00f">extern</span> <span style="color:#009c00">&#34;C&#34;</span> <span style="color:#00f">fn</span> <span style="color:#c34e00">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">unsafe</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">let</span> s = <span style="color:#009c00">&#34;Hello, World!</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>;
</span></span><span style="display:flex;"><span>        print_str(s.as_ptr(), s.len());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="module">Module</h2>
<p>Wasm的顶层结构是<strong>模块</strong>（Module），每一个Wasm二进制文件对应一个模块。模块以4字节<a href="https://link.juejin.cn/?target=https%3A%2F%2Flinks.jianshu.com%2Fgo%3Fto%3Dhttps%3A%2F%2Fen.wikipedia.org%2Fwiki%2FMagic_number_%28programming%29">魔数</a>开始，接着是4字节版本号，其余是模块的数据。具体的模块数据被分门别类的放在不同的<strong>段</strong>（Section）中，每个段都由唯一的段ID来标识。除了<strong>自定义段</strong>（后文会介绍）以外，其他所有的段都最多只能出现一次，且必须按照段ID递增的顺序出现。下面的<strong>伪代码</strong>（采用Go语言语法，下同）给出了模块的整体结构：</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/29/wasm%E4%BB%8B%E7%BB%8D%E4%B9%8B1%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%A0%BC%E5%BC%8F/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/28/ffi/" itemprop="url">
        FFI
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-28">
    2021-10-28
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/nginx" itemprop="url" rel="index">
        <span itemprop="name">nginx</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">4133 字 ~9分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://moonbingbing.gitbooks.io/openresty-best-practices/content/lua/FFI.html">原文链接</a></p>
<p>FFI 库，是 LuaJIT 中最重要的一个扩展库。它允许从纯 Lua 代码调用外部 C 函数，使用 C 数据结构。有了它，就不用再像 Lua 标准 <code>math</code> 库一样，编写 Lua 扩展库。把开发者从开发 Lua 扩展 C 库（语言/功能绑定库）的繁重工作中释放出来。学习完本小节对开发纯 <code>ffi</code> 的库是有帮助的，像 <a href="https://github.com/openresty/lua-resty-lrucache">lru-resty-lrucache</a> 中的 <code>pureffi.lua</code>，这个纯 <code>ffi</code> 库非常高效地完成了 lru 缓存策略。</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/28/ffi/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/10/28/linux-ucontext%E6%97%8F%E5%87%BD%E6%95%B0%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/" itemprop="url">
        linux ucontext族函数的原理及使用
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-10-28">
    2021-10-28
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/c" itemprop="url" rel="index">
        <span itemprop="name">c</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">3415 字 ~7分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://blog.csdn.net/qq_44443986/article/details/117739157">原文链接</a></p>
<h1 id="ucontext函数族">ucontext函数族</h1>
<p>这里的context族是偏向底层的，其实底层就是通过汇编来实现的，但是我们使用的时候就和平常使用变量和函数一样使用就行，因为大佬们已经将它们封装成C库里了的</p>
    </div>
    
    <div class="post-more-link text-center">
    <a class="btn" href="http://shanks.link/blog/2021/10/28/linux-ucontext%E6%97%8F%E5%87%BD%E6%95%B0%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/" rel="contents">
      阅读全文 &raquo;
    </a>
    </div>
    
    <footer class="post-footer"><div class="post-eof"></div></footer>
  </article>

</section>
















<nav class="pagination">
    <a class="extend prev" rel="prev" href="http://shanks.link/p/43/"><i class="fa fa-angle-left"></i></a>
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/40/">40</a>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/41/">41</a>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/42/">42</a>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/43/">43</a>
        
        
    
        
        
          <span class="page-number current">44</span>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/45/">45</a>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/46/">46</a>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/47/">47</a>
        
        
    
        
        
          <a class="page-number" href="http://shanks.link/p/48/">48</a>
        
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    <a class="extend next" rel="next" href="http://shanks.link/p/45/"><i class="fa fa-angle-right"></i></a>
</nav>




          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="" />
    <p class="site-author-name" itemprop="name"></p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
        <a href="http://shanks.link/post/">
            <span class="site-state-item-name">日志</span>
        </a>
    </div>
    <div class="site-state-item site-state-categories">
        <a href="http://shanks.link/categories/">
            <span class="site-state-item-name">分类</span>
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
            <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>

      
<div class="feed-link motion-element">
<a href="http://shanks.link/index.xml" rel="alternate" type="application/rss+xml" target="_blank">
    <i class="fa fa-rss"></i>
    RSS 订阅
</a>
</div>

      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2025</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" id="motion.page.archive">
  $('.archive-year').velocity('transition.slideLeftIn');
</script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>