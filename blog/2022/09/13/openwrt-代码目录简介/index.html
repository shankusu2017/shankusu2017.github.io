<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>OpenWrt 代码目录简介 - Golang编程语言知识介绍</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="OpenWrt 代码目录简介">
    <meta property="og:site_name" content="Golang编程语言知识介绍">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="OpenWrt 代码目录简介 - Golang编程语言知识介绍" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang编程语言知识介绍</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ebpf/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />ebpf
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/p4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />p4
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/dns/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />DNS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/ftp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />FTP
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2022/09/13/openwrt-%E4%BB%A3%E7%A0%81%E7%9B%AE%E5%BD%95%E7%AE%80%E4%BB%8B/" itemprop="url">
        OpenWrt 代码目录简介
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2022-09-13">
    2022-09-13
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/openwrt" itemprop="url" rel="index">
        <span itemprop="name">OpenWrt</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">9164 字 ~19分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <h2 id="顶层目录">顶层目录</h2>
<p><img src="https://img-blog.csdnimg.cn/20191011223104301.png" alt="img"></p>
<table>
<thead>
<tr>
<th><strong>目 录</strong></th>
<th><strong>含 义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>config</strong></td>
<td>编译选项配置文件，包含全局编译设置、开发人员编译设置、目标文件格式设置和内核 编译设置等 4 部分</td>
</tr>
<tr>
<td><strong>include</strong></td>
<td>包含准备环境脚本、下载补丁脚本、编译 Makefile 以及编译指令等</td>
</tr>
<tr>
<td><strong>package</strong></td>
<td>各种功能的软件包，软件包仅包含 Makefile 和修改补丁及配置文件。其中 Makefile 包含 源代码真正的地址及 MD5 值。OpenWrt 社区的修改代码以补丁包形式管理，package 只 保存一些常用的软件包</td>
</tr>
<tr>
<td><strong>scripts</strong></td>
<td>包含准备环境脚本、下载补丁脚本、编译 Makefile 以及编译指令等</td>
</tr>
<tr>
<td><strong>target</strong></td>
<td>指的是嵌入式平台，包括特定嵌入式平台的内容</td>
</tr>
<tr>
<td><strong>toolchain</strong></td>
<td>编译器和C库等（交叉编译工具），例如包含编译工具gcc和glibc库</td>
</tr>
<tr>
<td><strong>tools</strong></td>
<td>通用命令/工具，用来生成固件的辅助工具，如打补丁工具patch、编译工具make及squashfs等</td>
</tr>
</tbody>
</table>
<h2 id="config目录">config目录</h2>
<ul>
<li>目录下存放的是编译配置文件，是 OpenWrt 15.05 的新增目录，是将一些编译选项配置文件放在此处，包含全局编译设置、开发人员编译设置、目标文件格式设置和内核编译设置等4部分。</li>
<li>编译源码时，输入 make defconfig 命令，这个目录下的配置文件会被集中读取并生成一个 .config 配置文件，该文件在下面会介绍。</li>
</ul>
<h3 id="包含文件">包含文件</h3>
<p><img src="https://img-blog.csdnimg.cn/20191011222922127.png" alt="img"></p>
<ul>
<li>Config-build.in：最基本的配置文件（全局编译）。</li>
<li>Config-devel.in：用于开发的编译配置文件。</li>
<li>Config-images.in：目标文件格式设置（生成某种镜像的配置文件）。</li>
<li>Config-kernel.in：关于内核编译的配置文件。</li>
</ul>
<h3 id="in配置文件的内容与格式">in配置文件的内容与格式</h3>
<ul>
<li>下面我们以“Config-build.in”格式为例。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011223235807.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>**menu：**我们在目录下输入“make menuconfig”之后显示的主菜单项，例如上面我们的menu为“Global build settings”，在主菜单项中可以看到一个选项为“Global build settings”的内容。（备注：menu以endmenu结尾）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011205111342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>**config：**config下的bool的内容为我们回车进入某一个菜单项之中显示的子项。但是如果一个config的上一级没有menu项，那么config下的bool内容直接显示在主菜单项中（例如下面的&quot;Advanced configuration options (for developers)&ldquo;项上一级不是enu，那么其直接显示在主菜单中）。
<img src="https://img-blog.csdnimg.cn/20191011210050246.png" alt="img"></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011210121313.png" alt="img"></p>
<ul>
<li>**default：**代表默认值，如果为y代表是默认选择的，如果为n代表默认不选择。</li>
<li>**help：**这个选项的帮助解释说明。</li>
<li>例如下面我们有一个&quot;Compile with support for patented functionality&quot;子选项，其default为y，所以前面有“*”号为默认选择。当我们在下面选择“help”然后回车，可以看到此子选项的注释。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011205446812.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191011205452998.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191011205643585.png" alt="img"><img src="https://img-blog.csdnimg.cn/20191011205653660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="增加自定义模块">增加自定义模块</h3>
<ul>
<li>根据.in文件的格式，我们也可以自己设置菜单项和内容，然后在编译时使用。</li>
<li>例如：下面我们在target/Config-buidl.in配置文件中加上下面内容（一个“TEST”主选项，一个“This is my test”子选项，子选项默认值为“y”，帮助内容为“dongshao CSDN url: <a href="https://me.csdn.net/qq_41453285">https://me.csdn.net/qq_41453285</a>”）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013102133774.png" alt="img"></p>
<ul>
<li>接着来到来到顶级目录下，输入“make menuconfig”进入配置工具选项菜单，可以看到我们修改的内容。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013103639167.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/2019101310332770.png" alt="img"></p>
<ul>
<li>进入“TEST”选项。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019101310333289.png" alt="img"></p>
<ul>
<li>选择下方的Help查看帮助信息。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013103343671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="include目录">include目录</h2>
<ul>
<li>保存各种makefile文件：</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011222954285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="mk脚本在编译时的作用">.mk脚本在编译时的作用</h3>
<ul>
<li>在顶层目录下有一个“Makefile”脚本，当我们在编译源码时，输入make命令，“Makefile”脚本被执行，紧接着.mk脚本会被顶级目录下的Makefile调用，然后这些.mk脚本会解析“.config”文件（.config文件下面有介绍），并且根据“.config”文件的内容来编译相关内容（例如下载、编译安装packages目录下的第三方软件等）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011223353442.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/2019101122341072.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191011223046188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="package目录">package目录</h2>
<ul>
<li>存放各种必要的软件包，可以供二次开放使用。</li>
<li>当我们在顶级目录下输入“./script/feeds update -a、./script/feeds install -a”命令时更新和下载的就是这个目录下的软件。</li>
<li>**特性：**我们可以根据自己的需求，在这个目录下新建目录（根据软件类型存放在对应的目录下），然后编写程序和Makefile脚本，这样就可以编译生成自己想要的软件了。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011222943488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="目录结构">目录结构</h3>
<ul>
<li>目录结构分为：<strong>功能目录&ndash;&gt;软件目录</strong>。例如下面以“devel”这个功能模块为例，其目录下有“gdb、perf、strace”这些软件。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011213918159.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191011213926613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="makefile脚本">Makefile脚本</h3>
<ul>
<li>在每一个软件的目录下，都有一个Makefile文件。这个Makefile脚本会在编译源码时被执行（何时执行？include目录下的.mk脚本执行时，.mk脚本解析.config脚本，.config脚本中记录着软件的名称以及是否要安装“y/n”，如果某个软件选项为“y”，那么软件的Makefile脚本会被执行，于是这个软件就会被下载安装；如果为“n”，那么就不会被安装）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011214020319.png" alt="img"></p>
<ul>
<li>小面我们以gdb这个软件为例，其目录下有一个Makefile文件，Makefile内有软件的名称、软件版本、要下载的包文件名、下载的软件的名称、软件包的HASH算法，软件的名称下载地址。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011215829484.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191011215907522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="scripts目录">scripts目录</h2>
<ul>
<li>目录scripts为编译工具脚本文件。</li>
</ul>
<h3 id="一些比较重要的脚本及功能">一些比较重要的脚本及功能</h3>
<ul>
<li>例如patch-kernel.sh封装了patch命令，在编译时，首先将 patches 目录下的所有补丁文件打上，并且判断如果打补丁失败将退出编译过程。</li>
<li>download.pl 为下载源代码的工具脚本，封装下载工具 wget 的选项以及设置从哪里下载。</li>
<li>简述如下：
<table>
<thead>
<tr>
<th><strong>脚 本 文 件</strong></th>
<th><strong>含 义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>scripts/download.pl</strong></td>
<td>下载编译软件包源代码</td>
</tr>
<tr>
<td><strong>scripts/patch-kernel.sh</strong></td>
<td>打补丁脚本，并且判断如果打补丁失败将退出编译过程</td>
</tr>
<tr>
<td><strong>scripts/feeds</strong></td>
<td>收集扩展软件包的工具，用于下载和安装编译扩展软件包工具</td>
</tr>
<tr>
<td><strong>scripts/diffconfig.sh</strong></td>
<td>收集和默认配置不同之处的工具</td>
</tr>
<tr>
<td><strong>scripts/kconfig.pl</strong></td>
<td>处理内核配置</td>
</tr>
<tr>
<td><strong>scripts/deptest.sh</strong></td>
<td>自动 OpenWrt 的软件包依赖项检查</td>
</tr>
<tr>
<td><strong>scripts/metadata.pl</strong></td>
<td>检查 metadata</td>
</tr>
<tr>
<td><strong>scritps/rstrp.sh</strong></td>
<td>丢弃目标文件中的符号，这样就将执行文件和动态库变小</td>
</tr>
<tr>
<td><strong>scripts/timestamp.pl</strong></td>
<td>生成文件的时间戳</td>
</tr>
<tr>
<td><strong>scripts/ipkg-make-index.sh</strong></td>
<td>生成软件包的 ipkg 索引，在使用 opkg 安装软件时使用</td>
</tr>
<tr>
<td><strong>scripts/ext-toolchain.sh</strong></td>
<td>工具链</td>
</tr>
<tr>
<td><strong>scripts/strip-kmod.sh</strong></td>
<td>删除内核模块的符号信息，使文件变小</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="target目录">target目录</h3>
<ul>
<li>存放用于编译各类平台使用的二进制文件，定义了各类平台编译固件和内核的具体过程。</li>
<li>是指目标嵌入式设备，针对不同的平台有不同的特性代码。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019101122071939.png" alt="img"></p>
<ul>
<li>例如下面的“target/linux”目录是对Linux系统的划分，目录下包括Linux系统针对于各种平台标准内核的不订及特殊配置（如ar7、arm系统）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011220727343.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="toolstoolchain目录">tools、toolchain目录</h2>
<h3 id="tools目录">tools目录</h3>
<ul>
<li>是一些通用命令/工具，用来生成固件的辅助工具，如打补丁工具patch、编译工具make及squashfs等。</li>
<li>与package目录结构类似，每个工具占一个目录，工具目录下都有该工具下载所对应的Makefile。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011220742532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191011220747123.png" alt="img"></p>
<h3 id="toolchain目录">toolchain目录</h3>
<ul>
<li>与tools差不多，也是一些工具，编译器和C库等（交叉编译工具），例如包含编译工具gcc和glibc库，在嵌入式交叉编译时有用。</li>
<li>与package目录结构类似，每个工具占一个目录，工具目录下都有该工具下载所对应的Makefile。</li>
</ul>
<h2 id="顶级目录makefile">顶级目录Makefile</h2>
<p><img src="https://img-blog.csdnimg.cn/20191015230410193.png" alt="img"></p>
<ul>
<li>进行编译的总体工作。</li>
<li>自己开发时，这个Makefile不需要改动，因此这个Makefile对我们也不重要，只需要大致了解一下即可。</li>
</ul>
<h3 id="makefile的world目标">Makefile的world目标</h3>
<ul>
<li>执行make时，如果不指定任何目标，因为world目标处于第一位，所以默认执行world。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191015230640648.png" alt="img"></p>
<ul>
<li>在make时不指定OPENWRT_BUILD参数时，进入ifneq语句，如果编译时make OPENWRT_BUILD=1则进入else。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191015231318818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>进入ifneq语句：
<ul>
<li>重写OPENWRT_BUILD变量并export导出OPENWRT_BUILD变量。</li>
<li>包含仅顶级目录下include目录下的debug.mk、depends.mk、toplevel.mk。</li>
<li>debug.mk：在编译过程中各类信息的输出 （V=s参数用到）。</li>
<li>depends.m：检查当前系统在编译内核阶段所有需要依赖的包是否安装。</li>
<li>toplevel.mk：解析编译world目标的规则。</li>
</ul>
</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191015231409773.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>**toplevel.mk：**主要为了生成下面两个目标（prereq和world），在toplevel.mk180行开始。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">prereq:: prepare-tmpinfo .config

	@make -r -s tmp/.prereq-build 

	@make V=ss -r -s 

prereq %:

	@make V=ss -r -s

	@make -w -r world 
</code></pre></div><h3 id="makefile其他目标">Makefile其他目标</h3>
<ul>
<li>“make clean”：删除编译目录。</li>
<li>“make dirclean”：除了删除编译目录之外还删除编译工具目录。</li>
<li>“make printdb”：输出所有的编译变量定义。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191015232000178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="feedsconfdefaultfeedsconf文件">feeds.conf.default、feeds.conf文件</h2>
<p><img src="https://img-blog.csdnimg.cn/20191015232219509.png" alt="img"></p>
<ul>
<li>这两个是我们自己添加进去的文件。</li>
<li>script/feeds脚本文件会调用这两个配置文件，配置文件中定义了大量第三方软件包的下载地址（使用了国内的镜像源，下载速度更快），下图是script/feeds脚本文件，可以看到其调用了这两个配置文件。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016141345115.png" alt="img"></p>
<h4 id="配置文件支持的语法">配置文件支持的语法：</h4>
<ul>
<li>src-git：通过git的方式从后面的链接进行下载。</li>
<li>src-cpy：通过path进行拷贝 (通过U盘更新等)。</li>
<li>src-bzr：通过bzr的方式从后面的链接进行下载 。</li>
<li>src-link：创建一个数据源path的symlink。</li>
<li>src-svn：通过svn的方式从后面的链接进行下载。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-crystal" data-lang="crystal">演示案例



src-git telephony <span style="color:#009c00">https</span>:<span style="color:#009c00">//</span>git.lede-project.org/feed/telephony.git^ac6415e61f147a6892fd2785337aec93ddc68fa9
</code></pre></div><h2 id="编译时创建的临时目录">编译时创建的临时目录</h2>
<ul>
<li>编译工具链、目标平台的软件包等需要下载的文件都放在dl目录下。目标平台和软件包两部分都需要“build_dir/”作为编译的临时目录，并且会将目录 staging_dir作为编译的临时安装目录，最终的生成文件保存在目录bin下。</li>
</ul>
<table>
<thead>
<tr>
<th><strong>目 录</strong></th>
<th><strong>含 义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>dl</strong></td>
<td>下载软件代码包临时目录。编译前，将原始的软件代码包下载到该目录</td>
</tr>
<tr>
<td><strong>feeds</strong></td>
<td>扩展软件包目录。将一些不常用的软件包放在其他代码库中，通过feed机制可以自定义下载及配置</td>
</tr>
<tr>
<td><strong>bin</strong></td>
<td>编译完成后的最终成果目录。例如安装映像文件及 ipk 安装包</td>
</tr>
<tr>
<td><strong>build_dir</strong></td>
<td>编译中间文件目录。例如生成的.o 文件</td>
</tr>
<tr>
<td><strong>staging_dir</strong></td>
<td>编译安装目录。文件安装到这里，并由这里的文件生成最终的编译成果</td>
</tr>
<tr>
<td><strong>log</strong></td>
<td>如果打开了针对开发人员 log 选项，则将编译 log 保存在这个目录下，否则该目录并不会创建</td>
</tr>
<tr>
<td><strong>tmp</strong></td>
<td>编译过程的大量临时文件都会在此</td>
</tr>
</tbody>
</table>
<h3 id="feeds目录">feeds目录</h3>
<ul>
<li>在OpenWrt固件中，几乎所有东西都是<strong>软件包（package）</strong>，可以编译为以“.ipk”结尾的安装包，这样就可以很方便地安装、升级和卸载了。注意，扩展软件包不是在主分支中维护的，但是可以使用<strong>软件包编译扩展机制（feeds）来进行扩展安装</strong>。这些包能够扩展基本系统的功能，只需要将它们链接进入主干。之后，这些软件包将会显示在编译配置菜单中。</li>
<li>目录feeds用于保存扩展软件包，可以使用软件包编译扩展机制来进行扩展安装。这些包能够扩展基本系统的功能，只需要将它们链接进入编译主目录的package目录下。 之后，这些<strong>软件包将会显示在配置菜单中。</strong></li>
<li>./sripts/feeds install -a时，feeds目录就产生了，安装的软件就存放在这个目录下了。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016132638669.png" alt="img"></p>
<h3 id="dl目录">dl目录</h3>
<ul>
<li>编译工具链、目标平台的软件包等需要下载的文件都放在dl目录下。</li>
<li>在编译过程中，各类需要下载的包都保存在这个目录下 (编译过程中用的工具)。</li>
<li>当编译的过程中，如果出错，出错的原因是某个软件包下载错误或丢失，可以手动下载对应的软件包（压缩文件形式），并放在这个目录下，之后重新编译。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016132700705.png" alt="img"></p>
<h3 id="dl目录与feeds目录的区别">dl目录与feeds目录的区别</h3>
<ul>
<li>dl中存放的是编译过程中需要用到的工具，而feeds中存放的是系统编译好之后在系统中需要用的软件。</li>
</ul>
<h2 id="build_dir目录"><strong>build_dir目录</strong></h2>
<p><img src="https://img-blog.csdnimg.cn/20191016125337302.png" alt="img"></p>
<ul>
<li>交叉编译工具的编译中间文件目录。例如生成的.o文件</li>
</ul>
<h3 id="build_dirhost目录">“build_dir/host”目录</h3>
<p><img src="https://img-blog.csdnimg.cn/20191016140254285.png" alt="img"></p>
<ul>
<li>“build_dir/host”是一个临时目录，用来储存不依赖于目标平台的工具。</li>
<li>tools目录中各类工具编译的结果存放在host中，因此可以看到这些目录的名称与tools下的工具名称相同。例如进入一个软件目录，看到其编译结果如下：</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016140454603.png" alt="img"></p>
<h3 id="build_dirtoolchain-目录">build_dir/toolchain-目录</h3>
<ul>
<li>用来储存依赖于指定平台的编译工具链。</li>
<li>tools-chain目录交叉编译工具最终编译的结果文件。</li>
</ul>
<h3 id="build_dirarch目录">“build_dir/<arch>”目录</h3>
<ul>
<li>目标平台和软件包两部分都需要“build_dir/”作为编译的临时目录。</li>
</ul>
<h3 id="staging_dir目录">staging_dir目录</h3>
<p><img src="https://img-blog.csdnimg.cn/20191016140541237.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/2019101613293825.png" alt="img"></p>
<ul>
<li>staging_dir作为编译的临时安装目录</li>
</ul>
<h3 id="staging_dirtoolchain-目录">staging_dir/toolchain-*目录</h3>
<ul>
<li>是编译工具链的最终安装位置。</li>
<li>通常我们不需要改动编译链目录下的任何东西，除非要更新编译工具版本等。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016140759285.png" alt="img"></p>
<h3 id="toolstoolchainbuild_dirstaging_dir四者的关系">tools、toolchain、build_dir、staging_dir四者的关系</h3>
<ul>
<li>tools、toolchain目录中的编译中间文件存放在buidl_dir目录下。例如生成的.o 文件等。</li>
<li>buidl_dir目录存放的软件编译文件，最终安装在staging_dir目录下，因此staging_dir目录为编译安装目录，文件安装到staging_dir目录，并由staging_dir目录的文件生成最终的编译成果。</li>
<li>**所以：**<strong>流程是：tools、toolchain==&gt;编译到build_dir中==&gt;安装到staging_dir中。</strong></li>
</ul>
<h3 id="bin目录">bin目录</h3>
<ul>
<li>编译完成后的最终成果目录。例如安装映像文件及ipk安装包。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172532810.png" alt="img"></p>
<h3 id="packages目录">packages目录</h3>
<ul>
<li>这个目录下主要保存我们编译生成的系统软件包（.ipk）。</li>
<li>我们进入packages目录。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172552818.png" alt="img"></p>
<ul>
<li>在进入i386_pentium4目录，可以看到有软件包的分类目录。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172559482.png" alt="img"></p>
<ul>
<li>进入base软件包目录（一些系统基础的软件），进入之后可以看到很多我们在编译时选择的很多软件生成的软件包。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172706407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>进入luci软件包目录，我们在编译时选择了生成luci软件，可以看到目录下一些的luci软件包。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172720718.png" alt="img"></p>
<ul>
<li>进入packages目录，其中也有一些文件。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172857452.png" alt="img"></p>
<h3 id="targets目录">targets目录</h3>
<ul>
<li>这个目录保存我们的系统镜像文件（按照系统的类别分类）。</li>
<li>我们在make menuconfig时选择了x86平台，就进入targets目录之后就可以看到一个属于x86平台的目录。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172952933.png" alt="img"></p>
<ul>
<li>进入x86平台的目录，其中有一个generic目录，再进入generic目录，可以看到其中有一系列我们可以使用的openwrt系统的镜像文件（备注：不同的镜像文件特点是什么见文章：https://blog.csdn.net/qq_41453285/article/details/101223847）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016172958694.png" alt="img"><img src="https://img-blog.csdnimg.cn/20191016173005524.png" alt="img"></p>
<h3 id="log目录">log目录</h3>
<p><img src="https://img-blog.csdnimg.cn/20191016125903642.png" alt="img"></p>
<ul>
<li>如果打开了针对开发人员 log 选项，则将编译log保存在这个目录下，否则该目录并不会创建。</li>
</ul>
<h3 id="tmp目录">tmp目录</h3>
<ul>
<li>编译过程的大量临时文件都会在此。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191016135819401.png" alt="img"></p>
<h2 id="附加知识">附加知识</h2>
<h3 id="config配置文件">.config配置文件</h3>
<ul>
<li>编译源码时，输入“make defconfig”之后会生成一个“.config”文件，内容大致如下：</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013094504588.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>**文件的内容是什么，从何处来？**这个.config会读取config目录下的4个配置文件（Config-build.in、Config-devel.in、Config-images.in、Config-kernel.in），根据.in文件中的设置生成对应的“选项”与选项对应的“内容/值”。</li>
<li>例如上面图中我们.config文件读取的“Config-Images.in”文件的内容中，“CONFIG_TARGET_ROOTFS_EXT4FS”设置为“y”，“CONFIG_TARGET_EXT4_RESERVED_PCT”被设置为“0”，都是读取“Config-Images.in”文件获取的（下图是Config-Images.in的内）。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013095636719.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>**该文件何时被用到？**当我们在编译源码时，输入“make menuconfig”进入配置工具选项菜单，此时就会读取这个“.config”文件，并根据“.config”文件的内容设置选项的默认值。例如上面的“.config”文件中“ext4”选项默认为“y”，配置选项菜单时“ext4”前面默有个“*”号就代表被选中；“ext4”选项的子选项&quot;Percentage of reserved blocks in root filesystem&quot;默认值为“0”，可以看到其默认值就为“0”。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013095724997.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191013095731154.png" alt="img"></p>
<ul>
<li>**.config内容的修改：**上面说过配置工具选项菜单会读取.config的内容，因此在配置工具选项菜单中修改的内容保存也是在这个配置文件中。例如上面将上面的那个“ext4”选项取消，可以看到在右侧的“.config”文件中“Root filesystem images”下方的那3个选消失了。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191013100531969.png" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20191013100451440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="scriptsdownloadpl下载工具">scripts/download.pl下载工具</h3>
<ul>
<li>OpenWrt在构建时首先下载代码，就是使用 scripts/download.pl 脚本进行下载。</li>
<li>这个下载功能最重要的接口是我们可以通过“scripts/localmirrors”文件自定义软件包 下载地址，方便开发人员进行设置。</li>
<li>最近有很多 iPhone/Android 编译工具爆出后门问题，就是因为使用其他第三方镜像地 址文件来下载编译工具，但没有对下载的软件内容进行 MD5 值对比，从而导致编译的应 用程序感染后门。OpenWrt 的下载检查机制从源头上解决了这类问题。在我开发 OpenWrt 时也发现了下载的一些内容被感染的问题，但检查机制丢弃了不正确的内容，从下一个的 镜像网站上继续下载。</li>
</ul>
<p><strong>使用方法如下：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"> ./download.pl &lt;target dir&gt; &lt;filename&gt; &lt;md5sum&gt; [&lt;mirror&gt; ...]
</code></pre></div><ul>
<li><target dir>：为下载之后的保存位置，下载代码通常均保存在 dl 目录下。</li>
<li><filename>：待下载的文件名。</li>
<li><md5sum>：下载内容的 MD5，用于校验下载文件是否正确。</li>
<li><mirror>：为可选的参数，是下载文件的镜像地址，可以有多个地址，优先选择第一个， 如果下载失败则顺序选择后面的地址。</li>
</ul>
<p><strong>代码解析：</strong></p>
<ul>
<li>该程序由 Perl 语言开发出来，代码并不复杂。代码首先进行初始条件检查，判断参数 是否足够，至少需要 3 个参数分别为下载文件保存位置、下载文件名及下载内容 MD5 值。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011225721112.png" alt="img"></p>
<ul>
<li>接着从命令行参数中顺序读取数据，并赋值给局部变量，最后判断 md5sum 或 md5 工具是否存在，如果不存在提示工具不存在后退出。</li>
<li>紧接着调用 localmirrors()函数读取本地的源码镜像地址，我们可以在企业内部创建自 己的代码镜像服务器，然后将镜像地址放在“scripts/localmirrors”文件中，这样我们就不 用每次编译时都从互联网上去下载了。例如我这里修改如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-crystal" data-lang="crystal">cat localmirrors

<span style="color:#009c00">http</span>:<span style="color:#009c00">//</span>192.168.1.106:8080/openwrt/

<span style="color:#009c00">http</span>:<span style="color:#009c00">//mi</span>rror.bjtu.edu.cn/gnu/
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20191011225930635.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>紧接着遍历命令行并将代码中的镜像地址加到备选镜像中。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011230021329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<ul>
<li>最后使用 while 循环进行下载，如果下载完成就对下载文件的 MD5 进行对比，如果 MD5 值一致则退出循环，否则 进入下一个镜像地址进行下载。下载成功后调用 cleanup()函数来清理临时变量。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191011230110223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="patch-kernelsh脚本">patch-kernel.sh脚本</h3>
<ul>
<li>OpenWrt 的代码包中大多均有 patches 目录。下载代码包完成后进行打补丁，采用的 就是 patck-kernel.sh 脚本。</li>
<li>脚本的第一个参数为编译代码目录，第二个为补丁目录。</li>
</ul>
<p><strong>调用脚本形式举例如下：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">../scripts/patch-kernel.sh iproute2-3.3.0 ../package/iproute2/patches/
</code></pre></div><ul>
<li>上述命令执行流程如下：
<ul>
<li>①首先进行参数赋值，第一个参数为代码目录，第二个参数为补丁目录</li>
<li>②第二步判定代码目录和补丁目录是否存在，如果不存在则提示错误并退出。</li>
<li>③遍历补丁文件，根据后缀判断补丁文件类型。</li>
<li>④调用 patch 命令应用补丁</li>
<li>⑤检查补丁应用是否正确，如果存在“*.rej”文件表示出现错误，返回“1”并退出。</li>
<li>⑥最后检查如果存在应用补丁后的备份文件，则删除备份文件</li>
</ul>
</li>
</ul>
<h3 id="编译扩展机制feeds">编译扩展机制feeds</h3>
<ul>
<li>传统的 Linux 操作系统在编译某一个软件的时候，会检查其依赖软件及头文件是否存在，如果没有安装，则会报缺少头文件或缺少链接库等错误，编译将退出。这种机制使得 开发者在编译一个软件之前，需要查找该软件所需的依赖库及头文件，并手动去安装这些 软件。有时碰到比较娇贵的软件时，嵌套式的安装依赖文件，会使得开发者头昏脑胀。 OpenWrt 通过引入 feeds 机制，很好地解决了这个问题。</li>
<li>feeds 是OpenWrt开发所需要的软件包套件的工具及更新地址集合，这些软件包通过 一个统一的接口地址进行访问。这样用户可以不用关心扩展包的存储位置，可以减少扩展 软件包和核心代码部分的耦合。它由两部分组成，即扩展包位置配置文件 feeds.conf.default 脚本工具 feeds。</li>
</ul>
<p><strong>目前在配置文件中保存最重要的扩展软件包集合有以下4个：</strong></p>
<ul>
<li>‘LuCI’OpenWrt 默认的 Web 浏览器图形用户接口。</li>
<li>‘routing’一些额外的基础路由器特性软件，包含动态路由 Quagga 等。</li>
<li>‘telephony’IP 电话相关的软件包，例如 freeswitch 和 Asterisk 等。</li>
<li>‘management’TR069 等各种管理软件包。</li>
</ul>
<p><strong>在前面编译OpenWrt源码之前，我们做了如下的操作：</strong></p>
<ul>
<li>上述操作，就是利用 feeds 提供的接口将 OpenWrt 所需的全部扩展软件包进行下载并 安装。在更新时，需要能够访问互联网。在下载之前可以通过查看“feeds.conf.default”文 件，来检查哪些文件需要包含在编译环境中。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./scripts/feeds update –a

./scripts/feeds install -a
</code></pre></div><p><strong>feeds工具用法如下：</strong></p>
<ul>
<li>**update：**下载在 feeds.conf 或 feeds.conf.default 文件中的软件包列表并创建索引。-a 表 示更新所有的软件包。只有更新后才能进行后面的操作</li>
<li>**list：**从创建的索引文件“feed.index”中读取列表并显示。只有进行更新之后才能查 看列表</li>
<li>**install：**安装软件包以及它所依赖的软件包，从 feeds 目录安装到 package 目录，即在 “package/feeds”目录创建软件包的软链接。只有安装之后，在后面执行“make menuconfig” 时，才可以对相关软件包是否编译进行选择</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">例如安装 luci-app-firewall：

./scripts/feeds install luci-app-firewall
</code></pre></div><ul>
<li>**search：**按照给定的字符串来查找软件包，需要传入一个字符串参数。</li>
<li>**uninstall：**卸载软件包，但它没有处理依赖关系，仅仅删除本软件包的软链接。</li>
<li>**clean：**删除 update 命令下载和生成的索引文件，但不会删除 install 创建的链接。</li>
</ul>
<p><strong>feeds代码处理流程：</strong></p>
<ul>
<li>这个命令首先读取并解析feeds.conf 配置文件，然 后执行相应的命令，例如 install 时，将安装应用程序包和它所有直接或间接依赖的所有软件包。安装时将创建一个符号链接，从 packages/feeds/$feed_name/$package_name指feeds/$feed_name/$package_name， 这样在“make menuconfig”时，feeds 的软件包就可 以被处理到，就可以选择编译了。</li>
<li>例如“luci-app-firewall”指向“feeds/luci/applications/luciapp-firewall”：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ls package/feeds/luci/luci-app-firewall -alht
</code></pre></div><p><strong>相关配置文件：</strong></p>
<ul>
<li>用一句话来说，编译扩展安装过程就是将feeds目录下的软件包链接到packages/feeds对应目录下。可使用的feeds列表配置为feeds.conf或者 feeds.conf.default。优先选择feeds.conf 文件，这个文件包含了扩展安装源列表，每一行由3部分组成，包含feed方、 feed名字和feed源。</li>
<li>下面是一个扩展安装源配置文件的例子：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">src-git luci https://github.<span style="color:#007575">com</span>/openwrt/luci.<span style="color:#007575">git</span>;for-15.<span style="color:#007575">05</span>

src-git routing https://github.<span style="color:#007575">com</span>/openwrt-routing/packages.<span style="color:#007575">git</span>;for15.<span style="color:#007575">05</span>

src-git telephony https://github.<span style="color:#007575">com</span>/openwrt/telephony.<span style="color:#007575">git</span>;for-15.<span style="color:#007575">05</span>

src-gitmanagement https://github.<span style="color:#007575">com</span>/openwrt-management/packages.<span style="color:#007575">git</span>;for-15.<span style="color:#007575">05</span>
</code></pre></div><ul>
<li>我们可以修改该文件使编译时从自己指定的位置进行下载。主要支持feed方法的类型有以下3种：
<ul>
<li>src-cpy：通过从数据源路径复制数据。</li>
<li>src-git：通过使用 Git 从代码仓库地址下载代码数据。</li>
<li>src-svn：通过使用 SVN 从代码仓库地址下载代码数据。</li>
</ul>
</li>
</ul>
<hr>
<p><a href="https://blog.csdn.net/qq_41453285/article/details/102509299">以上内容转载自网友的blog，若有侵权请联系站长</a></p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/openwrt" rel="tag" title="OpenWrt">#OpenWrt#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2022/09/29/openwrt-%E7%BC%96%E8%AF%91%E6%9D%82%E8%AE%B0/" rel="next" title="OpenWrt 编译杂记">
        <i class="fa fa-chevron-left"></i> OpenWrt 编译杂记
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2022/07/18/%E5%9B%BE%E8%A7%A3ecdhe%E7%A7%98%E9%92%A5%E4%BA%A4%E6%8D%A2%E7%AE%97%E6%B3%95/" rel="prev" title="图解ECDHE秘钥交换算法">
        图解ECDHE秘钥交换算法 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://shanks.link/post/">
        <span class="site-state-item-count">569</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://shanks.link/categories/">      
         
        <span class="site-state-item-count">45</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
         
        <span class="site-state-item-count">50</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2023</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>