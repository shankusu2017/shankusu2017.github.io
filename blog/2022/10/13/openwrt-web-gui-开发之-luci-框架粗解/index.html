<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>OpenWrt Web GUI 开发之 Luci 框架粗解 - Golang编程语言知识介绍</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="OpenWrt Web GUI 开发之 Luci 框架粗解">
    <meta property="og:site_name" content="Golang编程语言知识介绍">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="OpenWrt Web GUI 开发之 Luci 框架粗解 - Golang编程语言知识介绍" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang编程语言知识介绍</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2022/10/13/openwrt-web-gui-%E5%BC%80%E5%8F%91%E4%B9%8B-luci-%E6%A1%86%E6%9E%B6%E7%B2%97%E8%A7%A3/" itemprop="url">
        OpenWrt Web GUI 开发之 Luci 框架粗解
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2022-10-13">
    2022-10-13
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/openwrt" itemprop="url" rel="index">
        <span itemprop="name">OpenWrt</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">5684 字 ~12分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <blockquote>
<p>本博文全部内容在 <a href="https://so.csdn.net/so/search?q=GitHub&amp;spm=1001.2101.3001.7020">GitHub</a> 仓库上同步，可以在 👉 <a href="https://github.com/RDpWTeHM/Embedded-GUI-Develop/tree/master/Luci-of-OpenWrt">GitHub 🔗</a> 上找到。
本博文是 GitHub 上的 README 内容，故本文内部分链接是以 GitHub 上<a href="https://so.csdn.net/so/search?q=%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84&amp;spm=1001.2101.3001.7020">相对路径</a>放置的，有需要请在 GitHub 中下载/查看。</p>
</blockquote>
<p>因为个人的水平和精力是有限的，如果本目录下的内容存在错误，疏忽之处，欢迎指出：可创建 Issue 或者 fork 修改后向本仓库做 pull request</p>
<blockquote>
<p>注：</p>
<p>下文“几个元素”中，属于“总结”。</p>
<p>是在编写本文是为了理清思路，边整理思路边写下的。</p>
<p>若有不明之处可以在看完本目录下的内容之后再回过头来看一遍。</p>
</blockquote>
<p>几个元素：</p>
<ul>
<li>
<p>在 <a href="https://so.csdn.net/so/search?q=OpenWrt&amp;spm=1001.2101.3001.7020">OpenWrt</a> 使用 Luci – Web。</p>
</li>
<li>
<p>Luci 使用 lua 语言作为后台。</p>
</li>
<li>
<p>Luci 使用 lua 通过 uci 库读取和修改 OpenWrt 协定的 UCI 配置文件。</p>
</li>
<li>
<p>OpenWrt 内协定 UCI 配置文件，并提供了不同的接口操作它，其中之一是实现了 lua 语言的 uci 库。</p>
</li>
<li>
<p>Luci <a href="https://so.csdn.net/so/search?q=%E6%A1%86%E6%9E%B6&amp;spm=1001.2101.3001.7020">框架</a>内基于 lua + uci 库编写了 CBI 框架 – CBI 框架是 Luci 的子框架。</p>
</li>
<li>
<p>CBI 框架加载入 uci 配置文件相应的 lua 模块，对于 HTTP GET 能够以 CBI 框架的运行逻辑将 UCI 配置文件转化渲染成用于 Web 前端显示的 HTML 做 HTTP Response；同样对 HTTP POST 也以 CBI 框架运行的逻辑将 form 表单修改写入到 UCI 配置文件中（和生效）。</p>
</li>
<li>
<p>由于 UCI 有着规范的格式，以及 CBI 框架的 OOP 实现，我们不需要从头如 读取 UCI 配置文件，写出如何渲染成 HTML 的代码再 Response 到 Client（浏览器）；这些操作是可以抽象出来的一套可重用的参数和运行逻辑（方法），用户（promgramer）只需要编写针对细分的不同的配置文件内容的 CBI 模块代码即可（即，OOP 中的 class 已经被实现好了，只需要根据不同的实体内容实例和调整实例内容即可）。</p>
</li>
<li>
<p>因为 CBI 框架的高度可重用性（配置文件大同小异，用户（user）管理网页风格统一），所以我们可以设想只要在编写的 CBI 模块代码中指明该模块关联的 UCI 配置文件，那么 CBI 框架就能够将该 UCI 配置文件以写好的有限的规则读取出来并显示在浏览器上 – 但是因为我们需要控制配置文件中的哪些部分需要显示，哪些部分不需要显示；哪些部分以何种方式显示，另一些部分又以另外的什么方式显示；所以我们除了声明配置文件外，还需要声明这些内容 – 这很类似“声明式”编程，后面具体会感觉到。</p>
<p>（另外一提，这点和 Web 开发的后台管理网站没有本质区别，后台管理网站也是通过编写大量通用的代码涵盖大范围的内容类型（数据库，数据 type）以做到对大部分编写的数据模型无需额外编写管理页面，直接能够以通用的模板显示出来并且能够操作）</p>
</li>
<li>
<p>Luci 框架亦是 MVC 模式，其中 CBI 即是 model，因为用户（user）管理网页（路由器的 Web <a href="https://so.csdn.net/so/search?q=GUI&amp;spm=1001.2101.3001.7020">GUI</a>）没有很多花样，所以基本上需要的前端模板 luci 都提供了 – 即用户编写了 CBI 模块即可，CBI 框架渲染时的运行逻辑能够使用既有的模板为浏览器提供 HTML 显示。当然，在一些需要以特殊方式显示或者提供更丰富的功能的地方，我们仍然可以自己编写模板（view），然后在 CBI 内指定哪些 UCI 内容使用该模板显示。</p>
</li>
<li>
<p>Luci 框架的控制器是理解 Luci 框架运行逻辑的关键，它主要将用户编写的控制器规则生成 URI（路由）（并且提供了反向解析的接口），用户（user）只需要在浏览器访问 URL，Luci 就能够通过控制器执行程序中定义的处理代码（比如 CBI 模块）得到处理代码（方法）的返回内容作为 HTTP 响应（View），即 controller -&gt; model -&gt; view（view 中又包含 controller URL）。</p>
</li>
</ul>
<p><strong>详解 Luci 框架</strong> – 将分以下步骤进行（可以仔细看一下，有助于理清思路）：</p>
<ol>
<li>软件结构：源码结构和运行结构
<ol>
<li>源码分布介绍和“安装/运行”文件分布</li>
<li>源码编译/打包方式和上传安装</li>
</ol>
</li>
<li>HTTP Server
<ol>
<li>HTTP Server 和 Luci 交互基本原理</li>
<li>HTTP Server 简单介绍</li>
</ol>
</li>
<li>Luci 用户系统
<ol>
<li>多用户支持</li>
<li>状态保持原理（HTTP 是无状态协议）</li>
<li>登录系统</li>
</ol>
</li>
<li>Luci 框架
<ol>
<li>hello world 级 demo – 接触与感受</li>
<li>MVC 简介</li>
<li>Controller 和 URI</li>
<li>View – 模板简介和基本使用/语法</li>
<li>Luci 框架前半部运行逻辑
<ol>
<li>从 HTTP Server 到执行 Luci</li>
<li>从 Luci 入口到 Controller</li>
<li>从 Controller 到执行 target（函数）</li>
</ol>
</li>
<li>非 CBI target – call 与 template 实例</li>
<li>Model（模型 ）&ndash; CBI 框架
<ol>
<li>CBI 的 hello world 级 demo</li>
<li>了解 OOP 基本知识和作用
<ol>
<li>基本知识</li>
<li>基本作用 -&gt; 可实现的声明式编程</li>
<li>加速编程的好处，隐藏大量细节的坏处</li>
<li>lua OOP 语法与动态语法</li>
<li>类与实例 – 不容模糊的 <code>self</code></li>
</ol>
</li>
<li>UCI 协议（约定）
<ol>
<li>配置文件格式</li>
<li>常规对应 Web 页面显示的控件</li>
<li>lua 中的 uci 库与 API</li>
</ol>
</li>
<li>CBI 模块实例 - example 页和 example 配置文件</li>
<li>处理表单 – 探究 CBI 框架运行逻辑
<ol>
<li>模块，节，tab 与 option</li>
<li>基本类型和动态绑定（组合模式）</li>
<li>lua 脚本代码在什么时候运行？以及 require 和 loader 区别</li>
<li>运行方法（代码执行逻辑）和重写</li>
<li>可选的定制化 – 钩子函数</li>
<li>配置更新的生效和重定向</li>
</ol>
</li>
</ol>
</li>
<li>模板扩展 – javascript 异步请求</li>
</ol>
</li>
<li>节选 - 编程关键词与理解
<ol>
<li>类，类型，实例，对象</li>
<li>API，框架，模块，（数据）模型</li>
<li>钩子，重写</li>
<li>强类型和弱类型，动态和静态</li>
<li>面向过程，面向对象，面向声明</li>
<li>UML</li>
</ol>
</li>
</ol>
<blockquote>
<p>注：</p>
<p>因为本目录的内容并没有按照上文“步骤”写完，所以只称得上“粗解”。</p>
<p>因为 PPT 是先于本文做完的，虽然 PPT 内容本身可能不够精细，但是根据 PPT 内的文字说明，讲解，结合 Luci 源码查看，想必对框架理解会有一定的帮助。</p>
<p>另外在写 PPT 的时候是为了团队现场讲解，会配置打开的源代码文件讲，所以在 PPT 中主要以概括性、解释性、总结性内容为主，读者需要结合源码看。此处内容后面可能会不定期更新。</p>
<p>本着不等将事情做到完美的那一刻再分享出来的理由，</p>
<blockquote>
<p>因为一是这样会过很久之后才分享出来，二是有可能做不到心目中的完美而一直不能分享出来。</p>
</blockquote>
<p>若是有需要的读者早一些看到，并且可能能起到一定的帮助，再由读者自身通过结合源码以及翻阅资料补充便可以理解 Luci 框架。那么本目录下分享出来的内容便是有用的。</p>
<p>通过我也期望于即使目前此处的内容还很粗糙，但是若有读者能够 fork &gt; 编辑补重小节小段或者是几句话，几行代码解释介绍，那也是甚好的。</p>
</blockquote>
<p>粗解 Luci 框架：</p>
<h3 id="目录">目录</h3>
<ol>
<li>
<p>软件结构：源码结构和运行结构</p>
<ol>
<li>源码分布介绍和“安装/运行”文件分布</li>
<li>源码编译/打包方式和上传安装</li>
</ol>
</li>
<li>
<p>HTTP Server</p>
<ol>
<li>HTTP Server 和 Luci 交互基本原理</li>
<li>HTTP Server 简单介绍</li>
</ol>
</li>
<li>
<p>Luci 用户系统</p>
<p>《== 未完成</p>
<ol>
<li>多用户支持</li>
<li>状态保持原理（HTTP 是无状态协议）</li>
<li>登录系统</li>
</ol>
</li>
<li>
<p>Luci 框架</p>
<ol>
<li>
<p>hello world 级 demo – 接触与感受</p>
</li>
<li>
<p>MVC 简介</p>
</li>
<li>
<p>Controller 和 URI</p>
</li>
<li>
<p>View – 模板简介和基本使用/语法</p>
</li>
<li>
<p>Luci 框架前半部运行逻辑</p>
<p>《== 参见 <a href="https://blog.csdn.net/qq_29757283/article/details/luci%E6%A1%86%E6%9E%B6%E4%BB%A3%E7%A0%81%22%E9%80%BB%E8%BE%91%22%E6%B5%81%E7%A8%8B%E5%9B%BE.pdf">luci框架代码”逻辑”流程图.pdf</a></p>
<ol>
<li>从 HTTP Server 到执行 Luci</li>
<li>从 Luci 入口到 Controller</li>
<li>从 Controller 到执行 target（函数）</li>
</ol>
</li>
<li>
<p>非 CBI target – call 与 template 实例</p>
</li>
<li>
<p>Model（模型 ）&ndash; CBI 框架</p>
<ol>
<li>
<p>CBI 的 hello world 级 demo</p>
</li>
<li>
<p>了解 OOP 基本知识和作用</p>
<p>《== 未完成</p>
<ol>
<li>基本知识</li>
<li>基本作用 -&gt; 可实现的声明式编程</li>
<li>加速编程的好处，隐藏大量细节的坏处</li>
<li>lua OOP 语法与动态语法</li>
<li>类与实例 – 不容模糊的 <code>self</code></li>
</ol>
</li>
<li>
<p>UCI 协议（约定）</p>
<ol>
<li>配置文件格式</li>
<li>常规对应 Web 页面显示的控件</li>
<li>lua 中的 uci 库与 API《== 未完成</li>
</ol>
</li>
<li>
<p>CBI 模块实例 - example 页和 example 配置文件</p>
<ol>
<li>模块，节，tab 与 option</li>
<li>基本类型和动态绑定（组合模式）《== 未完成</li>
<li>input-Value，select-ListValue，checkbox-Flag</li>
</ol>
</li>
<li>
<p>处理表单 – 探究 CBI 框架运行逻辑</p>
<ol>
<li>lua 脚本代码在什么时候运行？以及 require 和 loader 区别《== 未完成</li>
<li>运行方法（代码执行逻辑）和重写</li>
<li>可选的定制化 – 钩子函数《== 未完成</li>
<li>配置更新的生效和重定向</li>
</ol>
</li>
</ol>
</li>
<li>
<p>模板扩展 – javascript 异步请求《== 未完成</p>
</li>
</ol>
</li>
<li>
<p>节选 - 编程关键词与理解</p>
<p>《== 未完成</p>
<ol>
<li>类，类型，实例，对象</li>
<li>API，框架，模块，（数据）模型</li>
<li>钩子，重写</li>
<li>强类型和弱类型，动态和静态</li>
<li>面向过程，面向对象，面向声明</li>
<li>UML</li>
</ol>
</li>
</ol>
<h3 id="正文">正文</h3>
<p>参阅 <a href="https://blog.csdn.net/qq_29757283/article/details/luci-web(GUI)-for-develop.pptx">luci-web(GUI)-for-develop.pptx</a></p>
<p>以下为 PPT 幻灯片截图：
<img src="https://img-blog.csdnimg.cn/20190920123335219.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123408684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123423883.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123439859.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123505574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123645712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123708695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123726352.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123746161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>添加一个导航栏 tab，需要在 controller/ 下增加一个相应名称的 *.lua 脚本文件。
框架会读取 controller/ 下的所有 *.lua 脚本文件生成框架内部使用的结构树。每个 *.lua 脚本文件对应一个导航栏 tab。
框架读取 *.lua 内的 function index() 函数，其函数内的 entry 会在页面显示上作为导航栏 tab 的子页标签（页面入口）。</p>
<p>entry(path, target, title, order)
path : router – url
target: Target function to call when dispatched
title : 显示的名称
order : 顺序</p>
<p>source code(dispatch.lua)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">function entry(path, target, title, order)
    local c = node(unpack(path))

    c.target = target
    c.title  = title
    c.order  = order
    c.module = getfenv(2)._NAME

    return c
end
12345678910
</code></pre></div></blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920123943196.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920123958647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/201909201240166.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920124433284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>luci 框架本身也就是 lua 脚本代码。
访问 url 并非访问某个特定的 *.lua 脚本文件。
而是通过 luci 框架执行相应的 lua 代码。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920124523186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920124546227.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920124604302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>Client端和serv端采用cgi方式交互，uhttpd服务器的cgi方式中，fork出一个子进程，
子进程利用execl替换为luci进程空间，并通过setenv环境变量的方式，传递一些固定格式的数据（如PATH_INFO）给luci。</p>
<p>另外一些非固定格式的数据（post-data）则由父进程通过一个w_pipe写给luci的stdin，
而luci的返回数据则写在stdout上，由父进程通过一个r_pipe读取。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920124639135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920124655586.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<ol>
<li>首次运行时，是以普通的file方式获得docroot/index.html，该文件中以meta的方式自动跳转到cgi的url，这是web服务器的一般做法。</li>
<li>然后第一次执行luci，path_info=‘/’，会alise到’/admin’（‘/‘会索引到 tree.rootnode，并执行其target方法，即alise(’/admin’)，即重新去索引adminnode，这在后面会详细描述），
该节点需要认证，所以返回一个登录界面。</li>
<li>第3次交互，过程同上一次的，只是这时已post来了登录信息，所以serv端会生成一个session值，然后执行’/admin’的target（它的target为firstchild，即索引第一个子节点），
最终返回/admin/status.html，同时会把session值以cookie的形式发给client。这就是从原始状态到得到显示页面的过程，之后主要就是点击页面上的连接，产生新的request。</li>
<li>每个链接的url中都会带有一个stok值（它是serv生成的，并放在html中的url里），并且每个新request都要带有session值，它和stok值一起供serv端联合认证。</li>
<li>先介绍 luci 如何生成 router（路由）。
然后关于 luci 框架如何加载模板，渲染数据后 response 到 client——先介绍 MVC（和 CBI），然后介绍连接 MVC 和处理请求接口的 dispatcher.lua。
最后 dispatcher.lua 的其它代码，如何调用执行 controller 中的代码。</li>
</ol>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920124800282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>luci 框架会对解析得到的数据结构缓存在 /tmp/ 目录下
function 是 *.lua -&gt; index -&gt; entry 内的 target</p>
<p>luci框架代码“逻辑”流程图.vsdx == luci框架代码”逻辑”流程图.pdf</p>
<p>用户管理
luci 是一个单用户框架，公用的模块放置在 */luci/controller/ 下面，各个用户的模块放置在 */luci/controller/ 下面对应的文件夹里面。
比如 admin 登录，最终的页面只显示 /luci/controller/admin 下面的菜单。
这样既有效的管理了不同管理员的权限。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920124854406.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920124908547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/2019092012492954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>HowTo: Write Modules: <a href="https://github.com/openwrt/luci/wiki/ModulesHowTo">https://github.com/openwrt/luci/wiki/ModulesHowTo</a></p>
<p>module &lt;&gt; Tab
action &lt;&gt; page</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125004941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920125028180.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>Writing variables and function values
Syntax:
&lt;% write (value) %&gt;
Short-markup:
&lt;%=value%&gt;</p>
<p>Note: index 内部的另外一种写法！！！！！！！！！</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125114897.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920125135671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>通过 API 接口“声明式”编程关联配置文件 – 像 html, css 由浏览器读取 html, css 代码，然后执行浏览器内部的代码最后“显示”。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125201269.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>on_commit, on_apply 等方法在源码中以“钩子”的含义运行。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125233769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>亦：CBI 模块也可以自行编写 template 模板然后指定使用。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125302625.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>类与 API 源码位置：qsdk\qca\feeds\luci\modules\luci-base\luasrc\cbi.lua</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125343969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>Abstract 即说明这是抽象类型；不能直接使用该类，需要继承出类型。
AbstractSection, AbstractValue 即两种不同的类，从效果上看，AbstractValue 的继承类在 CBI 模块中会根据配置文件需要而实例化绑定在继承 AbstractSection 类的实例下；这一点也可以从 AbstractSection 中的 option 方法内的代码看出。</p>
<p>parse 函数决定了框架内运行逻辑。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125413492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>“uci&quot;是&quot;Unified Configuration Interface”(统一配置界面)的缩写,意在OpenWrt整个系统的配置集中化。
系统配置应容易，更直接且在此有文档描述，从而使你的生活更轻松！
（它是White Russian系列OpenWrt基于nvram的配置的后继改进。）
许多程序在系统某处拥有自己的配置文件，
比如/etc/network/interfaces, /etc/exports, /etc/dnsmasq.conf或者 /etc/samba/samba.conf，
有时它们还使用稍有不同的语法。
在OpenWrt中你无需为此烦恼，我们只需更改UCI配置文件！
你不需要为了某个更改起效而重启系统！参阅下文中的命令行实用工具以了解如何做到这点。
还有不要忘了官方程序包(official binaries)里包含了很多后台程序，但默认情况下并未启用！
比如cron后台程序默认并未激活，因而只编辑crontab并无作用。
你需要用/etc/init.d/crond start起动它或用/etc/init.d/crond enable激活它。 大部分后台程序都可以disable(禁用),stop(停止)和restart（重起）。 还有一些非UCI配置你可以参阅。</p>
<p>共同原则
OpenWrt的所有配置文件皆位于/etc/config/目录下。每个文件大致与它所配置的那部分系统相关。可用文本编辑器、“uci” 命令行实用程序或各种编程API(比如 Shell, Lua and C)来编辑/修改这些配置文件。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125510417.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>参考：
<a href="https://lvii.gitbooks.io/outman/content/openwrt.uci.html">https://lvii.gitbooks.io/outman/content/openwrt.uci.html</a></p>
<p>实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f00;font-style:italic"># cat /etc/config/wireless </span>

config wifi-device <span style="color:#009c00">&#39;wifi0&#39;</span>
        option type <span style="color:#009c00">&#39;qcawificfg80211&#39;</span>
        option macaddr <span style="color:#009c00">&#39;00:03:7f:12:20:df&#39;</span>
        option hwmode <span style="color:#009c00">&#39;11a&#39;</span>
        option channel <span style="color:#009c00">&#39;auto&#39;</span>

config wifi-iface
        option device <span style="color:#009c00">&#39;wifi0&#39;</span>
        option mode <span style="color:#009c00">&#39;ap&#39;</span>
        option ssid <span style="color:#009c00">&#39;AAAAAAATest-5G&#39;</span>
        option bssid <span style="color:#009c00">&#39;admin&#39;</span>
        option network <span style="color:#009c00">&#39;lan&#39;</span>
        option key <span style="color:#009c00">&#39;12345678&#39;</span>
        option wps_pushbutton <span style="color:#009c00">&#39;0&#39;</span>
        option encryption <span style="color:#009c00">&#39;none&#39;</span>

config wifi-device <span style="color:#009c00">&#39;wifi1&#39;</span>
        。。。略。。。

<span style="color:#f00;font-style:italic"># cat /etc/config/ddns </span>

config ddns <span style="color:#009c00">&#39;global&#39;</span>
        option ddns_dateformat <span style="color:#009c00">&#39;%F %R&#39;</span>
        option ddns_loglines <span style="color:#009c00">&#39;250&#39;</span>
        option upd_privateip <span style="color:#009c00">&#39;0&#39;</span>

config service <span style="color:#009c00">&#39;myddns_ipv4&#39;</span>
        option lookup_host <span style="color:#009c00">&#39;yourhost.example.com&#39;</span>
        option domain <span style="color:#009c00">&#39;yourhost.example.com&#39;</span>
        option username <span style="color:#009c00">&#39;your_username&#39;</span>
        option password <span style="color:#009c00">&#39;your_password&#39;</span>
        option interface <span style="color:#009c00">&#39;wan&#39;</span>
        option ip_source <span style="color:#009c00">&#39;network&#39;</span>
        option ip_network <span style="color:#009c00">&#39;wan&#39;</span>
        option service_name <span style="color:#009c00">&#39;dyn.com&#39;</span>

config service <span style="color:#009c00">&#39;myddns_ipv6&#39;</span>
        。。。略。。。

12345678910111213141516171819202122232425262728293031323334353637383940
</code></pre></div></blockquote>
<p><img src="https://img-blog.csdnimg.cn/2019092012572786.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>参考：
<a href="https://blog.csdn.net/rainforest_c/article/details/70139962">https://blog.csdn.net/rainforest_c/article/details/70139962</a></p>
<ul>
<li>package &lsquo;example’中的’example’实际上就是UCI文件的文件名，例如/etc/config/network对应 package ‘network’，但是这个语句不会存在文件中，需要通过命令uci export network查看。</li>
<li>config ‘example’ &lsquo;test’语句定义了一个type为example，名字为test的section。section可以只有type而没有名字，这类section称为匿名的section，后文会有说明。</li>
<li>option ‘string’ &lsquo;some value’语句定义了section下的一个option，该option标识为string，值为some value。</li>
<li>list ‘collection’ &lsquo;first item’语句定义了section下的一个list，list与option不同之处在于list可以有多个值，该例子中的list collection有first item和second item两个值。</li>
</ul>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125854813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>此处直接在 OpenWrt 运行系统中直接修改。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920125918821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920125935551.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920125958440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a">
<img src="https://img-blog.csdnimg.cn/20190920130023707.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<blockquote>
<p>s &lt;= m:section()
taboption() 指定了该 Option 类在指定的 section-&gt;tab 下，并返回 option 实例。
option:write 方法重写定义了该方法的内容。write 方法在 post form 时被调用 – 参考前面幻灯片和源码。
m.uci:set, m.uci:delete 这些即使用 lua 的 uci 模块操作 UCI 配置文件 – 命令行操作 UCI 配置文件，Web（Lua）操作 UCI 配置文件两种方式的后一种。
面向对象编程中，m.uci 使用的是 lua 的 uci 模块，通过 m.uci 对象绑定（将 m 实例以 self 的形式传递给 uci 模块）即操作的是 m 指定的 UCI 配置文件。</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20190920130053621.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NzU3Mjgz,size_16,color_FFFFFF,t_70" alt="n/a"></p>
<p><a href="https://blog.csdn.net/qq_29757283/article/details/101056612">以上内容转载自网友的blog，若有侵权请联系站长</a></p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/openwrt" rel="tag" title="OpenWrt">#OpenWrt#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/14/%E5%90%8C%E6%AD%A5master%E4%BB%A3%E7%A0%81%E5%88%B0%E5%88%86%E6%94%AF/" rel="next" title="同步master代码到分支">
        <i class="fa fa-chevron-left"></i> 同步master代码到分支
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/13/openwrt%E7%BC%96%E8%AF%91%E5%BC%80%E5%90%AFluci/" rel="prev" title="OpenWrt编译开启Luci">
        OpenWrt编译开启Luci <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://shanks.link/post/">
        <span class="site-state-item-count">541</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://shanks.link/categories/">      
         
        <span class="site-state-item-count">42</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
         
        <span class="site-state-item-count">47</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2023</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>