<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>OpenWrt 系统UCI详解(Lua、C语言调用uci接口实例) - 愿星光伴你左右</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="OpenWrt 系统UCI详解(Lua、C语言调用uci接口实例)">
    <meta property="og:site_name" content="愿星光伴你左右">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="OpenWrt 系统UCI详解(Lua、C语言调用uci接口实例) - 愿星光伴你左右" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">愿星光伴你左右</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/prose/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />散文
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2022/10/24/openwrt-%E7%B3%BB%E7%BB%9Fuci%E8%AF%A6%E8%A7%A3luac%E8%AF%AD%E8%A8%80%E8%B0%83%E7%94%A8uci%E6%8E%A5%E5%8F%A3%E5%AE%9E%E4%BE%8B/" itemprop="url">
        OpenWrt 系统UCI详解(Lua、C语言调用uci接口实例)
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2022-10-24">
    2022-10-24
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/openwrt" itemprop="url" rel="index">
        <span itemprop="name">OpenWrt</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">3840 字 ~8分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <h2 id="uci简介">UCI简介</h2>
<p>&ldquo;uci&quot;是&quot;Unified <a href="https://so.csdn.net/so/search?q=Configuration&amp;spm=1001.2101.3001.7020">Configuration</a> Interface&rdquo;(统一配置界面)的缩写,用于OpenWrt整个系统的配置集中化。</p>
<p>很多后台服务有自己的配置文件，并且配置文件格式都不相同，<a href="https://so.csdn.net/so/search?q=OpenWrt&amp;spm=1001.2101.3001.7020">OpenWrt</a>系统中需要开启各种服务，为了解决配置不兼容的问题，统一采用uci格式的配置文件。</p>
<p><img src="https://img-blog.csdnimg.cn/2021041522473418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>当然统一的前提是需要各个模块做好适配，所以要想把某个服务集成到OpenWrt系统中，需要增加一个转换层，用于uci配置到服务配置的转换，通常这个工作放在init脚本中处理。</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224743835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>以samba服务器为例，</p>
<p>在一般的linux系统中，启动samba服务直接修改/etc/samba/smb.conf重启服务即可，但在openwrt中，不直接修改/etc/samba/smb.conf，而是修改/etc/config/samba配置文件，然后执行/etc/init.d/samba restart</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224800742.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>以下为init脚本的部分代码，这段代码中就包含了uci配置到samba配置的转换工作。</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224815320.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="uci配置格式">uci配置格式</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>config <span style="color:#009c00">&#39;example&#39;</span> <span style="color:#009c00">&#39;test&#39;</span>
</span></span><span style="display:flex;"><span>	option  <span style="color:#009c00">&#39;string&#39;</span>    <span style="color:#009c00">&#39;some value&#39;</span>
</span></span><span style="display:flex;"><span>	option  <span style="color:#009c00">&#39;boolean&#39;</span>   <span style="color:#009c00">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>	list   <span style="color:#009c00">&#39;collection&#39;</span>  <span style="color:#009c00">&#39;first item&#39;</span>
</span></span><span style="display:flex;"><span>	list   <span style="color:#009c00">&#39;collection&#39;</span>  <span style="color:#009c00">&#39;second item&#39;</span> 
</span></span></code></pre></div><p>config &rsquo;example&rsquo; &rsquo;test&rsquo; 语句表示一个section的开始，这里的配置类型是example，配置名是test。配置中也允许出现匿名节，即自定义了配置类型，而没有配置名的节。配置类型对应配置处理程序来说是十分重要的，因为配置程序需要根据这些信息来处理这些配置项。</p>
<p>option &lsquo;string&rsquo; &lsquo;some value&rsquo; 和 option &lsquo;boolean&rsquo; &lsquo;1&rsquo; 定义了一些简单值。文本选项和布尔选项在语法上没有什么差异。布尔选项中可以用'0&rsquo; ， &rsquo;no&rsquo;， &lsquo;off&rsquo;， 或者&rsquo;false&rsquo;来表示false值，或者也可以用'1&rsquo;， &lsquo;yes&rsquo;，&lsquo;on&rsquo;或者&rsquo;true&rsquo;来表示真值。</p>
<p>以list关键字开头的多个行，可用于定义包含多个值的选项。所有共享一个名称的list语句，会组装形成一个值列表，列表中每个值出现的顺序，和它在配置文件中的顺序相同。如上例中，列表的名称是&rsquo;collection&rsquo;，它包含了两个值，即&rsquo;first item&rsquo;和&rsquo;second item&rsquo;。</p>
<p>&lsquo;option&rsquo;和&rsquo;list&rsquo;语句的缩进可以增加配置文件的可读性，但是在语法不是必须的。</p>
<p>通常不需要为标识符和值加引号，只有当值包括空格或者制表符的时候，才必须加引号。同时，在使用引号的时候，可以用双引号代替单引号。</p>
<p>下面列举的例子都是符合uci语法的正确配置：</p>
<ul>
<li>option example value</li>
<li>option &rsquo;example&rsquo; value</li>
<li>option example &ldquo;value&rdquo;</li>
<li>option &ldquo;example&rdquo;   &lsquo;value&rsquo;</li>
<li>option  &rsquo;example&rsquo; &ldquo;value&rdquo;</li>
</ul>
<p>反之，以下配置则存在语法错误</p>
<ul>
<li>option &rsquo;example&quot; &ldquo;value&rsquo; (引号不匹配)</li>
<li>option example some value with space (值中包含空格，需要为值加引号)</li>
</ul>
<p>还有一点是必须知道的，即UCI标识符和配置文件名称所包含的字符必须是由a-z， 0-9和_组成。 选项值则可以包含任意字符，只要这个值是加了引号的。</p>
<h2 id="uci命令的用法">uci命令的用法</h2>
<p><img src="https://img-blog.csdnimg.cn/20210415224842300.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>uci配置文件支持通过uci shell命令进行操作，支持set、get、show、export等基本操作。当然最常用的就是set和get命令。</p>
<p>在进行uci命令操作之前，我们先查看/etc/config/有哪些配置文件，这样我们可以知道操作哪个配置文件（当然也可以直接uci show，可以看到所有的配置信息，但数据较多，还是习惯先看看config目录有哪些配置）</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224903594.png" alt="img"></p>
<p>现在可以针对某个配置进行操作，比如network配置，先通过cat查看配置文件中的内容，看看数据格式</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224917970.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>然后通过 uci show network命令查看具体的uci配置选项，用于查看具体的uci变量名称</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224932432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>比如我们获取单个option变量值，获取lan口ip地址</p>
<p>可以通过uci get network.lan.ipaddr 命令获取</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224945879.png" alt="img"></p>
<p>也可以通过set命令修改某个变量的值</p>
<p>如设置lan口ip地址为192.168.188.1</p>
<p>uci set network.lan.ipaddr=192.168.188.1</p>
<p><img src="https://img-blog.csdnimg.cn/20210415224957604.png" alt="img"></p>
<p>可以看到已经成功修改了lan ip的值，但值得注意的是，通过cat /etc/config/network并不能查看到最新设置的值，这是因为通过uci set命令只修改了变量的临时值，并没有保存到配置文件中。这个临时值保存在/tmp/.uci/目录中。</p>
<p><img src="https://img-blog.csdnimg.cn/20210415225013940.png" alt="img"></p>
<p>临时目录中的文件内容只显示修改的变量，如果多次修改会显示多个内容，会显示所有的历史记录。现在我们看看多次修改后临时目录文件中的内容</p>
<p><img src="https://img-blog.csdnimg.cn/20210415225028836.png" alt="img"></p>
<p>为了让修改的值在/etc/config目录中生效，我们还需要执行uci commit命令，该命令类似于svn commit，会把修改的记录提交。</p>
<p>uci commit会将所有改变提交，我们也可以只提交某个配置文件的修改，如uci commit network，这样只会提交network的修改内容。</p>
<h2 id="常用的uci配置和命令">常用的uci配置和命令</h2>
<h3 id="重要配置文件">重要配置文件</h3>
<table>
<thead>
<tr>
<th>配置文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>/etc/config/system</td>
<td>系统配置，如主机名、时区等</td>
</tr>
<tr>
<td>/etc/config/network</td>
<td>网络配置，lan口ip、wan口ip、vlan等</td>
</tr>
<tr>
<td>/etc/config/dhcp</td>
<td>Dhcp服务器配置</td>
</tr>
<tr>
<td>/etc/config/firewall</td>
<td>防火墙配置</td>
</tr>
<tr>
<td>/etc/config/uhttpd</td>
<td>Web服务器配置（默认）</td>
</tr>
<tr>
<td>/etc/config/dropbear</td>
<td>Ssh服务器配置</td>
</tr>
<tr>
<td>/etc/config/luci</td>
<td>Luci框架配置</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="常用配置命令">常用配置命令</h3>
<ul>
<li>网络配置</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>uci show network</td>
<td>查看所有网络配置</td>
</tr>
<tr>
<td>uci get network.lan.ipaddr</td>
<td>获取lan口ip地址</td>
</tr>
<tr>
<td>uci set network.lan.ipaddr=192.168.2.1</td>
<td>修改lan口ip地址为192.168.2.1</td>
</tr>
<tr>
<td>uci get network.wan.proto</td>
<td>查看wan口ip地址获取方式（dhcp、static、pppoe）</td>
</tr>
<tr>
<td>uci set network.wan.proto=static</td>
<td>配置wan口ip地址获取方式为静态</td>
</tr>
<tr>
<td>uci get network.wan.ipaddr</td>
<td>获取wan口ip</td>
</tr>
<tr>
<td>uci set network.wan.ipaddr=192.168.100.100</td>
<td>配置wan口ip为192.168.100.100</td>
</tr>
<tr>
<td>uci get network.wan.netmask</td>
<td>获取wan口子网掩码</td>
</tr>
<tr>
<td>uci set network.wan.netmask=255.255.255.0</td>
<td>配置wan口子网掩码为255.255.255.0</td>
</tr>
<tr>
<td>uci get network.wan.gateway</td>
<td>获取默认网关地址</td>
</tr>
<tr>
<td>uci set network.wan.gateway=192.168.100.1</td>
<td>配置默认网关地址为192.168.100.1</td>
</tr>
<tr>
<td>uci get network.lan.ifname</td>
<td>获取lan口接口名(eth0)</td>
</tr>
<tr>
<td>uci get network.wan.ifname</td>
<td>获取wan口接口名(eth1)</td>
</tr>
<tr>
<td>uci show network.wan</td>
<td>查看所有wan配置</td>
</tr>
<tr>
<td>uci show network.lan</td>
<td>查看所有lan配置</td>
</tr>
<tr>
<td>uci commit network</td>
<td>保存网络配置</td>
</tr>
<tr>
<td>uci revert network</td>
<td>放弃修改的网络配置（在commit之前可以revert）</td>
</tr>
</tbody>
</table>
<ul>
<li>其他配置</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>uci show system</td>
<td>查看所有系统配置</td>
</tr>
<tr>
<td>uci get system.@system[0].hostname</td>
<td>获取系统主机名</td>
</tr>
<tr>
<td>uci get system.@system[0].timezone</td>
<td>获取当前系统时区(CST-8)</td>
</tr>
<tr>
<td>uci get system.ntp.enabled</td>
<td>获取ntp开关</td>
</tr>
<tr>
<td>uci get luci.ccache.enable</td>
<td>查看luci是否启用缓存</td>
</tr>
<tr>
<td>uci get luci.languages.zh_cn</td>
<td>获取luci当前使用的语言</td>
</tr>
<tr>
<td>uci get uhttpd.main.home</td>
<td>获取web服务器根目录</td>
</tr>
<tr>
<td>uci get uhttpd.main.listen_http</td>
<td>获取web服务器监听ip和端口</td>
</tr>
<tr>
<td>uci get uhttpd.main.redirect_https</td>
<td>查看web服务器是否强制https</td>
</tr>
<tr>
<td>uci get firewall.@zone[1].masq</td>
<td>查看是否开启地址伪装(snat)</td>
</tr>
<tr>
<td>uci get dropbear.@dropbear[0].PasswordAuth</td>
<td>查看ssh是否开启密码认证</td>
</tr>
<tr>
<td>uci get dropbear.@dropbear[0].Port</td>
<td>查看ssh监听端口号</td>
</tr>
<tr>
<td>uci get dropbear.@dropbear[0].Interface</td>
<td>查看ssh监听的网卡接口</td>
</tr>
<tr>
<td>uci show</td>
<td>查看所有uci配置</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="c语言中使用uci">c语言中使用uci</h2>
<h3 id="引用说明">引用说明</h3>
<p>头文件 &lt;uci.h&gt;</p>
<p>引用库: +libuci</p>
<h3 id="常用结构体">常用结构体</h3>
<table>
<thead>
<tr>
<th>结构体</th>
<th>说明</th>
<th>相关接口</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct uci_context</td>
<td>Uci上下文，用于存储配置路径、配置package等，使用uci前必须分配一个ctx</td>
<td>uci_loaduci_unloaduci_alloc_contextuci_free_context</td>
</tr>
<tr>
<td>struct uci_package</td>
<td>对应一个配置包，如network、wireless</td>
<td>uci_lookup_packageuci_loaduci_unload</td>
</tr>
<tr>
<td>struct uci_section</td>
<td>对应配置的一个节(section)</td>
<td>uci_lookup_section</td>
</tr>
<tr>
<td>struct uci_option</td>
<td>对应某个配置项</td>
<td>uci_lookup_option_stringuci_lookup_option</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="常用接口">常用接口</h3>
<table>
<thead>
<tr>
<th>常用接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>int uci_set(struct uci_context *ctx, struct uci_ptr *ptr)</td>
<td>设置uci值</td>
</tr>
<tr>
<td>int uci_del_list(struct uci_context *ctx, struct uci_ptr *ptr)</td>
<td>删除list option</td>
</tr>
<tr>
<td>int uci_add_list(struct uci_context *ctx, struct uci_ptr *ptr)</td>
<td>增加list option</td>
</tr>
<tr>
<td>int uci_delete(struct uci_context *ctx, struct uci_ptr *ptr)</td>
<td>删除节点（option）</td>
</tr>
<tr>
<td>int uci_lookup_ptr(struct uci_context *ctx, struct uci_ptr *ptr, char *str, bool extended)</td>
<td>查询元素指针</td>
</tr>
<tr>
<td>int uci_rename(struct uci_context *ctx, struct uci_ptr *ptr)</td>
<td>重命名节（option）</td>
</tr>
<tr>
<td>int uci_add_section(struct uci_context *ctx, struct uci_package *p, const char *type, struct uci_section **res)</td>
<td>添加一个节</td>
</tr>
<tr>
<td>struct uci_context *uci_alloc_context(void)</td>
<td>分配上下文空间</td>
</tr>
<tr>
<td>void uci_free_context(struct uci_context *ctx)</td>
<td>释放上下文空间</td>
</tr>
<tr>
<td>int uci_load(struct uci_context *ctx, const char *name, struct uci_package **package)</td>
<td>加载配置到内存</td>
</tr>
<tr>
<td>int uci_set_confdir(struct uci_context *ctx, const char *dir)</td>
<td>设置配置目录</td>
</tr>
<tr>
<td>int uci_commit(struct uci_context *ctx, struct uci_package **package, bool overwrite)</td>
<td>提交修改的值</td>
</tr>
<tr>
<td>struct uci_option *uci_lookup_option(struct uci_context *ctx, struct uci_section *s, const char *name)</td>
<td>查询option指针</td>
</tr>
<tr>
<td>const char *uci_lookup_option_string(struct uci_context *ctx, struct uci_section *s, const char *name)</td>
<td>获取一个option string值</td>
</tr>
<tr>
<td>struct uci_section *uci_lookup_section(struct uci_context *ctx, struct uci_package *p, const char *name)</td>
<td>查询package中的section</td>
</tr>
<tr>
<td>struct uci_package *uci_lookup_package(struct uci_context *ctx, const char *name)</td>
<td>在上下文中获取package指针</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="c语言操作uci配置实例">C语言操作uci配置实例</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;string.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;stdlib.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;uci.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span> 
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">struct</span> <span style="color:#007575">uci_context</span> *uci_ctx = NULL;
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">struct</span> <span style="color:#007575">uci_package</span> *uci_test;
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">struct</span> <span style="color:#007575">uci_package</span> *
</span></span><span style="display:flex;"><span><span style="color:#c34e00">config_init_package</span>(<span style="color:#00f">const</span> <span style="color:#00f">char</span> *config)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#00f">struct</span> <span style="color:#007575">uci_context</span> *ctx = uci_ctx;
</span></span><span style="display:flex;"><span>    <span style="color:#00f">struct</span> <span style="color:#007575">uci_package</span> *p = NULL;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (!ctx)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ctx = uci_alloc_context();
</span></span><span style="display:flex;"><span>        uci_ctx = ctx;
</span></span><span style="display:flex;"><span>        ctx-&gt;flags &amp;= ~UCI_FLAG_STRICT;
</span></span><span style="display:flex;"><span>        <span style="color:#f00;font-style:italic">//if (config_path)
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>        <span style="color:#f00;font-style:italic">//  uci_set_confdir(ctx, config_path);
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#00f">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        p = uci_lookup_package(ctx, config);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (p)
</span></span><span style="display:flex;"><span>            uci_unload(ctx, p);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (uci_load(ctx, config, &amp;p))
</span></span><span style="display:flex;"><span>        <span style="color:#00f">return</span> NULL;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#00f">return</span> p;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#00f">int</span> <span style="color:#c34e00">config_alloc</span>(<span style="color:#00f">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    uci_test = config_init_package(<span style="color:#009c00">&#34;test&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (!uci_test)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#009c00">&#34;Failed to load test config</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">return</span> -1;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#00f">return</span> 0;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#00f">int</span> <span style="color:#c34e00">config_free</span>(<span style="color:#00f">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (uci_test)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        uci_unload(uci_ctx, uci_test);
</span></span><span style="display:flex;"><span>        uci_test = NULL;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (uci_ctx)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        uci_free_context(uci_ctx);
</span></span><span style="display:flex;"><span>        uci_ctx = NULL;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#00f">int</span> <span style="color:#c34e00">main</span>(<span style="color:#00f">int</span> argc, <span style="color:#00f">char</span> *argv[])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#00f">int</span> ret = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#00f">int</span> enable = 0;
</span></span><span style="display:flex;"><span>    config_alloc();
</span></span><span style="display:flex;"><span>    <span style="color:#00f">struct</span> <span style="color:#007575">uci_section</span> *global_sec = uci_lookup_section(uci_ctx, uci_test, <span style="color:#009c00">&#34;global&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (!global_sec)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#009c00">&#34;get global section failed</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>);
</span></span><span style="display:flex;"><span>        config_free();
</span></span><span style="display:flex;"><span>        <span style="color:#00f">return</span> 0;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#00f">char</span> *name = uci_lookup_option_string(uci_ctx, global_sec, <span style="color:#009c00">&#34;name&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (!name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#009c00">&#34;name option not found.</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>);
</span></span><span style="display:flex;"><span>        config_free();
</span></span><span style="display:flex;"><span>        <span style="color:#00f">return</span> 0;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    printf(<span style="color:#009c00">&#34;name = %s</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>, name);
</span></span><span style="display:flex;"><span>    free(name);
</span></span><span style="display:flex;"><span>    <span style="color:#00f">struct</span> <span style="color:#007575">uci_ptr</span> ptr ={
</span></span><span style="display:flex;"><span>                .package = <span style="color:#009c00">&#34;test&#34;</span>,
</span></span><span style="display:flex;"><span>                .section = <span style="color:#009c00">&#34;global&#34;</span>,
</span></span><span style="display:flex;"><span>                .option = <span style="color:#009c00">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>                .value = <span style="color:#009c00">&#34;xxxxxxxxxx&#34;</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>    ret = uci_set(uci_ctx, &amp;ptr);   
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span>(ret != UCI_OK)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#009c00">&#34;set name...failed</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#00f">else</span>{
</span></span><span style="display:flex;"><span>        printf(<span style="color:#009c00">&#34;set name...ok</span><span style="color:#009c00">\n</span><span style="color:#009c00">&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    uci_save(uci_ctx, ptr.p);
</span></span><span style="display:flex;"><span>    uci_commit(uci_ctx, &amp;ptr.p, false);
</span></span><span style="display:flex;"><span>    config_free();
</span></span><span style="display:flex;"><span>    <span style="color:#00f">return</span> 0;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="lua中使用uci">Lua中使用uci</h3>
<h4 id="配置文件实例">配置文件实例</h4>
<p>/etc/config/test</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vbnet" data-lang="vbnet"><span style="display:flex;"><span>config <span style="color:#00f">global</span> <span style="color:#f00;font-style:italic">&#39;global&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">option</span> name <span style="color:#f00;font-style:italic">&#39;derry&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">option</span> id <span style="color:#f00;font-style:italic">&#39;1&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>    list address <span style="color:#f00;font-style:italic">&#39;shenzhen&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>    list address <span style="color:#f00;font-style:italic">&#39;guangzhou&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>    list address <span style="color:#f00;font-style:italic">&#39;beijing&#39;
</span></span></span></code></pre></div><h4 id="cursor初始化的几种方式">cursor初始化的几种方式</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>1. 不带参数初始化（配置目录默认/etc/config）
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x = uci.cursor()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2. 包含状态值
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x = uci.cursor(nil, <span style="color:#009c00">&#34;/var/state&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>3. 指定配置目录
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x = uci.cursor(<span style="color:#009c00">&#34;/etc/mypackage/config&#34;</span>, <span style="color:#009c00">&#34;/tmp/mypackage/.uci&#34;</span>)
</span></span></code></pre></div><h4 id="lua常用的uci接口">Lua常用的uci接口</h4>
<table>
<thead>
<tr>
<th>lua接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>x:get(&ldquo;config&rdquo;, &ldquo;sectionname&rdquo;, &ldquo;option&rdquo;)</td>
<td>返回字符串 或 nil(没找到数据时)</td>
</tr>
<tr>
<td>x:set(&ldquo;config&rdquo;, &ldquo;sectionname&rdquo;, &ldquo;option&rdquo;, &ldquo;value&rdquo;)</td>
<td>设置简单的字符串变量</td>
</tr>
<tr>
<td>x:set(&ldquo;config&rdquo;, &ldquo;sectionname&rdquo;, &ldquo;option&rdquo;, { &ldquo;foo&rdquo;, &ldquo;bar&rdquo; })</td>
<td>设置列表变量</td>
</tr>
<tr>
<td>x:delete(&ldquo;config&rdquo;, &ldquo;section&rdquo;, &ldquo;option&rdquo;)</td>
<td>删除选项</td>
</tr>
<tr>
<td>x:delete(&ldquo;config&rdquo;, &ldquo;section&rdquo;)</td>
<td>删除段</td>
</tr>
<tr>
<td>x:add(&ldquo;config&rdquo;, &ldquo;type&rdquo;)</td>
<td>添加一个匿名section（段）</td>
</tr>
<tr>
<td>x:set(&ldquo;config&rdquo;, &ldquo;name&rdquo;, &ldquo;type&rdquo;)</td>
<td>添加一个类型为 “type”的section（段），名称为”name”</td>
</tr>
<tr>
<td>x:foreach(&ldquo;config&rdquo;, &ldquo;type&rdquo;, function(s) &hellip; end)</td>
<td>遍历所有类型为的&quot;type&quot;段,并以每个&quot;s&quot;为参数调用回调函数. s 是一个包含所有选型和两个特有属性的列表s[&rsquo;.type&rsquo;] → 段类型s[&rsquo;.name&rsquo;] → 段名称如果回调函数返回 false [NB: not nil!], foreach() 在这个点会终止,不再继续遍历任何剩余的段. 如果至少存在一个段且回调函数没有产生错误,foreach() 会返回 true; 否则返回false.</td>
</tr>
<tr>
<td>x:revert(&ldquo;config&rdquo;)</td>
<td>取消修改的值</td>
</tr>
<tr>
<td>x:commit(&ldquo;config&rdquo;)</td>
<td>保存修改的值到配置目录文件，默认目录/etc/config</td>
</tr>
</tbody>
</table>
<h2 id="lua操作uci配置实例1">Lua操作uci配置实例1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#!/usr/bin/lua
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span><span style="color:#00f">require</span>(<span style="color:#009c00">&#34;uci&#34;</span>)
</span></span><span style="display:flex;"><span>x = uci.cursor()
</span></span><span style="display:flex;"><span><span style="color:#00f">function</span> <span style="color:#c34e00">show_test_config</span>()
</span></span><span style="display:flex;"><span>    name = x:get(<span style="color:#009c00">&#34;test&#34;</span>, <span style="color:#009c00">&#34;global&#34;</span>, <span style="color:#009c00">&#34;name&#34;</span>)
</span></span><span style="display:flex;"><span>    id = x:get(<span style="color:#009c00">&#34;test&#34;</span>, <span style="color:#009c00">&#34;global&#34;</span>, <span style="color:#009c00">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>    addr_list = x:get(<span style="color:#009c00">&#34;test&#34;</span>, <span style="color:#009c00">&#34;global&#34;</span>, <span style="color:#009c00">&#34;address&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#00f">print</span>(<span style="color:#009c00">&#34;name=&#34;</span>..name)
</span></span><span style="display:flex;"><span>    <span style="color:#00f">print</span>(<span style="color:#009c00">&#34;id=&#34;</span>..id)
</span></span><span style="display:flex;"><span><span style="color:#00f">for</span> key, value in ipairs(addr_list) 
</span></span><span style="display:flex;"><span><span style="color:#00f">do</span> 
</span></span><span style="display:flex;"><span><span style="color:#00f">print</span>(<span style="color:#009c00">&#34;address[&#34;</span>..key..<span style="color:#009c00">&#34;]----&#34;</span>..value) 
</span></span><span style="display:flex;"><span>end
</span></span><span style="display:flex;"><span>end
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#00f">print</span>(<span style="color:#009c00">&#34;==========before change=========&#34;</span>)
</span></span><span style="display:flex;"><span>show_test_config()
</span></span><span style="display:flex;"><span>x:set(<span style="color:#009c00">&#34;test&#34;</span>, <span style="color:#009c00">&#34;global&#34;</span>, <span style="color:#009c00">&#34;name&#34;</span>, <span style="color:#009c00">&#34;xxxxxxx&#34;</span>)
</span></span><span style="display:flex;"><span>x:set(<span style="color:#009c00">&#34;test&#34;</span>, <span style="color:#009c00">&#34;global&#34;</span>, <span style="color:#009c00">&#34;id&#34;</span>, <span style="color:#009c00">&#34;8888888&#34;</span>)
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>x:set(<span style="color:#009c00">&#34;test&#34;</span>,<span style="color:#009c00">&#34;global&#34;</span>,<span style="color:#009c00">&#34;address&#34;</span>,{<span style="color:#009c00">&#34;1111&#34;</span>,<span style="color:#009c00">&#34;2222&#34;</span>,<span style="color:#009c00">&#34;33333&#34;</span>,<span style="color:#009c00">&#34;4444&#34;</span>,<span style="color:#009c00">&#34;5555&#34;</span>})
</span></span><span style="display:flex;"><span>x:commit(<span style="color:#009c00">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#00f">print</span>(<span style="color:#009c00">&#34;==========after change=========&#34;</span>)
</span></span><span style="display:flex;"><span>show_test_config()
</span></span></code></pre></div><p>运行结果：</p>
<p><img src="https://img-blog.csdnimg.cn/20210415225432381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4dDExMDc=,size_16,color_FFFFFF,t_70" alt="img"></p>
<h4 id="lua操作uci配置实例2">Lua操作uci配置实例2</h4>
<p>x=uci.cursor()</p>
<p>conf=x:get_all(&ldquo;test&rdquo;, &ldquo;global&rdquo;)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#!/usr/bin/lua</span>
</span></span><span style="display:flex;"><span>require(<span style="color:#009c00">&#34;uci&#34;</span>)
</span></span><span style="display:flex;"><span>x=uci.cursor()
</span></span><span style="display:flex;"><span>conf=x:get_all(<span style="color:#009c00">&#34;test&#34;</span>, <span style="color:#009c00">&#34;global&#34;</span>)
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>print(conf[<span style="color:#009c00">&#34;name&#34;</span>]);
</span></span><span style="display:flex;"><span>print(conf[<span style="color:#009c00">&#34;id&#34;</span>]);
</span></span><span style="display:flex;"><span><span style="color:#00f">for</span> key, value <span style="color:#00f">in</span> ipairs(conf[<span style="color:#009c00">&#34;address&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#00f">do</span>
</span></span><span style="display:flex;"><span>    print(value);
</span></span><span style="display:flex;"><span><span style="color:#00f">end</span>
</span></span></code></pre></div><p>运行结果：</p>
<p><img src="https://img-blog.csdnimg.cn/20210415225507551.png" alt="img"></p>
<p><a href="https://blog.csdn.net/dxt1107/article/details/115742249">以上内容转载自本链接，若有侵权请联系站长</a></p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/openwrt" rel="tag" title="OpenWrt">#OpenWrt#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/24/openwrt-luci%E9%A1%B5%E9%9D%A2%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E5%BA%95%E9%83%A8%E6%8C%89%E9%92%AE%E8%BF%94%E5%9B%9E%E4%BF%9D%E5%AD%98%E5%A4%8D%E4%BD%8D/" rel="next" title="OpenWrt Luci页面如何配置底部按钮（返回、保存、复位）">
        <i class="fa fa-chevron-left"></i> OpenWrt Luci页面如何配置底部按钮（返回、保存、复位）
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/24/git-%E6%B8%85%E9%99%A4%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/" rel="prev" title="Git 清除历史记录">
        Git 清除历史记录 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://shanks.link/post/">
        <span class="site-state-item-count">505</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://shanks.link/categories/">      
         
        <span class="site-state-item-count">32</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
         
        <span class="site-state-item-count">37</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2022</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">愿星光伴你左右</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo v0.101.0</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>