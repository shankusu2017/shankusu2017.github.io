<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Openwrt LuCI 入门（一） - Golang编程语言知识介绍</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="Openwrt LuCI 入门（一）">
    <meta property="og:site_name" content="Golang编程语言知识介绍">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Openwrt LuCI 入门（一） - Golang编程语言知识介绍" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang编程语言知识介绍</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2022/10/20/openwrt-luci-%E5%85%A5%E9%97%A8%E4%B8%80/" itemprop="url">
        Openwrt LuCI 入门（一）
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2022-10-20">
    2022-10-20
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/openwrt" itemprop="url" rel="index">
        <span itemprop="name">OpenWrt</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">3872 字 ~8分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <h3 id="luci基本概念">LuCI基本概念</h3>
<ul>
<li>
<p>UCI 是 <a href="https://so.csdn.net/so/search?q=Openwrt&amp;spm=1001.2101.3001.7020">Openwrt</a> 中为实现所有系统配置的一个统一接口，英文名 <code>Unified Configuration Interface</code>，即统一配置接口。轻量级 LUA 语言的官方版本只包括一个精简的核心和最基本的库。这使得 LUA 体积小、启动速度快，从而适合嵌入在别的程序里。 LuCI 即是这两个项目的合体，可以实现路由的网页配置界面。</p>
<p>建议在学习LuCI界面开发之前，先了解下LUA 的相关语法知识。
参考教程https://www.runoob.com/lua/lua-basic-syntax.html</p>
</li>
<li>
<p>LuCI采用了MVC (模型/视图/控制）三层架构，在系统的<code>/usr/lib/lua/luci/</code>下有三个目录 model、 view、 controller， 它们分别对应 M、V、 C。也可以在<code>openwrt源码/feeds/luci/applications/luci-app-xx/luasrc/</code> 或 openwrt源码<code>/feeds/luci/modules/luci-mod-admin-full/luasrc/</code> 目录下阅读官方的源码例程，学习参考， 我们要做的主要工作就是基于 LuCI 框架编写LUA 脚本、在 html 页面中嵌入 LUA 脚本。
<img src="https://img-blog.csdnimg.cn/20200111123636146.png" alt="在这里插入图片描述"></p>
</li>
</ul>
<h3 id="luci-界面开发">LuCI 界面开发</h3>
<h4 id="openwrt配置支持luci">Openwrt配置支持luci</h4>
<ul>
<li>
<p>需要编译或者安装以下软件包 uhttpd-mod-lua</p>
</li>
<li>
<p>进行luci 相关的开发需要“编译”Luci-compat</p>
</li>
<li>
<p>在<strong>编译完</strong>后的Openwrt源码顶层目录 执行 <code>make menuconfig</code> ，勾选以下相关选项，保存退出。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-handlebars" data-lang="handlebars">LuCI ---&gt;
	Collections ---&gt;
			&lt;*&gt; luci
			&lt;*&gt; luci-ssl
	Translations---&gt;
			&lt;*&gt; luci-i18n-chinese   //支持中文
			&lt;*&gt; luci-i18n-english 
</code></pre></div><ul>
<li>Translations 选项需要下载相应的中文支持包才行</li>
<li>重新编译 Openwrt 并更新固件，连接好网线，然后通过浏览器访问路由器开发板的 LAN 口 IP 地址。
<img src="https://img-blog.csdnimg.cn/20200107114039546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>界面显示<img src="https://img-blog.csdnimg.cn/20200107140113156.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h4 id="openwrt添加界面">Openwrt添加界面</h4>
<ul>
<li>添加界面有两种方式，大同小异：</li>
<li>① 在开发板系统中添加界面方式。</li>
<li>② 在源码中添加界面方式。</li>
<li>第①种在系统板上修改界面配置文件后，可以马上在网页端看到修改效果，不用重新编译Openwrt源码和烧写固件，优点：开发便捷，缺点：重刷系统后相关文件修改信息丢失。两者开发方式就类似于在开发板上挂载NFS开发；第②种适合产品发布。</li>
</ul>
<h5 id="在开发板系统中添加界面">在开发板系统中添加界面</h5>
<ul>
<li>按照前面所讲的MVC模型，将涉及的三个文件夹列出来：</li>
<li><code>/usr/lib/lua/luci/controller/</code>*</li>
<li><code>/usr/lib/lua/luci/view/</code>*</li>
<li><code>/usr/lib/lua/luci/model/cbi/</code>*</li>
<li>后面我们也将围绕这三个文件夹进行界面开发。</li>
</ul>
<h6 id="1-usrliblualucicontroller--控制">(1) /usr/lib/lua/luci/controller/ – 控制</h6>
<ul>
<li>进入 /usr/lib/lua/luci/controller/ 目录下， <code>mkdir myapp</code> 创建myapp/目录，并在myapp目录下创建new_tab.lua 文件，在文件中输入如下内容：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">module(<span style="color:#009c00">&#34;luci.controller.myapp.new_tab&#34;</span>, package.seeall) 
<span style="color:#00f">function</span> <span style="color:#c34e00">index</span>()
    entry({<span style="color:#009c00">&#34;admin&#34;</span>, <span style="color:#009c00">&#34;new_tab&#34;</span>}, firstchild(),translate(<span style="color:#009c00">&#34;cfg&#34;</span>), 1).dependent=<span style="color:#00f">false</span>
    entry({<span style="color:#009c00">&#34;admin&#34;</span>, <span style="color:#009c00">&#34;new_tab&#34;</span>, <span style="color:#009c00">&#34;sn&#34;</span>}, cbi(<span style="color:#009c00">&#34;myapp-mymodule/gateway_sn&#34;</span>), translate(<span style="color:#009c00">&#34;sn&#34;</span>), 2)
    entry({<span style="color:#009c00">&#34;admin&#34;</span>, <span style="color:#009c00">&#34;new_tab&#34;</span>, <span style="color:#009c00">&#34;hellworld&#34;</span>}, template(<span style="color:#009c00">&#34;myapp-mymodule/helloworld&#34;</span>), _(<span style="color:#009c00">&#34;HelloWorld&#34;</span>), 3)
<span style="color:#00f">end</span>
</code></pre></div><ul>
<li>语法说明 ：</li>
</ul>
<blockquote>
<p><strong>module(“luci.controller.myapp.new_tab”, package.seeall)</strong></p>
<ul>
<li>定义模块的入口</li>
</ul>
<p><strong>entry(path, target, title=nil, order=nil)</strong></p>
<ul>
<li>entry表示添加一个新的选项入口</li>
<li>“path” 是访问的路径，路径是按字符串数组给定的， 比如路径按如下方式写“{“admin”, “new_tab”,
“hellworld”}”，那么就可以在浏览器里访问“ <code>http://192.168.1.252/cgibin/luci/admin/new_tab/hellworld</code>”来访问这个脚本。其中的“admin”表示为管理员添加脚本，“new_tab”即为一级菜单名，“hellworld”为菜单项名。系统会自动在对应的菜单中生成菜单项。比如想在“System”菜单下创建一个菜单项，那么一级菜单名可以写为“system”。
<img src="https://img-blog.csdnimg.cn/20200107165049188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>“target”为调用目标，调用目标分为三种，分别是执行指定方法(Action)、访问指定页面(Views)以及调用
CBI Module。
<ul>
<li>第一种可以直接调用指定的函数，比如点击菜单项就直接重启路由器等等，比如写“call(“function_name”)”，然后在该lua文件下编写名为function_name的函数就可以调用了</li>
<li>第二种可以访问指定的页面，比如写为“template(“myapp-mymodule/helloworld”)”就可以调用/usr/lib/lua/luci/view//myapp-mymodule/helloworld.htm文件了。</li>
<li>第三种主要应用在配置界面，比如写为“cbi(“myapp/mymodule”)”就可以调用/usr/lib/lua/luci/model/cbi/myapp-mymodule/gateway_sn.lua文件了。</li>
<li>其他一些如 lias 是等同于别的链接，form 和 cgi 对应到 model/cbi 相应的目录下面.</li>
</ul>
</li>
<li>title即是显示在网页上的内容，即选项名，可以用translate(“英文/中文”)，也可以用_(“HelloWorld”)方式，还有一种就是利用.po 文件，将英文标识 与 翻译语言 一一对应，例如：
msgid “Default gateway”
msgstr “默认网关”
当title参数为 <code>_(&quot;Default gateway&quot;)</code>时，如果路由设置为中文显示，则该选项自动显示为 <code>默认网关</code>。</li>
<li>order就是菜单项在界面中显示的顺序，由上至下，由左至右，依次递增，可以缺省。</li>
</ul>
</blockquote>
<h6 id="2-usrliblualucimodel--模型">(2) /usr/lib/lua/luci/model/ – 模型</h6>
<ul>
<li>进入/usr/lib/lua/luci/model/cbi/ 目录下， <code>mkdir myapp-mymodule/</code> 创建myapp-mymodule/目录，并在myapp-mymodule/目录下创建gateway_sn.lua 文件(注：该文件夹与文件命名恰好对应<code>new_tab.lua文件中</code>的<code>myapp-mymodule/gateway_sn</code>)，在文件中输入如下内容：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">m = Map(<span style="color:#009c00">&#34;sn_file&#34;</span>, translate(<span style="color:#009c00">&#34;产品序列号&#34;</span>)) <span style="color:#f00;font-style:italic">-- cbi_file is the config file in /etc/config</span>
d = m:section(TypedSection, <span style="color:#009c00">&#34;gateway_sn&#34;</span>)  <span style="color:#f00;font-style:italic">-- info is the section called info in cbi_file</span>
a = d:option(Value, <span style="color:#009c00">&#34;sn&#34;</span>, translate(<span style="color:#009c00">&#34;序列号&#34;</span>));
a.optional=<span style="color:#00f">false</span>; 
a.rmempty = <span style="color:#00f">false</span>;  <span style="color:#f00;font-style:italic">-- name is the option in the cbi_file</span>
<span style="color:#00f">return</span> m
</code></pre></div><p>语法说明：</p>
<blockquote>
<p>官方文档 <a href="http://luci.subsignal.org/trac/wiki/Documentation/CBI">http://luci.subsignal.org/trac/wiki/Documentation/CBI</a>
或详情 见 <a href="https://blog.csdn.net/qq_28812525/article/details/103881723">Openwrt：LuCI之CBI（二）</a></p>
</blockquote>
<h6 id="3-usrliblualuciview--视图">(3) /usr/lib/lua/luci/view/ – 视图</h6>
<ul>
<li>进入/usr/lib/lua/luci/view/目录下，<code>mkdir myapp-mymodule/</code> 创建myapp-mymodule/目录，并在myapp-mymodule/目录下新建helloworld.htm文件，输入内容如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-htm" data-lang="htm">&lt;%+header%&gt;
&lt;h1&gt;&lt;%: HelloWorld %&gt;&lt;/h1&gt;
&lt;%+footer%&gt;
</code></pre></div><p>语法说明：</p>
<blockquote>
<ul>
<li>
<p>包含Lua代码:</p>
<p>&lt;% code %&gt;</p>
</li>
<li>
<p>输出变量和函数值：</p>
<p>&lt;% write(value) %&gt;</p>
</li>
<li>
<p>&lt;%=value%&gt;</p>
</li>
<li>
<p>包含模板:</p>
<p>&lt;% include(templatesName) %&gt;</p>
<p>&lt;%+templatesName%&gt;</p>
</li>
<li>
<p>转换：</p>
<p>&lt;%= translate(“Text to translate”) %&gt;</p>
<p>&lt;%:Text to translate%&gt;</p>
</li>
<li>
<p>注释：</p>
<p>&lt;%# comment %&gt;</p>
<p>其他语法跟html和JavaScript一样。</p>
</li>
</ul>
</blockquote>
<h6 id="4-etcconfigsn_file--类数据库">(4) /etc/config/sn_file – 类数据库</h6>
<ul>
<li>进入/etc/config/ 目录下，新建 sn_file 文件， 输入内容如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">config <span style="color:#009c00">&#39;gateway_sn&#39;</span> <span style="color:#009c00">&#39;sn&#39;</span>
    option <span style="color:#009c00">&#39;sn&#39;</span> <span style="color:#009c00">&#39;gw2019081300001&#39;</span>
</code></pre></div><p>语法说明：</p>
<blockquote>
<ul>
<li>详情 见 <a href="https://blog.csdn.net/qq_28812525/article/details/103902872">Openwrt：LuCI之UCI（三）</a></li>
</ul>
</blockquote>
<ul>
<li>创建完上面的文件内容后 <code>reboot</code> 重启一下路由板（注：凡是修改<code>controller/</code>文件夹中的配置，都需要重启板子或把<code>/tmp/目录下luci-indexcache luci-modulecache/luci-sessions/删除</code> 才能生效，其他几个文件夹修改可不用，刷新一下网页即可），登录网页界面，可以看到效果如下：
<img src="https://img-blog.csdnimg.cn/20200107152019212.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
<img src="https://img-blog.csdnimg.cn/20200107152050125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h5 id="在源码中添加界面">在源码中添加界面</h5>
<ul>
<li>上面是在系统中添加luci界面，现在开始在源码中添加</li>
</ul>
<h6 id="1-创建目录及文件">(1) 创建目录及文件</h6>
<ul>
<li>进入<code>openwrt源码/feeds/luci/applications/</code>，添加如下目录文件结构
<img src="https://img-blog.csdnimg.cn/20200107155633958.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>① 在<code>luci-app-myapplication/Makefile</code> 中,添加内容如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">include <span style="color:#00f">$(</span>TOPDIR<span style="color:#00f">)</span>/rules.mk

LUCI_TITLE:=LuCI Support <span style="color:#00f">for</span> Test
LUCI_DEPENDS:=
include ../../luci.mk
<span style="color:#f00;font-style:italic"># call BuildPackage - OpenWrt buildroot signature
</span></code></pre></div><ul>
<li>② 在<code>luci-app-myapplication/luasrc/controller/myapp/new_tab.lua</code>文件中 ，添加内容如下(注：与上面系统添加界面方式的内容一致)：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">module(<span style="color:#009c00">&#34;luci.controller.myapp.new_tab&#34;</span>, package.seeall) 
<span style="color:#00f">function</span> <span style="color:#c34e00">index</span>()
    entry({<span style="color:#009c00">&#34;admin&#34;</span>, <span style="color:#009c00">&#34;new_tab&#34;</span>}, firstchild(),translate(<span style="color:#009c00">&#34;cfg&#34;</span>), 1).dependent=<span style="color:#00f">false</span>
    entry({<span style="color:#009c00">&#34;admin&#34;</span>, <span style="color:#009c00">&#34;new_tab&#34;</span>, <span style="color:#009c00">&#34;sn&#34;</span>}, cbi(<span style="color:#009c00">&#34;myapp-mymodule/gateway_sn&#34;</span>), translate(<span style="color:#009c00">&#34;sn&#34;</span>), 2)
    entry({<span style="color:#009c00">&#34;admin&#34;</span>, <span style="color:#009c00">&#34;new_tab&#34;</span>, <span style="color:#009c00">&#34;hellworld&#34;</span>}, template(<span style="color:#009c00">&#34;myapp-mymodule/helloworld&#34;</span>), _(<span style="color:#009c00">&#34;HelloWorld&#34;</span>), 3)
<span style="color:#00f">end</span>
</code></pre></div><ul>
<li>③ 在<code>luci-app-myapplication/luasrc/model/cbi/myapp-mymodule/gateway_sn.lua</code>文件中 ，添加内容如下(注：与上面系统添加界面方式的内容一致)：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">m = Map(<span style="color:#009c00">&#34;sn_file&#34;</span>, translate(<span style="color:#009c00">&#34;产品序列号&#34;</span>)) <span style="color:#f00;font-style:italic">-- cbi_file is the config file in /etc/config</span>
d = m:section(TypedSection, <span style="color:#009c00">&#34;gateway_sn&#34;</span>)  <span style="color:#f00;font-style:italic">-- info is the section called info in cbi_file</span>
a = d:option(Value, <span style="color:#009c00">&#34;sn&#34;</span>, translate(<span style="color:#009c00">&#34;序列号&#34;</span>));
a.optional=<span style="color:#00f">false</span>; 
a.rmempty = <span style="color:#00f">false</span>;  <span style="color:#f00;font-style:italic">-- name is the option in the cbi_file</span>
<span style="color:#00f">return</span> m
</code></pre></div><ul>
<li>④ 在<code>luci-app-myapplication/luasrc/view/myapp-mymodule/helloworld.htm</code> 文件中 ，添加内容如下(注：与上面系统添加界面方式的内容一致)：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">&lt;%+header%&gt;
&lt;h1&gt;&lt;%: HelloWorld %&gt;&lt;/h1&gt;
&lt;%+footer%&gt;
</code></pre></div><h6 id="2-执行更新">(2) 执行更新</h6>
<ul>
<li>回退到Openwrt 源码顶层目录，依次执行以下命令：</li>
<li><code>./scripts/feeds update luci</code></li>
<li><code>./scripts/feeds install -a -p luci</code></li>
<li><code>make menuconfig</code>
进入</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-handlebars" data-lang="handlebars">LuCI ---&gt;
	Applications ---&gt;
			 &lt;*&gt; luci-app-myapplication............................. LuCI Support for Test 
</code></pre></div><p><img src="https://img-blog.csdnimg.cn/20200107161324855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li>选定，然后保存退出，编译 <code>make V=s</code></li>
<li>烧录固件</li>
</ul>
<h6 id="3-uci文件创建">(3) uci文件创建</h6>
<ul>
<li>方式① 在openwrt源码目录 <code>openwrt源码/package/base-files/files/etc/config/</code> 新建cbi_file文件</li>
<li>方式② 在开发板/etc/config目录下新建cbi_file文件，内容如下（注：该文件在重新烧录固件后不会丢失）：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-handlebars" data-lang="handlebars">config &#39;gateway_sn&#39; &#39;sn&#39;
    option &#39;sn&#39; &#39;gw2019081300001&#39;
</code></pre></div><h6 id="4-查看效果">(4) 查看效果</h6>
<p><img src="https://img-blog.csdnimg.cn/20200107152019212.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
<img src="https://img-blog.csdnimg.cn/20200107152050125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="结尾">结尾</h3>
<h4 id="总结反思">总结&amp;反思</h4>
<ul>
<li>Luci、Lua、Uci、CBI的关系图，如下图：
<img src="https://img-blog.csdnimg.cn/20200111123826592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>CBI 详情见 <a href="https://blog.csdn.net/qq_28812525/article/details/103881723">Openwrt：LuCI之CBI（二）</a></li>
<li>UCI 详情见 <a href="https://blog.csdn.net/qq_28812525/article/details/103902872">Openwrt：LuCI之UCI（三）</a></li>
<li>LUA详情见 <a href="https://www.runoob.com/lua/lua-basic-syntax.html">lua基本语法</a></li>
</ul>
<h4 id="名词解释">名词解释</h4>
<ul>
<li>Lua：解释性脚本语言</li>
<li>Uci：(Unified Configuration Interface)，OpenWrt中为实现所有系统配置的一个统一接口</li>
<li>Luci：(Lua ConﬁgurationInterface )，由Lua实现的Openwrt网页系统配置接口</li>
<li>MVC 框架：(model+view+controller )，要开发一个新的功能页面，开发者只要根据 MVC 框架写些简单的 Lua 脚本，剩下的部分由Openwrt为你自动完成</li>
<li>CBI：(Configuration Binding Interface)，CBI模型位于lua\luci\model\cbi</li>
</ul>
<h4 id="参考资料">参考资料</h4>
<ul>
<li>官方说明文档： <a href="http://luci.subsignal.org/trac/wiki/Documentation">http://luci.subsignal.org/trac/wiki/Documentation</a></li>
<li>Luci模块说明文档： <a href="http://luci.subsignal.org/trac/wiki/Documentation/ModulesHowTo">http://luci.subsignal.org/trac/wiki/Documentation/ModulesHowTo</a></li>
<li>参考博客：</li>
<li><a href="https://blog.csdn.net/u012041204/article/details/54952376">https://blog.csdn.net/u012041204/article/details/54952376</a></li>
<li><a href="http://blog.chinaunix.net/uid-26824563-id-4591418.html">http://blog.chinaunix.net/uid-26824563-id-4591418.html</a></li>
<li><a href="https://blog.csdn.net/qq_37035946/article/details/93629149">https://blog.csdn.net/qq_37035946/article/details/93629149</a></li>
</ul>
<blockquote>
<p>跟随大师的脚步，模仿大师的行为，感受大师的意境，成为真正的大师。</p>
</blockquote>
<p><a href="https://blog.csdn.net/qq_28812525/article/details/103870169">以上内容转载自本链接，若有侵权请联系站长</a></p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/openwrt" rel="tag" title="OpenWrt">#OpenWrt#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/21/pushing-a-branch-to-bitbucket-fails-with-the-error-refspec-matches-more-than-one./" rel="next" title="Pushing a branch to Bitbucket fails with the error, &#34;refspec matches more than one&#34;.">
        <i class="fa fa-chevron-left"></i> Pushing a branch to Bitbucket fails with the error, &#34;refspec matches more than one&#34;.
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/20/openwrt-netifd%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="OpenWrt netifd学习笔记">
        OpenWrt netifd学习笔记 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://shanks.link/post/">
        <span class="site-state-item-count">523</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://shanks.link/categories/">      
         
        <span class="site-state-item-count">40</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
         
        <span class="site-state-item-count">45</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2023</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>