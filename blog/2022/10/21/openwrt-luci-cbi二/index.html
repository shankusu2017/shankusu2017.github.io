<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Openwrt LuCI CBI（二） - 程序员的小天地</title>
    <meta name="keywords" content="Golang,golang,go,git,Git,Lua,lua">
    
    <meta property="og:title" content="Openwrt LuCI CBI（二）">
    <meta property="og:site_name" content="程序员的小天地">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Openwrt LuCI CBI（二） - 程序员的小天地" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">程序员的小天地</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/todo/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />todo
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />思考
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/life/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />life
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/food/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />food
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ebpf/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />ebpf
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/p4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />p4
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/dns/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />DNS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/distributed/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />distributed
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/finance/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />投资
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/ftp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />FTP
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2022/10/21/openwrt-luci-cbi%E4%BA%8C/" itemprop="url">
        Openwrt LuCI CBI（二）
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2022-10-21">
    2022-10-21
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/openwrt" itemprop="url" rel="index">
        <span itemprop="name">OpenWrt</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">4392 字 ~9分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <h3 id="一cbi控件类型汇总">一、CBI控件类型汇总</h3>
<ul>
<li>CBI模型是描述UCI配置文件结构的Lua文件，并且CBI解析器将lua文件转为HTML呈现给用户 。</li>
<li>所有 CBI 模型文件必须返回类型为 luci.cbi.Map 的对象。</li>
<li>CBI 模型文件的范围由 luci.cbi 模块的内容和 luci.i18n 的转换函数自动扩展。</li>
</ul>
<table>
  <thead>
      <tr>
          <th>名称</th>
          <th>描述</th>
          <th>继承自</th>
          <th>模板</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>NamedSection</td>
          <td>A fixed configuration section defined by its name</td>
          <td>NamedSection = class(AbstractSection)</td>
          <td>cbi/nsection</td>
      </tr>
      <tr>
          <td>TypedSection</td>
          <td>A (set of) configuration section(s) defined by the type</td>
          <td>TypedSection = class(AbstractSection)</td>
          <td>cbi/tsection</td>
      </tr>
      <tr>
          <td>Node</td>
          <td>Node pseudo abstract class</td>
          <td>Node = class()</td>
          <td>cbi/node</td>
      </tr>
      <tr>
          <td>Template</td>
          <td>A simple template element</td>
          <td>Template = class(Node)</td>
          <td></td>
      </tr>
      <tr>
          <td>Map</td>
          <td>A map describing a configuration file</td>
          <td>Map = class(Node)</td>
          <td>cbi/map</td>
      </tr>
      <tr>
          <td>Compound</td>
          <td>Container</td>
          <td>Compound = class(Node)</td>
          <td>cbi/compound</td>
      </tr>
      <tr>
          <td>Delegator</td>
          <td>Node controller</td>
          <td>Delegator = class(Node)</td>
          <td>cbi/delegator</td>
      </tr>
      <tr>
          <td>SimpleForm</td>
          <td>A Simple non-UCI form</td>
          <td>SimpleForm = class(Node)</td>
          <td>cbi/simpleform</td>
      </tr>
      <tr>
          <td>Form</td>
          <td></td>
          <td>Form = class(SimpleForm)</td>
          <td></td>
      </tr>
      <tr>
          <td>AbstractSection</td>
          <td></td>
          <td>AbstractSection = class(Node)</td>
          <td></td>
      </tr>
      <tr>
          <td>SimpleSection</td>
          <td></td>
          <td>SimpleSection = class(AbstractSection)</td>
          <td>cbi/nullsection</td>
      </tr>
      <tr>
          <td>Table</td>
          <td></td>
          <td>Table = class(AbstractSection)</td>
          <td>cbi/tblsection</td>
      </tr>
      <tr>
          <td>AbstractValue</td>
          <td>An abstract Value Type</td>
          <td>AbstractValue = class(Node)</td>
          <td></td>
      </tr>
      <tr>
          <td>Value</td>
          <td>A one-line value</td>
          <td>Value = class(AbstractValue)</td>
          <td>cbi/value</td>
      </tr>
      <tr>
          <td>DummyValue</td>
          <td>This does nothing except being there</td>
          <td>DummyValue = class(AbstractValue)</td>
          <td>cbi/dvalue</td>
      </tr>
      <tr>
          <td>Flag</td>
          <td>A flag being enabled or disabled</td>
          <td>Flag = class(AbstractValue)</td>
          <td>cbi/fvalue</td>
      </tr>
      <tr>
          <td>ListValue</td>
          <td>A one-line value predefined in a list</td>
          <td>ListValue = class(AbstractValue)</td>
          <td>cbi/lvalue</td>
      </tr>
      <tr>
          <td>MultiValue</td>
          <td>Multiple delimited values</td>
          <td>MultiValue = class(AbstractValue)</td>
          <td>cbi/mvalue</td>
      </tr>
      <tr>
          <td>StaticList</td>
          <td></td>
          <td>StaticList = class(MultiValue)</td>
          <td></td>
      </tr>
      <tr>
          <td>DynamicList</td>
          <td></td>
          <td>DynamicList = class(AbstractValue)</td>
          <td>cbi/dynlist</td>
      </tr>
      <tr>
          <td>TextValue</td>
          <td>A multi-line value</td>
          <td>TextValue = class(AbstractValue)</td>
          <td>cbi/tvalue</td>
      </tr>
      <tr>
          <td>Button</td>
          <td></td>
          <td>Button = class(AbstractValue)</td>
          <td>cbi/button</td>
      </tr>
      <tr>
          <td>FileUpload</td>
          <td></td>
          <td>FileUpload = class(AbstractValue)</td>
          <td>cbi/upload</td>
      </tr>
      <tr>
          <td>FileBrowser</td>
          <td></td>
          <td>FileBrowser = class(AbstractValue)</td>
          <td>cbi/browser</td>
      </tr>
      <tr>
          <td>Page</td>
          <td>A simple node</td>
          <td>Page = class(Node)</td>
          <td></td>
      </tr>
  </tbody>
</table>
<h3 id="二cbi常用控件用法详解">二、CBI常用控件用法详解</h3>
<h4 id="21-class-map-config-title-description">2.1 class Map (config, title, description)</h4>
<ul>
<li>This is the root object of the model.。</li>
<li>模型的根对象</li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>config: configuration filename to be mapped， see UCI documentation and the files in /etc/config</li>
</ul>
<blockquote>
<ul>
<li>UCI详解 见 <a href="https://blog.csdn.net/qq_28812525/article/details/103902872">Openwrt：LuCI之UCI（三）</a></li>
</ul></blockquote>
<ul>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>方法说明:</p>
<ul>
<li>function :section(sectionclass, …)</li>
</ul>
<blockquote>
<ul>
<li>sectionclass: a class object of the section。// section的类对象</li>
<li>additional parameters passed to the constructor of the section class。//传递给section类的构造函数的其他参数</li>
</ul></blockquote></blockquote>
<ul>
<li>补充</li>
</ul>
<blockquote>
<p><code>section(TypedSection, type, title, description)</code>
<code>section(NamedSection, name, type, title, description)</code>
section 对象有一些属性如下：</p>
<blockquote>
<p>template： html 模板， 默认为&quot;cbi/tsection&quot;
addremove： 是否可以增加和删除， 默认为 false
anonymous： 是否为匿名 section， 默认为 false</p></blockquote></blockquote>
<ul>
<li>网页图例
<img src="http://shanks.link/img/openwrt/20200108141312631.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="22-class-namedsectionname-type-title-description">2.2 class NamedSection(name, type, title, description)</h4>
<ul>
<li>An object describing an UCI section selected by the name. //根据type来解析一个UCI section</li>
<li>To instantiate use: <code>Map:section(NamedSection, &quot;name&quot;, &quot;type&quot;, &quot;title&quot;, &quot;description&quot;)</code></li>
</ul>
<blockquote>
<p>参数说明：</p>
<ul>
<li>name: UCI section名字, config type section</li>
<li>type: UCI section类型, config type section</li>
</ul>
<blockquote>
<ul>
<li>type可选：Value、 DynamicList、 Flag、 ListValue、TextValue、MultiValue、DummyValue、StaticList、Button …</li>
</ul></blockquote>
<ul>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>对象属性：</p>
<ul>
<li>property.addremove = false</li>
</ul>
<blockquote>
<ul>
<li>Allows the user to remove and recreate the configuration section. //允许用户删除并重新创建配置section。</li>
</ul></blockquote>
<ul>
<li>property.anonymous = true</li>
</ul>
<blockquote>
<ul>
<li>true 页面不显示section名字</li>
<li>false 页面显示section名字</li>
</ul></blockquote>
<ul>
<li>property.dynamic = false</li>
</ul>
<blockquote>
<ul>
<li>ture 将section 标记为动态</li>
<li>Dynamic sections can contain an undefinded number of completely userdefined options. //将此部分标记为动态。动态section可以包含未找到的完全用户定义的选项数。</li>
</ul></blockquote>
<ul>
<li>property.optional = true</li>
</ul>
<blockquote>
<ul>
<li>解析可选的options</li>
</ul></blockquote>
<p>方法说明:</p>
<ul>
<li>function :option(optionclass, …)</li>
</ul>
<blockquote>
<ul>
<li>Creates a new option //创建新选项</li>
<li>ptionclass: a class object of the section //section的类对象</li>
<li>additional parameters passed to the constructor of the option class //传递给选项类的构造函数的其他参数</li>
</ul></blockquote></blockquote>
<ul>
<li>补充</li>
</ul>
<blockquote>
<p><code>option(type, name, title, description)</code>
option对象有一些属性如下：</p>
<blockquote>
<p>rmempty：如果为空值则删除该选项，默认为 true
default： 默认值， 如果为空值，则设置为该默认值
datatype： 限制输入类型。 例如&quot;and(uinteger,min(1))&ldquo;限制输入无符号整形而且大于 0， &ldquo;ip4addr&quot;限制
输入 IPv4 地址， &ldquo;port&quot;限制输入类型为端口，更多参考/usr/lib/lua/luci/cbi/datatypes.lua
placeholder： 占位符（ html5 才支持）</p></blockquote></blockquote>
<h4 id="23-class-typedsection-type-title-description">2.3 class TypedSection (type, title, description)</h4>
<ul>
<li>An object describing a group of UCI sections selected by their type. // 通过类型type选择来描述一组 UCI section的对象。</li>
<li>To instantiate use: <code>Map:section(TypedSection, &quot;type&quot;, &quot;title&quot;, &quot;description&quot;)</code></li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>type: UCI section类型, config type section</li>
</ul>
<blockquote>
<ul>
<li>type可选：Value、 DynamicList、 Flag、 ListValue、TextValue、MultiValue、DummyValue、StaticList、Button …</li>
</ul></blockquote>
<ul>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>对象属性:</p>
<ul>
<li>property.addremove = false 同NameSection</li>
<li>property.anonymous = true 同NameSection</li>
<li>property.template = “cbi/template” 设置此页面的模块</li>
</ul>
<p>方法说明:</p>
<ul>
<li>function :depends(key, value)</li>
</ul>
<blockquote>
<ul>
<li>Only show this option field if another option key is set to value in the same section.
If you call this function several times the dependencies will be linked with “or”// 仅当另一个选项键在同一section中设置为值时，才显示此选项字段。如果多次调用此函数，则依赖项将链接为 [或]</li>
</ul></blockquote>
<ul>
<li>function .filter(self, section) -abstract-</li>
</ul>
<blockquote>
<ul>
<li>You can override this function to filter certain sections that will not be parsed. The filter function will be called for every section that should be parsed and returns nil for sections that should be filtered. For all other sections it should return the section name as given in the second parameter. //您可以重写此函数以筛选某些不会解析的部分。对于应分析的每个section，将调用筛选器函数，对于应筛选的section，将返回 nil。对于所有其他section，它应返回第二个参数中给出的section名称。</li>
</ul></blockquote>
<ul>
<li>function :option(optionclass, …)</li>
</ul></blockquote>
<ul>
<li>网页图例<img src="http://shanks.link/img/openwrt/2020010814323985.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="24-class-value-option-title-description">2.4 class Value (option, title, description)</h4>
<ul>
<li>An object describing an option in a section of a UCI File. Creates a standard text field in the formular.//描述 UCI 文件部分中的选项的对象。在公式中创建标准文本框。(单行文本框)</li>
<li>To instantiate use: <code>NamedSection:option(Value, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code> or <code>TypedSection:option(Value, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code></li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>option: UCI option name</li>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>对象属性:</p>
<ul>
<li>property .default = nil 文本框中缺省的值</li>
<li>property .maxlength = nil</li>
</ul>
<blockquote>
<ul>
<li>The maximum input length (of chars) of the value //值的最大输入长度（字符）</li>
</ul></blockquote>
<ul>
<li>property .optional = false</li>
</ul>
<blockquote>
<ul>
<li>Marks this option as optional, implies .rmempty = true //将此选项标记为可选， .rmempty = true</li>
</ul></blockquote>
<ul>
<li>property .rmempty = true</li>
</ul>
<blockquote>
<ul>
<li>Removes this option from the configuration file when the user enters an empty value //当用户输入空值时，从配置文件中删除此选项</li>
</ul></blockquote>
<ul>
<li>property .size = nil</li>
</ul>
<blockquote>
<ul>
<li>The maximum number of chars displayed by form field //窗体字段显示的最大字符数</li>
</ul></blockquote>
<ul>
<li>property .password = false</li>
</ul>
<blockquote>
<p>密码输入框</p></blockquote>
<p>方法说明:</p>
<ul>
<li>function :depends(key, value)</li>
</ul>
<blockquote>
<ul>
<li>Only show this option field if another option key is set to value in the same section.
If you call this function several times the dependencies will be linked with “or”</li>
</ul></blockquote>
<ul>
<li>function :value(key, value)</li>
</ul>
<blockquote>
<ul>
<li>Convert this text field into a combobox if possible and add a selection option. //如果可能，将此文本字段转换为组合框，并添加选择选项。</li>
</ul></blockquote></blockquote>
<ul>
<li>网页图例<img src="https://img-blog.csdnimg.cn/20200108143934965.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h4 id="25-class-listvalue-option-title-description">2.5 class ListValue (option, title, description)</h4>
<ul>
<li>An object describing an option in a section of a UCI File.Creates a list box or list of radio (for selecting one of many choices) in the formular. //描述 UCI File 部分中选项的对象。在公式中创建一个列表框或单选列表（用于选择多种选项之一）（即下拉列表）。</li>
<li>To instantiate use: <code>NamedSection:option(ListValue, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code> or <code>TypedSection:option(ListValue, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code></li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>option: UCI option name</li>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>对象属性:</p>
<ul>
<li>property .default = nil 文本框中缺省的值</li>
<li>property .widget = “select”</li>
</ul>
<blockquote>
<ul>
<li>select shows a selection list, radio shows a list of radio buttons inside form
//select 显示选择列表，radio 显示表单内单选按钮的列表</li>
</ul></blockquote>
<ul>
<li>property .optional = false</li>
<li>property .rmempty = true</li>
<li>property .size = nil</li>
</ul>
<blockquote>
<ul>
<li>The maximum number of chars displayed by form field</li>
</ul></blockquote>
<p>方法说明:</p>
<ul>
<li>function :depends(key, value)</li>
<li>function :value(key, value)</li>
</ul>
<blockquote>
<ul>
<li>Adds an entry to the selection list.//将条目添加到选择列表中。</li>
</ul></blockquote></blockquote>
<ul>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108145255131.png" alt="在这里插入图片描述">
<img src="https://img-blog.csdnimg.cn/20200108145325526.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="26-class-flag-option-title-description">2.6 class Flag (option, title, description)</h4>
<ul>
<li>An object describing an option with two possible values in a section of a UCI File. Creates a checkbox field in the formular. //描述在 UCI 文件部分中具有两个可能值的选项的对象。在公式中创建复选框。</li>
<li>To instantiate use: <code>NamedSection:option(Flag, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code>or <code>TypedSection:option(Flag, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code></li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>option: UCI option name</li>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>对象属性:</p>
<ul>
<li>property .default = nil The default value</li>
<li>property .disabled = 0</li>
</ul>
<blockquote>
<ul>
<li>the value that should be set if the checkbox is unchecked //取消选中复选框时 应设置的值</li>
</ul></blockquote>
<ul>
<li>property .enabled = 1</li>
</ul>
<blockquote>
<ul>
<li>the value that should be set if the checkbox is checked //选中复选框时 应设置的值</li>
</ul></blockquote>
<ul>
<li>property .optional = false</li>
<li>property .rmempty = true</li>
</ul>
<p>方法说明:</p>
<ul>
<li>function :depends (key, value)</li>
</ul></blockquote>
<ul>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108150400354.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="27-class-multivalue-option-title-description">2.7 class MultiValue (option, title, description)</h4>
<ul>
<li>An object describing an option in a section of a UCI File.Creates a list of checkboxed or a multiselectable list as form fields. //描述 UCI 文件部分中的选项的对象。创建复选框列表或多选列表（非下拉列表）。</li>
<li>To instantiate use: NamedSection:option(MultiValue, “option”, “title”, “description”)
or TypedSection:option(MultiValue, “option”, “title”, “description”)</li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>option: UCI option name</li>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>对象属性:</p>
<ul>
<li>property .widget = “checkbox”</li>
</ul>
<blockquote>
<ul>
<li>select shows a selection list, checkbox shows a list of checkboxes inside form //选中显示选择列表，复选框显示表单内的复选框列表</li>
</ul></blockquote>
<ul>
<li>property .delimiter = &quot; &quot;</li>
</ul>
<blockquote>
<p>-The string which will be used to delimit the values inside stored option //用于分隔存储选项内的值的字符串</p></blockquote>
<ul>
<li>property .default = nil</li>
<li>property .optional = false</li>
<li>property .rmempty = true</li>
<li>property .size = nil</li>
</ul>
<blockquote>
<p>-The size of the form field (only used if property .widget = “select”) //窗体字段的大小（仅当属性 .widget = &ldquo;选择&quot;时才使用）</p></blockquote>
<p>方法说明:</p>
<ul>
<li>function :depends (key, value)</li>
<li>function :value(key, value)</li>
</ul>
<blockquote>
<ul>
<li>Adds an entry to the list</li>
</ul></blockquote></blockquote>
<ul>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108150922753.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="28-class-staticlist-option-title-description">2.8 class StaticList (option, title, description)</h4>
<ul>
<li>Similar to the MultiValue, but stores selected Values into a UCI list instead of a character-separated option. //与MultiValue类似，但将所选值存储到 UCI list中，而不是字符分隔option中。</li>
<li>(这里可能会有疑问，请看下面操作，当在网页对StaticList和MultiValue 选中四个选项时，保存并应用，查看UCI 中配置文件就可以明白。MultiValue 对应的值存储在option,而StaticList对应的值分别存储在list中)
<img src="https://img-blog.csdnimg.cn/2020010815304473.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108153132206.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="29-class-dynamiclist-option-title-description">2.9 class DynamicList (option, title, description)</h4>
<ul>
<li>A extensible list of user-defined values. Stores Values into a UCI list //用户定义值的可扩展列表。将值存储到 UCI list中</li>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108152335545.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="210-class-dummyvalue-option-title-description">2.10 class DummyValue (option, title, description)</h4>
<ul>
<li>Creates a readonly text in the form. It writes no data to UCI!//在窗体中创建只读文本。它不写入任何数据到UCI！</li>
<li>To instantiate use: <code>NamedSection:option(DummyValue, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code>or <code>TypedSection:option(DummyValue, &quot;option&quot;, &quot;title&quot;, &quot;description&quot;)</code></li>
</ul>
<blockquote>
<p>参数说明:</p>
<ul>
<li>option: UCI option name</li>
<li>title: 页面显示名称</li>
<li>description: 页面显示详细描述</li>
</ul>
<p>方法说明:</p>
<ul>
<li>function :depends (key, value)</li>
</ul></blockquote>
<ul>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108151521170.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="211-class-textvalue-option-title-description">2.11 class TextValue (option, title, description)</h4>
<ul>
<li>An object describing a multi-line textbox in a section in a non-UCI form.// 描述非 UCI 窗体中节中多行文本框的对象。</li>
<li><strong>注：与Value的区别就是TextValue可以多行显示，而Value只能单行显示。</strong></li>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108151722144.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="212-class-button-option-title-description">2.12 class Button (option, title, description)</h4>
<ul>
<li>An object describing a Button in a section in a non-UCI form.//描述非 UCI 窗体中节中的按钮的对象。</li>
</ul>
<blockquote>
<p>属性说明：同Value</p>
<ul>
<li>.inputstyle = nil 按钮样式 apply, reset</li>
</ul>
<p>方法说明：同Value</p></blockquote>
<ul>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108151933438.png" alt="在这里插入图片描述"></li>
</ul>
<h4 id="213-class-tabtabname-title">2.13 class tab(tabname, title)</h4>
<ul>
<li>调用 section 的 tab 函数创建一个名称为 tabname，标题为 title 的 Tab 标签。</li>
<li>对应的 option 则使用 taboption
s:taboption(tabname, type, name, title)
在指定的 tabname 下创建一个 option。</li>
<li><strong>s为section 对象，与之前的控件不同，一个section里面如果有tab控件，会将其他（如Value）控件覆盖掉，所以，要想创建tab选项，必须另外再创建section。</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>b = m:section(TypedSection, <span style="color:#009c00">&#34;typedsection2_title&#34;</span>, <span style="color:#009c00">&#34;typedsection2 description&#34;</span>)
</span></span><span style="display:flex;"><span>b:tab(<span style="color:#009c00">&#34;tab1&#34;</span>, <span style="color:#009c00">&#34;Tab1&#34;</span>);
</span></span><span style="display:flex;"><span>b:tab(<span style="color:#009c00">&#34;tab2&#34;</span>, <span style="color:#009c00">&#34;Tab2&#34;</span>);
</span></span><span style="display:flex;"><span>b1=b:taboption(<span style="color:#009c00">&#34;tab1&#34;</span>, Value, <span style="color:#009c00">&#34;tab1_option1&#34;</span>, <span style="color:#009c00">&#34;tab1 Option1&#34;</span>);
</span></span><span style="display:flex;"><span>b2=b:taboption(<span style="color:#009c00">&#34;tab2&#34;</span>, Value, <span style="color:#009c00">&#34;tab2_option2&#34;</span>, <span style="color:#009c00">&#34;tab2 Option2&#34;</span>);
</span></span></code></pre></div><ul>
<li>网页图例
<img src="https://img-blog.csdnimg.cn/20200108170619676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h3 id="三实例操作">三、实例操作</h3>
<h4 id="31-示例">3.1 示例</h4>
<ul>
<li><strong>（1）网页整体图例</strong><img src="https://img-blog.csdnimg.cn/20200108172829426.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
<img src="https://img-blog.csdnimg.cn/20200108172852920.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODEyNTI1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li><strong>（2） lua 文件中CBI控件代码</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>m = Map(<span style="color:#009c00">&#34;test_file&#34;</span>,<span style="color:#009c00">&#34;map title&#34;</span> ,translate(<span style="color:#009c00">&#34;map descrption&#34;</span>)) <span style="color:#f00;font-style:italic">-- cbi_file is the config file in /etc/config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a = m:section(TypedSection, <span style="color:#009c00">&#34;typedsection1_title&#34;</span>, <span style="color:#009c00">&#34;typedsection1 description&#34;</span>)  <span style="color:#f00;font-style:italic">-- info is the section called info in cbi_file</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a1 = a:option(Value, <span style="color:#009c00">&#34;Value_option_name&#34;</span>,<span style="color:#009c00">&#34;Value option title&#34;</span>, translate(<span style="color:#009c00">&#34;Value option description&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a2 = a:option(TextValue, <span style="color:#009c00">&#34;TextValue_option_name&#34;</span>,<span style="color:#009c00">&#34;TextValue option title&#34;</span>, <span style="color:#009c00">&#34;TextValue option description&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a3 = a:option(MultiValue , <span style="color:#009c00">&#34;MultiValue_option_name&#34;</span>,<span style="color:#009c00">&#34;MultiValue  option title&#34;</span>, <span style="color:#009c00">&#34;MultiValue  option description&#34;</span>);
</span></span><span style="display:flex;"><span>a3:value(<span style="color:#009c00">&#34;0&#34;</span>, translate(<span style="color:#009c00">&#34;value0&#34;</span>));
</span></span><span style="display:flex;"><span>a3:value(<span style="color:#009c00">&#34;1&#34;</span>, translate(<span style="color:#009c00">&#34;value1&#34;</span>));
</span></span><span style="display:flex;"><span>a3:value(<span style="color:#009c00">&#34;2&#34;</span>, translate(<span style="color:#009c00">&#34;value2&#34;</span>));
</span></span><span style="display:flex;"><span>a3:value(<span style="color:#009c00">&#34;3&#34;</span>, translate(<span style="color:#009c00">&#34;value3&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a4 = a:option(DummyValue , <span style="color:#009c00">&#34;DummyValue_option_name&#34;</span>,<span style="color:#009c00">&#34;DummyValue option title&#34;</span>, <span style="color:#009c00">&#34;DummyValue option description&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a5 = a:option(ListValue, <span style="color:#009c00">&#34;Listvalue_option_name&#34;</span>,<span style="color:#009c00">&#34;ListValue option title&#34;</span>, <span style="color:#009c00">&#34;ListValue option description&#34;</span>);
</span></span><span style="display:flex;"><span>a5:value(<span style="color:#009c00">&#34;0&#34;</span>, translate(<span style="color:#009c00">&#34;value0&#34;</span>));
</span></span><span style="display:flex;"><span>a5:value(<span style="color:#009c00">&#34;1&#34;</span>, translate(<span style="color:#009c00">&#34;value1&#34;</span>));
</span></span><span style="display:flex;"><span>a5:value(<span style="color:#009c00">&#34;2&#34;</span>, translate(<span style="color:#009c00">&#34;value2&#34;</span>));
</span></span><span style="display:flex;"><span>a5:value(<span style="color:#009c00">&#34;3&#34;</span>, translate(<span style="color:#009c00">&#34;value3&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a6 = a:option(DynamicList, <span style="color:#009c00">&#34;DynamicList_option_name&#34;</span>,<span style="color:#009c00">&#34;Dynamiclist option title&#34;</span>, <span style="color:#009c00">&#34;DynamicList option description&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a7 = a:option(StaticList, <span style="color:#009c00">&#34;StaticList_option_name&#34;</span>,<span style="color:#009c00">&#34;StaticList option title&#34;</span>, <span style="color:#009c00">&#34;StaticList option description&#34;</span>);
</span></span><span style="display:flex;"><span>a7:value(<span style="color:#009c00">&#34;0&#34;</span>, translate(<span style="color:#009c00">&#34;value0&#34;</span>));
</span></span><span style="display:flex;"><span>a7:value(<span style="color:#009c00">&#34;1&#34;</span>, translate(<span style="color:#009c00">&#34;value1&#34;</span>));
</span></span><span style="display:flex;"><span>a7:value(<span style="color:#009c00">&#34;2&#34;</span>, translate(<span style="color:#009c00">&#34;value2&#34;</span>));
</span></span><span style="display:flex;"><span>a7:value(<span style="color:#009c00">&#34;3&#34;</span>, translate(<span style="color:#009c00">&#34;value3&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a8 = a:option(Flag, <span style="color:#009c00">&#34;Flag_option_name&#34;</span>,<span style="color:#009c00">&#34;Flag option title&#34;</span>, <span style="color:#009c00">&#34;Flag option description&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a9 = a:option(Button, <span style="color:#009c00">&#34;Button_option_name&#34;</span>,<span style="color:#009c00">&#34;Button option title&#34;</span>, <span style="color:#009c00">&#34;Button option description&#34;</span>);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>b = m:section(TypedSection, <span style="color:#009c00">&#34;typedsection2_title&#34;</span>, <span style="color:#009c00">&#34;typedsection2 description&#34;</span>)
</span></span><span style="display:flex;"><span>b:tab(<span style="color:#009c00">&#34;tab1&#34;</span>, <span style="color:#009c00">&#34;Tab1&#34;</span>);
</span></span><span style="display:flex;"><span>b:tab(<span style="color:#009c00">&#34;tab2&#34;</span>, <span style="color:#009c00">&#34;Tab2&#34;</span>);
</span></span><span style="display:flex;"><span>b1=b:taboption(<span style="color:#009c00">&#34;tab1&#34;</span>, Value, <span style="color:#009c00">&#34;tab1_option1&#34;</span>, <span style="color:#009c00">&#34;tab1 Option1&#34;</span>);
</span></span><span style="display:flex;"><span>b2=b:taboption(<span style="color:#009c00">&#34;tab2&#34;</span>, Value, <span style="color:#009c00">&#34;tab2_option2&#34;</span>, <span style="color:#009c00">&#34;tab2 Option2&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">return</span> m	
</span></span></code></pre></div><ul>
<li><strong>（3）UCI 文件中配置信息</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>config typedsection1_title <span style="color:#009c00">&#39;typedsection1&#39;</span>
</span></span><span style="display:flex;"><span>        option Value_option_name <span style="color:#009c00">&#39;Value&#39;</span>
</span></span><span style="display:flex;"><span>        option TextValue_option_name <span style="color:#009c00">&#39;TextValue&#39;</span>
</span></span><span style="display:flex;"><span>        option DummyValue_option_name <span style="color:#009c00">&#39;DummyValue&#39;</span>
</span></span><span style="display:flex;"><span>        option Listvalue_option_name <span style="color:#009c00">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>        list DynamicList_option_name <span style="color:#009c00">&#39;DynamicList&#39;</span>
</span></span><span style="display:flex;"><span>        list DynamicList_option_name <span style="color:#009c00">&#39;123123&#39;</span>
</span></span><span style="display:flex;"><span>        option Flag_option_name <span style="color:#009c00">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>        option MultiValue_option_name <span style="color:#009c00">&#39;0 1 2 3&#39;</span>
</span></span><span style="display:flex;"><span>        list StaticList_option_name <span style="color:#009c00">&#39;0&#39;</span>
</span></span><span style="display:flex;"><span>        list StaticList_option_name <span style="color:#009c00">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>        list StaticList_option_name <span style="color:#009c00">&#39;2&#39;</span>
</span></span><span style="display:flex;"><span>        list StaticList_option_name <span style="color:#009c00">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config typedsection2_title <span style="color:#009c00">&#39;typedsection2&#39;</span>
</span></span><span style="display:flex;"><span>        option tab1_option1 <span style="color:#009c00">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>        option tab2_option2 <span style="color:#009c00">&#39;2&#39;</span>
</span></span></code></pre></div><h4 id="32-网上实例参考">3.2 网上实例参考</h4>
<p>例程详情参考 <a href="https://github.com/openwrt/luci/wiki/ModulesHowTo">https://github.com/openwrt/luci/wiki/ModulesHowTo</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span> 1 m = Map(<span style="color:#009c00">&#34;network&#34;</span>, <span style="color:#009c00">&#34;Network&#34;</span>) <span style="color:#f00;font-style:italic">-- We want to edit the uci config file /etc/config/network </span>
</span></span><span style="display:flex;"><span> 2 s = m:section(TypedSection, <span style="color:#009c00">&#34;interface&#34;</span>, <span style="color:#009c00">&#34;Interfaces&#34;</span>) <span style="color:#f00;font-style:italic">-- Especially the &#34;interface&#34;-sections</span>
</span></span><span style="display:flex;"><span> 3 s.addremove = <span style="color:#00f">true</span> <span style="color:#f00;font-style:italic">-- Allow the user to create and remove the interfaces</span>
</span></span><span style="display:flex;"><span> 4 <span style="color:#00f">function</span> <span style="color:#007575">s</span>:<span style="color:#c34e00">filter</span>(value)  
</span></span><span style="display:flex;"><span> 5      <span style="color:#00f">return</span> value ~= <span style="color:#009c00">&#34;loopback&#34;</span> and value <span style="color:#f00;font-style:italic">-- Don&#39;t touch loopback</span>
</span></span><span style="display:flex;"><span> 6 <span style="color:#00f">end</span> s:depends(<span style="color:#009c00">&#34;proto&#34;</span>, <span style="color:#009c00">&#34;static&#34;</span>) <span style="color:#f00;font-style:italic">-- Only show thosewith&#34;static&#34;</span>
</span></span><span style="display:flex;"><span> 7 s:depends(<span style="color:#009c00">&#34;proto&#34;</span>, <span style="color:#009c00">&#34;dhcp&#34;</span>) <span style="color:#f00;font-style:italic">-- or &#34;dhcp&#34; as protocol and leave PPPoE and PPTP alone </span>
</span></span><span style="display:flex;"><span> 8 
</span></span><span style="display:flex;"><span> 9 p = s:option(ListValue, <span style="color:#009c00">&#34;proto&#34;</span>, <span style="color:#009c00">&#34;Protocol&#34;</span>) <span style="color:#f00;font-style:italic">-- Creates an element list (select box)</span>
</span></span><span style="display:flex;"><span>10 p:value(<span style="color:#009c00">&#34;static&#34;</span>, <span style="color:#009c00">&#34;static&#34;</span>) <span style="color:#f00;font-style:italic">-- Key and value pairs</span>
</span></span><span style="display:flex;"><span>11 p:value(<span style="color:#009c00">&#34;dhcp&#34;</span>, <span style="color:#009c00">&#34;DHCP&#34;</span>)
</span></span><span style="display:flex;"><span>12 p.default = <span style="color:#009c00">&#34;static&#34;</span> 
</span></span><span style="display:flex;"><span>13 
</span></span><span style="display:flex;"><span>14 s:option(Value, <span style="color:#009c00">&#34;ifname&#34;</span>, <span style="color:#009c00">&#34;interface&#34;</span>, <span style="color:#009c00">&#34;the physical interface to be used&#34;</span>) <span style="color:#f00;font-style:italic">-- This will give a simple textbox </span>
</span></span><span style="display:flex;"><span>15 
</span></span><span style="display:flex;"><span>16 s:option(Value, <span style="color:#009c00">&#34;ipaddr&#34;</span>, translate(<span style="color:#009c00">&#34;IP Address&#34;</span>)) <span style="color:#f00;font-style:italic">-- Ja, das ist eine i18n-Funktion ;-) </span>
</span></span><span style="display:flex;"><span>17 
</span></span><span style="display:flex;"><span>18 s:option(Value, <span style="color:#009c00">&#34;netmask&#34;</span>, <span style="color:#009c00">&#34;Netmask&#34;</span>):depends(<span style="color:#009c00">&#34;proto&#34;</span>, <span style="color:#009c00">&#34;static&#34;</span>) <span style="color:#f00;font-style:italic">-- You may remember this &#34;depends&#34; function from above </span>
</span></span><span style="display:flex;"><span>19 
</span></span><span style="display:flex;"><span>20 mtu = s:option(Value, <span style="color:#009c00">&#34;mtu&#34;</span>, <span style="color:#009c00">&#34;MTU&#34;</span>)
</span></span><span style="display:flex;"><span>21 mtu.optional = <span style="color:#00f">true</span> <span style="color:#f00;font-style:italic">-- This one is very optional </span>
</span></span><span style="display:flex;"><span>22 dns = s:option(Value, <span style="color:#009c00">&#34;dns&#34;</span>, <span style="color:#009c00">&#34;DNS-Server&#34;</span>)
</span></span><span style="display:flex;"><span>23 dns:depends(<span style="color:#009c00">&#34;proto&#34;</span>, <span style="color:#009c00">&#34;static&#34;</span>)
</span></span><span style="display:flex;"><span>24 dns.optional = <span style="color:#00f">true</span>
</span></span><span style="display:flex;"><span>25 <span style="color:#00f">function</span> <span style="color:#007575">dns</span>:<span style="color:#c34e00">validate</span>(value) <span style="color:#f00;font-style:italic">-- Now, that&#39;s nifty, eh?</span>
</span></span><span style="display:flex;"><span>26     <span style="color:#00f">return</span> value:match(<span style="color:#009c00">&#34;[0-9]+</span>\<span style="color:#009c00">.[0-9]+</span>\<span style="color:#009c00">.[0-9]+</span>\<span style="color:#009c00">.[0-9]+&#34;</span>) <span style="color:#f00;font-style:italic">-- Returns nil if it doesn&#39;t match otherwise returns match</span>
</span></span><span style="display:flex;"><span>27 <span style="color:#00f">end</span> 
</span></span><span style="display:flex;"><span>28 
</span></span><span style="display:flex;"><span>29 gw = s:option(Value, <span style="color:#009c00">&#34;gateway&#34;</span>, <span style="color:#009c00">&#34;Gateway&#34;</span>)
</span></span><span style="display:flex;"><span>30 gw:depends(<span style="color:#009c00">&#34;proto&#34;</span>, <span style="color:#009c00">&#34;static&#34;</span>)
</span></span><span style="display:flex;"><span>31 gw.rmempty = <span style="color:#00f">true</span> <span style="color:#f00;font-style:italic">-- Remove entry if it is empty </span>
</span></span><span style="display:flex;"><span>32 
</span></span><span style="display:flex;"><span>33 <span style="color:#00f">return</span> m <span style="color:#f00;font-style:italic">-- Returns the map</span>
</span></span></code></pre></div><ul>
<li>更多 CBI 例程可以参考 <code>openwrt源码/feeds/luci/modules/xxx模块/luasrc/model/cbi/</code> 目录下的相关文件，结合网页界面去阅读相关源码，学习提高。</li>
</ul>
<h3 id="四结尾">四、结尾</h3>
<h4 id="41-总结反思">4.1 总结&amp;反思</h4>
<ul>
<li>TypedSection与NamedSection的运用场景与区别？</li>
<li>Openwrt源码中提到的SimpleForm的效果是如何的？</li>
<li>每个控件属性对每个控件的影响是怎么样，效果如何？哪些属性是所有控件共同的，哪些属性是独有？</li>
<li>如何重构控件方法？</li>
<li>控件未列出的属性或方法在哪些途径能获取到？</li>
</ul>
<h4 id="42-资料参考">4.2 资料参考</h4>
<p>文档参考： <a href="https://github.com/openwrt/luci/wiki/CBI">https://github.com/openwrt/luci/wiki/CBI</a>
博客参考：https://blog.csdn.net/qq_21949217/article/details/44340261</p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/openwrt" rel="tag" title="OpenWrt">#OpenWrt#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/21/openwrt-luci-uci%E4%B8%89/" rel="next" title="Openwrt LuCI UCI（三）">
        <i class="fa fa-chevron-left"></i> Openwrt LuCI UCI（三）
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2022/10/21/pushing-a-branch-to-bitbucket-fails-with-the-error-refspec-matches-more-than-one./" rel="prev" title="Pushing a branch to Bitbucket fails with the error, &#34;refspec matches more than one&#34;.">
        Pushing a branch to Bitbucket fails with the error, &#34;refspec matches more than one&#34;. <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="" />
    <p class="site-author-name" itemprop="name"></p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
        <a href="http://shanks.link/post/">
            <span class="site-state-item-name">日志</span>
        </a>
    </div>
    <div class="site-state-item site-state-categories">
        <a href="http://shanks.link/categories/">
            <span class="site-state-item-name">分类</span>
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
            <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>

      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2025</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>