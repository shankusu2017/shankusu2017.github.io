<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>P4编程理论与实践——实践篇 - Golang编程语言知识介绍</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="P4编程理论与实践——实践篇">
    <meta property="og:site_name" content="Golang编程语言知识介绍">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="P4编程理论与实践——实践篇 - Golang编程语言知识介绍" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang编程语言知识介绍</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />思考
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ebpf/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />ebpf
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/p4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />p4
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/dns/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />DNS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/ftp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />FTP
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2023/09/06/p4%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%AE%9E%E8%B7%B5%E7%AF%87/" itemprop="url">
        P4编程理论与实践——实践篇
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2023-09-06">
    2023-09-06
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/p4" itemprop="url" rel="index">
        <span itemprop="name">p4</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">5875 字 ~12分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <h2 id="本文内容简介">本文内容简介</h2>
<p>本文首先向大家简单介绍在学习P4过程中需要用到的工具。<strong>本文的主要特色是让对P4感兴趣的大家不费吹灰之力的在工作，学习之余，快速搭建完善的P4实验环境并开始第一个P4实验。<strong>本文的更新日期是</strong>2018年10月8日</strong>，使用相对于大多数教程来说较新的P4环境，本文提供两种搭建环境的方法，它们的特点如下：</p>
<ul>
<li>虚拟机安装：一个完整的p4教学环境，无需手动搭建环境。
<ul>
<li>优点： 方便，快捷，对操作系统没什么要求。</li>
<li>缺点：运行较慢。</li>
<li>如果工作环境没有Linux系统，建议使用VM。</li>
</ul>
</li>
<li>真机搭建：
<ul>
<li>优点：运行速率快，环境较新。</li>
<li>缺点：可能会遇到错误，需要一个ubuntu系统。</li>
<li>不用担心费神的环境搭建，本文将提供一个一键搭建环境的脚本。这个脚本通过了我多次测试。</li>
</ul>
</li>
</ul>
<h2 id="实验环境介绍">实验环境介绍</h2>
<ul>
<li>操作系统: Ubuntu 16.04 LTS 64位 桌面版</li>
<li>python : 2.7.12</li>
<li>推荐内存: 4G 以上</li>
</ul>
<h2 id="各个组件简介">各个组件简介</h2>
<p>主要需要安装<strong>5</strong>个组件:</p>
<ul>
<li>bmv2</li>
<li>p4c</li>
<li>mininet</li>
<li>p4-tutorial</li>
<li>PI</li>
</ul>
<p>首先要明白他们各自的作用【图片来源于p4.org】:</p>
<p><a href="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu1.jpg"><img src="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu1.jpg" alt="img"></a></p>
<p>如图，我们写好xxx.p4代码，通过 <strong>p4c</strong> 这个 <strong>p4 compiler</strong> 将p4代码编译成为p4交换机可以理解的各种”机器代码”。如果目标交换机是 <strong>bmv2</strong> , 那么p4c将生成 .json文件。</p>
<ul>
<li>p4c是一款 p4编译器。</li>
<li>BMv2是支持P4编程的软件交换机。</li>
<li>PI是P4 runtime的实现，用于Control Plane对数据平面的控制。</li>
<li>mininet的功能是构建一个虚拟的网络拓扑。 它通过linux内核的一些特性(net命名空间)，在一个主机上划分出多个虚拟网络空间，各个网络空间之间相互隔离，有自己的端口, ip等等。mininet让一个或者多个vhost（虚拟主机）, 软件交换机(如ovs, bmv2)等 以进程的状态分别绑定在这些网络空间之中，共同构成一个进程级别的虚拟网络拓扑。需要注意的是这些进程级别的主机和交换机他们只是网络上的隔离，而文件系统则是共享主机的文件系统。</li>
<li>p4 tutorials 提供了用于学习的实例代码，它提供了很多个带有方向性的实际场景，例如负载均衡，简单的隧道机制，源路由等。并且它事先写好了控制面代码，让p4的初学者可以集中注意力在数据面编程的学习之上。</li>
<li>scapy是一个python库，提供构建数据包，抓包，解析包等功能。它功能强大，但是效率很低。由于P4编程中经常会引入各种各样的数据包，有些甚至是开发者自定义的数据包格式。所以我们可以利用scapy进行便捷的组包，发包。如果需要高速率的发包和解析包就不能使用scapy了。</li>
</ul>
<h1 id="搭建环境">搭建环境</h1>
<p>搭建环境有两条路可以走：</p>
<ul>
<li>使用环境健全的虚拟机，如果朋友们手边没有linux环境，或者希望快速上手开发，建议采取这种方式。</li>
<li>在真机中（我这里时Ubuntu16.04）搭建。建议环境与我相同，否则可能会出现各种意想不到的问题。</li>
</ul>
<h2 id="方法一-虚拟机套件">方法一： 虚拟机套件</h2>
<ul>
<li>官方提供了用于学习的虚拟机，里面有完整的环境。可以尝试访问<a href="https://drive.google.com/uc?id=1f22-DYlUV33DsR88_MeMb4s7-1NX_ams&amp;export=download">官网链接</a>，翻墙警告。如果不能访问外网，可以尝试访问我这个1Core, 1M带宽的服务器[资源](ftp://118.25.136.129/hox/P4 Tutorial 2018-06-01.ova)</li>
<li>官方的环境似乎比较陈旧，我利用方法二在虚拟机中搭建了一个环境，并且导出供大家使用，下面是下载链接：
<ul>
<li><a href="ftp://118.25.136.129/hox/P4-Suite2018.ova">FTP服务器下载</a>， 这个是一个云主机，如果过期或者服务器崩溃, 联系我去修复。</li>
<li>如果FTP服务器崩溃，建议自己装一个Ubuntu16.04的虚拟机，然后调用方法二，其实也很简单。</li>
<li>这里还有一个腾讯微云的链接: <a href="https://share.weiyun.com/581m3WN">https://share.weiyun.com/581m3WN</a></li>
</ul>
</li>
</ul>
<h2 id="方法二-真机搭建">方法二： 真机搭建</h2>
<p>真机搭建需要获得各个组件的源码，然后编译安装，可能遇到各个组件之间的版本兼容性，依赖性等问题。</p>
<p><strong>本来打算一步一步写出手动搭建的步骤</strong>，但过程比较痛苦，为了防止让大家陷入搭建环境这种苦涩且收益不大的环节，本文按照p4 tutorials中vagrant用于构建虚拟机环境的脚本，进行了适当修改后，最终改成一个搭建真机P4实验环境的脚本。通过这个脚本，可以方便的让大家搭建好P4学习环境，该脚本通过了本人多次测试。</p>
<p>建议在网络环境较好的环境下执行脚本，如果能使用国外的代理就更好了，如果网速较慢，建议晚上睡觉前执行，然后天亮后再瞅瞅，毕竟国内访问github有时真的太慢了。</p>
<p>相关脚本已经上传至<a href="https://github.com/zenhox/p4-quick">p4-quick</a> 。</p>
<h3 id="在搭建之前">在搭建之前</h3>
<p>为了不破坏原环境的整洁性，我们还是在home目录下创建一个P4的工作目录，并且加入环境变量:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir ~/P4
cd ~/P4
echo <span style="color:#009c00">&#34;P4_HOME=</span><span style="color:#00f">$(</span>pwd<span style="color:#00f">)</span><span style="color:#009c00">&#34;</span> &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre></div><p>在运行脚本之前，先核实一下必要的环境和依赖：</p>
<ul>
<li>发行版: Ubuntu 16.04 Desktop LTS ， 通过 <code>lsb_release -a</code>查看。</li>
<li>Python: 2.7.12， 通过 <code>python --version</code>查看。</li>
<li>内核: 4.15.0-29-generic ， 通过 <code>uanme -a</code>查看，差不多即可。</li>
</ul>
<h3 id="开始搭建">开始搭建</h3>
<p>先安装一些依赖:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get update
 
sudo apt-get install automake cmake libjudy-dev libpcap-dev libboost-dev libboost-test-dev libboost-program-options-dev libboost-system-dev libboost-filesystem-dev libboost-thread-dev libevent-dev libtool flex bison pkg-config g++ libssl-dev  -y
 
sudo apt-get install cmake g++ git automake libtool libgc-dev bison flex libfl-dev libgmp-dev libboost-dev libboost-iostreams-dev libboost-graph-dev llvm pkg-config python python-scapy python-ipaddr python-ply tcpdump curl  -y
 
sudo apt-get install libreadline6 libreadline6-dev  python-pip  -y 
 
sudo pip install psutil
sudo pip install crcmod
</code></pre></div><p>然后创建一个文件，用于存放搭建环境的脚本:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd $P4_HOME  
touch env_up.sh
chmod +x env_up.sh
</code></pre></div><p>然后将以下内容，复制到 <strong>env_up.sh</strong>文件当中:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f00;font-style:italic">#!/bin/bash
</span><span style="color:#f00;font-style:italic"></span><span style="color:#f00;font-style:italic">##############################################################</span>
<span style="color:#f00;font-style:italic"># author : P4 Lang</span>
<span style="color:#f00;font-style:italic"># modified by: SEU Hox Zheng</span>
<span style="color:#f00;font-style:italic">##############################################################</span>
 
<span style="color:#f00;font-style:italic"># 打印脚本命令.</span>
set -x
<span style="color:#f00;font-style:italic"># 在有错误输出时停止.</span>
set -e
 
<span style="color:#f00;font-style:italic"># 设置相关路径和版本变量</span>
P4_HOME=$HOME/P4
BMV2_COMMIT=<span style="color:#009c00">&#34;7e25eeb19d01eee1a8e982dc7ee90ee438c10a05&#34;</span>
PI_COMMIT=<span style="color:#009c00">&#34;219b3d67299ec09b49f433d7341049256ab5f512&#34;</span>
P4C_COMMIT=<span style="color:#009c00">&#34;48a57a6ae4f96961b74bd13f6bdeac5add7bb815&#34;</span>
PROTOBUF_COMMIT=<span style="color:#009c00">&#34;v3.2.0&#34;</span>
GRPC_COMMIT=<span style="color:#009c00">&#34;v1.3.2&#34;</span>
<span style="color:#f00;font-style:italic">#获得cpu核数，与某些软件的编译选项相关</span>
NUM_CORES=<span style="color:#009c00">`</span>grep -c ^processor /proc/cpuinfo<span style="color:#009c00">`</span>
 
cd $P4_HOME
<span style="color:#f00;font-style:italic"># 安装Mininet</span>
git clone git://github.com/mininet/mininet mininet
cd mininet
sudo ./util/install.sh -nwv
cd ..
 
<span style="color:#f00;font-style:italic"># 安装Protobuf</span>
git clone https://github.com/google/protobuf.git
cd protobuf
git checkout <span style="color:#009c00">${</span>PROTOBUF_COMMIT<span style="color:#009c00">}</span>
export CFLAGS=<span style="color:#009c00">&#34;-Os&#34;</span>
export CXXFLAGS=<span style="color:#009c00">&#34;-Os&#34;</span>
export LDFLAGS=<span style="color:#009c00">&#34;-Wl,-s&#34;</span>
./autogen.sh
./configure --prefix=/usr
make -j<span style="color:#009c00">${</span>NUM_CORES<span style="color:#009c00">}</span>
sudo make install
sudo ldconfig
unset CFLAGS CXXFLAGS LDFLAGS
<span style="color:#f00;font-style:italic"># force install python module</span>
cd python
sudo python setup.py install
cd ../..
 
<span style="color:#f00;font-style:italic"># 安装gRPC</span>
git clone https://github.com/grpc/grpc.git
cd grpc
git checkout <span style="color:#009c00">${</span>GRPC_COMMIT<span style="color:#009c00">}</span>
git submodule update --init --recursive
export LDFLAGS=<span style="color:#009c00">&#34;-Wl,-s&#34;</span>
make -j<span style="color:#009c00">${</span>NUM_CORES<span style="color:#009c00">}</span>
sudo make install
sudo ldconfig
unset LDFLAGS
cd ..
<span style="color:#f00;font-style:italic"># Install gRPC Python Package</span>
sudo pip install grpcio
 
<span style="color:#f00;font-style:italic"># 安装BMv2的依赖，下面PI编译时会用到。</span>
git clone https://github.com/p4lang/behavioral-model.git
cd behavioral-model
git checkout <span style="color:#009c00">${</span>BMV2_COMMIT<span style="color:#009c00">}</span>
<span style="color:#f00;font-style:italic"># From bmv2&#39;s install_deps.sh, we can skip apt-get install.</span>
<span style="color:#f00;font-style:italic"># Nanomsg is required by p4runtime, p4runtime is needed by BMv2...</span>
tmpdir=<span style="color:#009c00">`</span>mktemp -d -p .<span style="color:#009c00">`</span>
cd <span style="color:#009c00">${</span>tmpdir<span style="color:#009c00">}</span>
bash ../travis/install-thrift.sh
bash ../travis/install-nanomsg.sh
sudo ldconfig
bash ../travis/install-nnpy.sh
cd ..
sudo rm -rf $tmpdir
cd ..
 
<span style="color:#f00;font-style:italic"># PI/P4Runtime</span>
git clone https://github.com/p4lang/PI.git
cd PI
git checkout <span style="color:#009c00">${</span>PI_COMMIT<span style="color:#009c00">}</span>
git submodule update --init --recursive
./autogen.sh
./configure --with-proto
make -j<span style="color:#009c00">${</span>NUM_CORES<span style="color:#009c00">}</span>
sudo make install
sudo ldconfig
cd ..
 
<span style="color:#f00;font-style:italic"># 安装Bmv2  </span>
cd behavioral-model
./autogen.sh
./configure --enable-debugger --with-pi
make -j<span style="color:#009c00">${</span>NUM_CORES<span style="color:#009c00">}</span>
sudo make install
sudo ldconfig
<span style="color:#f00;font-style:italic"># Simple_switch_grpc target</span>
cd targets/simple_switch_grpc
./autogen.sh
./configure --with-thrift
make -j<span style="color:#009c00">${</span>NUM_CORES<span style="color:#009c00">}</span>
sudo make install
sudo ldconfig
cd ..
cd ..
cd ..
 
<span style="color:#f00;font-style:italic"># 安装P4C，省去了check步骤（太费时间了）</span>
git clone https://github.com/p4lang/p4c
cd p4c
git checkout <span style="color:#009c00">${</span>P4C_COMMIT<span style="color:#009c00">}</span>
git submodule update --init --recursive
mkdir -p build
cd build
cmake ..
make -j<span style="color:#009c00">${</span>NUM_CORES<span style="color:#009c00">}</span>
sudo make install
sudo ldconfig
cd ..
cd ..
 
<span style="color:#f00;font-style:italic"># 最后获得p4 tutorials</span>
git clone https://github.com/p4lang/tutorials
</code></pre></div><p>保存退出脚本，然后执行这个脚本:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./env_up.sh
</code></pre></div><p>脚本开始自动为你搭建环境，如果中途遇到错误，脚本会中断，如果脚本顺利执行，那么脚本结束后，环境便搭建好了。</p>
<h1 id="进行第一个实验">进行第一个实验</h1>
<h2 id="进行实验之前">进行实验之前</h2>
<p>如果你下载的是本文提供的第二种虚拟机，或者通过脚本安装了P4环境，现在P4目录下面应该是这个样子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">P4
├── behavioral-model  <span style="color:#f00;font-style:italic">## BMv2 软件交换机</span>
├── grpc              <span style="color:#f00;font-style:italic">## 作为BMv2的依赖</span>
├── mininet           <span style="color:#f00;font-style:italic">## mininet 网络仿真</span>
├── p4c			      <span style="color:#f00;font-style:italic">## p4c 编译器</span>
├── PI                <span style="color:#f00;font-style:italic">## PI P4 runtime库</span>
├── protobuf          <span style="color:#f00;font-style:italic">## 作为依赖</span>
└── tutorials         <span style="color:#f00;font-style:italic">#### 教程目录，以及以后主要的学习，实验</span>
</code></pre></div><p>我们主要的工作目录时tutorials，其余的都是被使用的工具组件。细看tutorials:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tutorials/
├── exercises   <span style="color:#f00;font-style:italic"># 存放各种练习</span>
├── utils       <span style="color:#f00;font-style:italic"># 工具脚本目录</span>
└── vm          <span style="color:#f00;font-style:italic"># 用于vagrant构建虚拟机的目录，可以无视</span>
</code></pre></div><p>其中utils里面存放了一些用于调用各个组件(mininet, bmv2, PI, p4c)的脚本，有了这些脚本，我们可以专注于p4代码的开发，控制面的编写，以及拓扑的构建，而不需要费神去了解bmv2的启动命令，p4c的调用选项等等。具体如何使用，也是非常的简单，我们进入一个具体的例子查看:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f00;font-style:italic"># 我们切换进入 exercises/basic 这个例子</span>
basic
├── basic.p4   <span style="color:#f00;font-style:italic"># 要编写的p4代码</span>
├── build      <span style="color:#f00;font-style:italic"># 生成文件的目录</span>
├── logs       <span style="color:#f00;font-style:italic"># 日志文件， 在调试的时候真的非常重要！</span>
├── Makefile   <span style="color:#f00;font-style:italic">### 通过Makefile 来调用utils下的脚本!</span>
├── pcaps      <span style="color:#f00;font-style:italic"># 生成的pcap包，可以使用wireshark等工具来分析</span>
├── README.md  <span style="color:#f00;font-style:italic"># 详细的指导</span>
├── receive.py <span style="color:#f00;font-style:italic">## 利用scapy写的抓取和分析数据包的工具</span>
├── s1-runtime.json  <span style="color:#f00;font-style:italic">#</span>
├── s2-runtime.json  <span style="color:#f00;font-style:italic"># 在运行同时加载入交换机的控制面代码，这里有争议，稍后再谈</span>
├── s3-runtime.json  <span style="color:#f00;font-style:italic">#</span>
├── send.py    <span style="color:#f00;font-style:italic">## 利用scapy写的构建和发送数据包的工具</span>
├── solution   <span style="color:#f00;font-style:italic"># 这里有这个例子的示例代码（答案）</span>
└── topology.json  <span style="color:#f00;font-style:italic"># 描述拓扑的json文件</span>
</code></pre></div><p>可以看到，通过Makefile，我们可以调用utils下的脚本，让我们的p4代码跑起来:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">make run  <span style="color:#f00;font-style:italic"># 启动命令</span>
<span style="color:#f00;font-style:italic">### ...启动过程中的输出</span>
 
mininet&gt;  <span style="color:#f00;font-style:italic"># mininet 命令行</span>
<span style="color:#f00;font-style:italic">### ... 你的一些实验操作</span>
mininet&gt; exit  <span style="color:#f00;font-style:italic"># 退出mininet 命令行</span>
make clean <span style="color:#f00;font-style:italic"># 清理上次运行留下的缓存文件和遗留的进程，重要，否则下次运行会可能使用旧的代码。</span>
</code></pre></div><p>调用<code>make run</code>，我们可以运行当前目录下（以basic目录为例）的代码，它将执行以下几个步骤:</p>
<ul>
<li>编译basic.p4 代码，生成basic.json</li>
<li>解析topology.json， 并且构建相应的mininet仿真拓扑，按照该拓扑启动一台或者多台BMv2交换机，以及一些host</li>
<li>启动BMv2的同时会将p4代码编译产生的json文件导入</li>
<li>启动BMv2后会解析 sN-runtime.json 文件，将其载入 交换机sN流表之中</li>
<li>进入mininet命令行，同时开始记录log以及搜集pcap文件</li>
</ul>
<p>在新版本的tutorials中，载入静态流表项时采用了runtime方法，而非之前的CLI方法，我们查看一下s1-runtime.json的部分</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">....
{
      <span style="color:#009c00">&#34;table&#34;</span>: <span style="color:#009c00">&#34;MyIngress.ipv4_lpm&#34;</span>,
      <span style="color:#009c00">&#34;match&#34;</span>: {
        <span style="color:#009c00">&#34;hdr.ipv4.dstAddr&#34;</span>: [<span style="color:#009c00">&#34;10.0.1.1&#34;</span>, 32]
      },
      <span style="color:#009c00">&#34;action_name&#34;</span>: <span style="color:#009c00">&#34;MyIngress.ipv4_forward&#34;</span>,
      <span style="color:#009c00">&#34;action_params&#34;</span>: {
        <span style="color:#009c00">&#34;dstAddr&#34;</span>: <span style="color:#009c00">&#34;00:00:00:00:01:01&#34;</span>,
        <span style="color:#009c00">&#34;port&#34;</span>: 1
      }
}
....
</code></pre></div><p>这是一个json文件，可以看到，其作用是定义一个个具体的流表项，标明了流表项所处的位置，匹配域，匹配模式，动作名，以及动作参数。这些字段都依赖于我们P4代码中所自定义的流表，匹配域和动作。</p>
<h2 id="开始第一个实验basic">开始第一个实验basic</h2>
<h3 id="查看要实现的功能">查看要实现的功能</h3>
<p>查看README，里面这样介绍这个实验:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">The objective of this exercise is to write a P4 program that
implements basic forwarding. To keep things simple, we will just
implement forwarding <span style="color:#00f">for</span> IPv4.
...
</code></pre></div><p>可以看到这是一个实现转发功能的P4实例，文件剩余部分是进行实验具体的思路和指令，建议大家多多查阅README，以后就可以自己学习啦~</p>
<p>查看网络拓扑结构 topology.json：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    &#34;hosts&#34;: [
        <span style="color:#009c00">&#34;h1&#34;</span>,
        <span style="color:#009c00">&#34;h2&#34;</span>,
        <span style="color:#009c00">&#34;h3&#34;</span>
    ],
    &#34;switches&#34;: {
        &#34;s1&#34;: { &#34;runtime_json&#34; : <span style="color:#009c00">&#34;s1-runtime.json&#34;</span> },
        &#34;s2&#34;: { &#34;runtime_json&#34; : <span style="color:#009c00">&#34;s2-runtime.json&#34;</span> },
        &#34;s3&#34;: { &#34;runtime_json&#34; : <span style="color:#009c00">&#34;s3-runtime.json&#34;</span> }
    },
    &#34;links&#34;: [
        [<span style="color:#009c00">&#34;h1&#34;</span>, <span style="color:#009c00">&#34;s1&#34;</span>], [<span style="color:#009c00">&#34;s1&#34;</span>, <span style="color:#009c00">&#34;s2&#34;</span>], [<span style="color:#009c00">&#34;s1&#34;</span>, <span style="color:#009c00">&#34;s3&#34;</span>],
        [<span style="color:#009c00">&#34;s3&#34;</span>, <span style="color:#009c00">&#34;s2&#34;</span>], [<span style="color:#009c00">&#34;s2&#34;</span>, <span style="color:#009c00">&#34;h2&#34;</span>], [<span style="color:#009c00">&#34;s3&#34;</span>, <span style="color:#009c00">&#34;h3&#34;</span>]
    ]
}
</code></pre></div><p>清晰明了：这个拓扑中有3个switch，3个host，构成一个三角形的拓扑，注意到定义switches的时候，会定义载入到交换机的流表项文件”sN-runtime.json”。</p>
<p><a href="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu2.jpg"><img src="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu2.jpg" alt="img"></a></p>
<p>了解大概之后，我们开始编写basic.p4代码：</p>
<p>回忆代码要实现的功能：<strong>ip_v4转发</strong>。我们需要完成的是tutorials中的TODO部分。</p>
<p>在代码的开头, 我们得知该代码是P4_16版本，使用的是我们之前谈到的v1_model。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#f00;font-style:italic">/* -*- P4_16 -*- */</span>
<span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;core.p4&gt;</span><span style="color:#f00;font-style:italic">
</span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;v1model.p4&gt;</span><span style="color:#f00;font-style:italic">
</span></code></pre></div><p><a href="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu3.jpg"><img src="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu3.jpg" alt="img"></a></p>
<p>通过查看main回顾v1_model：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">V1Switch(
MyParser(),    <span style="color:#f00;font-style:italic">// 解析数据包，提取包头 
</span><span style="color:#f00;font-style:italic"></span>MyVerifyChecksum(),  <span style="color:#f00;font-style:italic">// 校验和验证
</span><span style="color:#f00;font-style:italic"></span>MyIngress(),   <span style="color:#f00;font-style:italic">// 输入处理
</span><span style="color:#f00;font-style:italic"></span>MyEgress(),    <span style="color:#f00;font-style:italic">// 输出处理
</span><span style="color:#f00;font-style:italic"></span>MyComputeChecksum(),  <span style="color:#f00;font-style:italic">// 计算新的校验和
</span><span style="color:#f00;font-style:italic"></span>MyDeparser()   <span style="color:#f00;font-style:italic">// 逆解析器
</span><span style="color:#f00;font-style:italic"></span>) main;
</code></pre></div><p>我们要需要完成以下几个基本的步骤，其余部分可以暂时省略。</p>
<ul>
<li>定义相关数据结构：根据需求，我们需要定义 ipv4数据包头以及其下层的以太网包头结构。</li>
<li>解析数据包：我们在此提取ipv4包头。</li>
<li>MyIngress：得到了数据包头，我们定义一个用于转发的流表，然后定义匹配域和动作。</li>
<li>MyDeparser：逆解析器</li>
<li>写好控制面代码</li>
</ul>
<h3 id="定义数据结构">定义数据结构:</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">header ethernet_t {
    macAddr_t dstAddr;   <span style="color:#f00;font-style:italic">// macAddr_t 是 typedef bit&lt;48&gt; 的自定义类型
</span><span style="color:#f00;font-style:italic"></span>    macAddr_t srcAddr;
    bit&lt;16&gt;   etherType;
}
 
header ipv4_t {
    bit&lt;4&gt;    version;
    bit&lt;4&gt;    ihl;
    bit&lt;8&gt;    diffserv;
    bit&lt;16&gt;   totalLen;
    bit&lt;16&gt;   identification;
    bit&lt;3&gt;    flags;
    bit&lt;13&gt;   fragOffset;
    bit&lt;8&gt;    ttl;
    bit&lt;8&gt;    protocol;
    bit&lt;16&gt;   hdrChecksum;
    ip4Addr_t srcAddr;
    ip4Addr_t dstAddr;
}
<span style="color:#00f">struct</span> metadata {
    <span style="color:#f00;font-style:italic">/* 这个例子用不到metadata */</span>
}
</code></pre></div><h3 id="parser-解析数据包">Parser 解析数据包</h3>
<p>parser是一个有限状态机。从 start 状态开始，每一个状态便解析一种协议，然后根据低层协议的类型字段，选择解析高一层协议的状态，然后transition到该状态解析上层协议，最后transition到accept。具体如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">parser <span style="color:#c34e00">MyParser</span>(packet_in packet,
                out headers hdr,
                inout metadata meta,
                inout standard_metadata_t standard_metadata) {
	state start {
        transition parse_ethernet;  <span style="color:#f00;font-style:italic">//转移到解析以太包头的状态
</span><span style="color:#f00;font-style:italic"></span>    }
    state parse_ethernet {
        packet.extract(hdr.ethernet);   <span style="color:#f00;font-style:italic">//根据我们定义的数据结构提取以太包头
</span><span style="color:#f00;font-style:italic"></span>        transition select(hdr.ethernet.etherType) {  <span style="color:#f00;font-style:italic">// 根据协议类型选择下一个状态
</span><span style="color:#f00;font-style:italic"></span>            <span style="color:#f00;font-style:italic">// 类似于switch
</span><span style="color:#f00;font-style:italic"></span>            0x0800: parse_ipv4;   <span style="color:#f00;font-style:italic">//如果是0x0800，则转换到parse_ipv4状态
</span><span style="color:#f00;font-style:italic"></span>            <span style="color:#00f">default</span>: accept;      <span style="color:#f00;font-style:italic">// 默认是接受，进入下一步处理
</span><span style="color:#f00;font-style:italic"></span>        }
    	state parse_ipv4 {
        	packet.extract(hdr.ipv4); <span style="color:#f00;font-style:italic">//提取ip包头
</span><span style="color:#f00;font-style:italic"></span>        	transition accept;
    	}
    }
}
</code></pre></div><h3 id="ingress">Ingress</h3>
<ul>
<li>在Ingress中，我们要实现一个转发功能，因此需要定义一个用于转发的流表：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">table ipv4_lpm {
    key = {  <span style="color:#f00;font-style:italic">//流表拥有的匹配域
</span><span style="color:#f00;font-style:italic"></span>        hdr.ipv4.dstAddr: lpm;     <span style="color:#f00;font-style:italic">// 匹配字段是数据包头的ip目的地址
</span><span style="color:#f00;font-style:italic"></span>        <span style="color:#f00;font-style:italic">// lpm 说明匹配的模式是 Longest Prefix Match，即最长前缀匹配 
</span><span style="color:#f00;font-style:italic"></span>        <span style="color:#f00;font-style:italic">// 当然还有 exact(完全匹配)， ternary(三元匹配)
</span><span style="color:#f00;font-style:italic"></span>    }
    actions = { <span style="color:#f00;font-style:italic">//流表拥有的动作类型集合
</span><span style="color:#f00;font-style:italic"></span>        ipv4_forward;    <span style="color:#f00;font-style:italic">//我们需要一个转发动作，这个需要稍后自定义
</span><span style="color:#f00;font-style:italic"></span>        drop;            <span style="color:#f00;font-style:italic">// 丢弃动作
</span><span style="color:#f00;font-style:italic"></span>        NoAction;        <span style="color:#f00;font-style:italic">// 空动作
</span><span style="color:#f00;font-style:italic"></span>    }
    size = 1024;         <span style="color:#f00;font-style:italic">//流表可以容纳多少流表项
</span><span style="color:#f00;font-style:italic"></span>    default_action = drop();  <span style="color:#f00;font-style:italic">// table miss 是丢弃动作
</span><span style="color:#f00;font-style:italic"></span>}
</code></pre></div><ul>
<li>我们需要自己实现以下几个动作:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">action <span style="color:#c34e00">drop</span>() {
    mark_to_drop();  <span style="color:#f00;font-style:italic">//内置函数，将当前数据包标记为即将丢弃的数据包
</span><span style="color:#f00;font-style:italic"></span>}
action <span style="color:#c34e00">ipv4_forward</span>(macAddr_t dstAddr, egressSpec_t port) {
    <span style="color:#f00;font-style:italic">//转发需要以下几个步骤
</span><span style="color:#f00;font-style:italic"></span>    standard_metadata.egress_spec = port;  <span style="color:#f00;font-style:italic">//即将输出的端口从参数中获取，而参数需要由控制面传递
</span><span style="color:#f00;font-style:italic"></span>    hdr.ethernet.srcAddr = hdr.ethernet.dstAddr;   <span style="color:#f00;font-style:italic">//原数据包的源地址改为目的地址
</span><span style="color:#f00;font-style:italic"></span>    hdr.ethernet.dstAddr = dstAddr;        <span style="color:#f00;font-style:italic">//目的地址改为控制面传入的新的地址
</span><span style="color:#f00;font-style:italic"></span>    hdr.ipv4.ttl = hdr.ipv4.ttl - 1;       <span style="color:#f00;font-style:italic">//ttl要减去1
</span><span style="color:#f00;font-style:italic"></span>}
</code></pre></div><h3 id="checksum-和-deparser">Checksum 和 Deparser</h3>
<p>这两个部分都有高度抽象的内置函数直接完成:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">control <span style="color:#c34e00">MyComputeChecksum</span>(inout headers  hdr, inout metadata meta) {
     apply {
	update_checksum(
	    hdr.ipv4.isValid(),
            { hdr.ipv4.version,
	      hdr.ipv4.ihl,
              hdr.ipv4.diffserv,
              hdr.ipv4.totalLen,
              hdr.ipv4.identification,
              hdr.ipv4.flags,
              hdr.ipv4.fragOffset,
              hdr.ipv4.ttl,
              hdr.ipv4.protocol,
              hdr.ipv4.srcAddr,
              hdr.ipv4.dstAddr },
            hdr.ipv4.hdrChecksum,
            HashAlgorithm.csum16);
    }
}
<span style="color:#f00;font-style:italic">// Deparser
</span><span style="color:#f00;font-style:italic"></span>control <span style="color:#c34e00">MyDeparser</span>(packet_out packet, in headers hdr) {
    apply {
        packet.emit(hdr.ethernet);  <span style="color:#f00;font-style:italic">// 这里要注意先后顺序
</span><span style="color:#f00;font-style:italic"></span>        packet.emit(hdr.ipv4);
    }
}
</code></pre></div><h3 id="写好控制面代码">写好控制面代码</h3>
<p>虽然说官方为了让大家专注于数据面编程，已经给好了控制面指令，但是我们有必要查看一下他们，从而有了更深入的理解, 查看 s[1,2,3]-runtime.json， 里面定义了很多流表项。以s1-runtime.json为例, 具体的一条流表项为：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
      &#34;table&#34;: <span style="color:#009c00">&#34;MyIngress.ipv4_lpm&#34;</span>,   
      &#34;match&#34;: {
        &#34;hdr.ipv4.dstAddr&#34;: [<span style="color:#009c00">&#34;10.0.1.1&#34;</span>, 32]
      },
      &#34;action_name&#34;: <span style="color:#009c00">&#34;MyIngress.ipv4_forward&#34;</span>,
      &#34;action_params&#34;: {
        &#34;dstAddr&#34;: <span style="color:#009c00">&#34;00:00:00:00:01:01&#34;</span>,
        &#34;port&#34;: 1
      }
}
</code></pre></div><p>回想，table name 就是我们在p4代码中自定义的转发表。匹配域也依照了我们自定义的代码。而动作也按照我们编写的动作代码传入了相应的参数。将所有的流表项汇总一下, 我绘制了下面的图片:</p>
<p><a href="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu4.jpg"><img src="https://img1.sdnlab.com/wp-content/uploads/2018/10/p4tu4.jpg" alt="img"></a></p>
<p>看到这一步，我们便了然了。数据面定义了转发表，而控制面下发了具体匹配转发的流表项，使得这三个主机可以互通。而在控制面下发的流表项与我们p4代码中定义的流表结构息息相关。</p>
<h3 id="运行代码">运行代码</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">make run
...
...
minint&gt; pingall   <span style="color:#f00;font-style:italic">## 进行一次pingall 测试</span>
*** Ping: testing ping reachability
h1 -&gt; h2 h3 
h2 -&gt; h1 h3 
h3 -&gt; h1 h2 
*** Results: 0% dropped (6/6 received)
</code></pre></div><p>丢包率为0，说明转发功能实现了。这样我们完成了第一个实验。</p>
<h3 id="一点建议">一点建议</h3>
<ul>
<li>初次接触mininet的朋友，建议先学习mininet官方的<a href="http://mininet.org/walkthrough/">walkthrogh</a>。</li>
<li>p4 tutorials exercises中的README写的非常详细，大家可以自己完成后面的一些练习。</li>
</ul>
<h1 id="总结">总结</h1>
<p>本文提供给大家最快捷的方式去体验，学习和使用P4。其中有方便的虚拟机直接使用，也有真机搭建的脚本。搭建好环境并且开始第一个实验后，大家可以自己专注于P4的学习啦。</p>
<p>第一次写文章，而且限于本人能力有限。难免有纰漏或者理解不当，还望各位谅解，如果能够给予批评指点，不胜感激！联系邮箱： <a href="mailto:zenhox@163.com">zenhox@163.com</a>，郑。</p>
<p><a href="https://www.fnedu.com/course/detail/d4dd54ef-3acf-4255-aeb8-bd1586fe2089//"><img src="https://img2.sdnlab.com/%E6%9C%AA%E6%9D%A5%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2/p4%E5%AE%9E%E6%88%98%E7%89%B9%E8%AE%AD%E8%90%A5%20%E7%AC%AC18%E6%9C%9F920x1401.png" alt="img"></a></p>
<ul>
<li>本站原创文章仅代表作者观点，不代表SDNLAB立场。所有原创内容版权均属SDNLAB，欢迎大家转发分享。但未经授权，严禁任何媒体（平面媒体、网络媒体、自媒体等）以及微信公众号复制、转载、摘编或以其他方式进行使用，转载须注明来自 SDNLAB并附上本文链接。 本站中所有编译类文章仅用于学习和交流目的，编译工作遵照 CC 协议，如果有侵犯到您权益的地方，请及时联系我们。</li>
<li>本文链接**：**<a href="https://www.sdnlab.com/22512.html">https://www.sdnlab.com/22512.html</a></li>
</ul>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/p4" rel="tag" title="p4">#p4#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2023/09/06/p4%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/" rel="next" title="P4语言详解">
        <i class="fa fa-chevron-left"></i> P4语言详解
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2023/09/06/p4%E7%BC%96%E7%A8%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E7%90%86%E8%AE%BA%E7%AF%87/" rel="prev" title="P4编程理论与实践——理论篇">
        P4编程理论与实践——理论篇 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
        <a href="http://shanks.link/post/">
            <span class="site-state-item-name">日志</span>
        </a>
    </div>
    <div class="site-state-item site-state-categories">
        <a href="http://shanks.link/categories/">
            <span class="site-state-item-name">分类</span>
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
            <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>

      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2023</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>