<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>How to Use Websockets in go - Golang编程语言知识介绍</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="How to Use Websockets in go">
    <meta property="og:site_name" content="Golang编程语言知识介绍">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="How to Use Websockets in go - Golang编程语言知识介绍" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Golang编程语言知识介绍</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/life/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />life
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/food/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />food
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/todo/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />todo
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />思考
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/tcpip/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />TCP/IP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ebpf/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />ebpf
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/p4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />p4
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/ipsec/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IPSec
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/l2tp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />L2TP
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/dns/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />DNS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/distributed/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />distributed
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E9%B8%9F%E5%93%A5%E7%9A%84%E7%A7%81%E6%88%BF%E8%8F%9C/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />鸟哥的私房菜
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/finance/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />投资
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/ftp/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />FTP
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/04/03/how-to-use-websockets-in-go/" itemprop="url">
        How to Use Websockets in go
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-04-03">
    2021-04-03
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/go" itemprop="url" rel="index">
        <span itemprop="name">go</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">3271 字 ~7分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p><a href="https://yalantis.com/blog/how-to-build-websockets-in-go/">原文链接</a></p>
<p>Sending a message and getting an instant response without refreshing the page is something we take for granted. But in the past, enabling real-time functionality was a real challenge for developers. The developer community has come a long way from HTTP long polling and AJAX and has finally found a solution for building truly real-time apps.</p>
<p>This solution comes in the form of WebSockets, which make it possible to open an interactive session between a user’s browser and a server. WebSockets allow a browser to send messages to a server and receive event-driven responses without having to poll the server for a reply.</p>
<p>For now, WebSockets are the number one solution for building real-time applications: online games, instant messengers, tracking apps, and so on. This guide explains how WebSockets operate and shows how we can build WebSocket applications in Go programming language. We also compare the most popular WebSocket libraries so you can choose the best one for your needs.</p>
<p>Read also: Best Practices for Speeding Up JSON Encoding and Decoding in Go</p>
<p>Network sockets vs WebSockets
Getting started with WebSockets in go, let’s draw the line between network sockets and WebSockets.</p>
<p>Network socket
A network socket, or simply a socket, serves as an internal endpoint for exchanging data between applications running on the same computer or on different computers on the same network.</p>
<p>Sockets are a key part of Unix and Windows-based operating systems, and they make it easier for developers to create network-enabled software. Instead of constructing network connections from scratch, app developers can include sockets in their programs. Since network sockets are used for a number of different network protocols (HTTP, FTP, etc.), several sockets can be used simultaneously.</p>
<p>Sockets are created and used with a set of function calls, which are sometimes referred to as a socket’s application programming interface (API). Thanks to function calls, sockets can be opened just like regular files.</p>
<p>There are several types of network sockets:</p>
<p>Datagram sockets (SOCK_DGRAM), also known as connectionless sockets, use the User Datagram Protocol (UDP). Datagram sockets support a bidirectional flow of messages and preserve record boundaries.</p>
<p>Stream sockets (SOCK_STREAM), also known as connection-oriented sockets, use the Transmission Control Protocol (TCP), Stream Control Transmission Protocol (SCTP), or Datagram Congestion Control Protocol (DCCP). These sockets provide a bidirectional, reliable, sequenced, and unduplicated flow of data with no record boundaries.</p>
<p>Raw sockets (or raw IP sockets) are typically available in routers and other networking equipment. These sockets are normally datagram-oriented, although their exact characteristics depend on the interface provided by the protocol. Raw sockets are not used by most applications. They’re provided to support the development of new communication protocols and to provide access to more esoteric facilities of existing protocols.</p>
<p>Socket communication</p>
<p>First, let’s figure out how to ensure that every socket is unique. If they’re not, you can’t establish a reliable communication channel.</p>
<p>Giving every process a unique PID helps to deal with the problem locally. But such an approach doesn’t work over a network. To create a unique socket, we recommend using the TCP/IP protocol. With TCP/IP, the IP addresses of the network layer are unique within a given network, and the protocol and port are unique among host applications.</p>
<p>TCP and UDP are two major protocols for communicating between hosts. Let’s see how your app can connect to TCP and UDP sockets.</p>
<p>Connecting to a TCP socket</p>
<p>To establish a TCP connection, a Go client uses the DialTCP function in the net package. DialTCP returns a TCPConn object. When a connection is established, the client and server begin exchanging data: the client sends a request to the server through a TCPConn, the server parses the request and sends a response, and the TCPConn receives the response from the server.
<img src="https://img-blog.csdnimg.cn/img_convert/0f7312e570a0ed005eb75a4994939e89.png" alt="">
tcp socket</p>
<p>This connection remains valid until the client or server closes it. The functions for creating a connection are as follows:</p>
<p>Client side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>   tcpAddr, err := net.<span style="color:#c34e00">ResolveTCPAddr</span>(resolver, serverAddr)
   <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>   }
   conn, err := net.<span style="color:#c34e00">DialTCP</span>(network, <span style="color:#00f">nil</span>, tcpAddr)
   <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
           <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>   }
 
   <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    _, err = conn.<span style="color:#c34e00">Write</span>({message})
   <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>   }
 
   <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>   <span style="color:#00f">var</span> buf [{buffSize}]<span style="color:#00f">byte</span>
   _, err := conn.<span style="color:#c34e00">Read</span>(buf[0:])
   <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>   }
</code></pre></div><p>Server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>   tcpAddr, err := net.<span style="color:#c34e00">ResolveTCPAddr</span>(resolver, serverAddr)
       <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
           <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>       }
   
       listener, err := net.<span style="color:#c34e00">ListenTCP</span>(<span style="color:#009c00">&#34;tcp&#34;</span>, tcpAddr)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
    
    <span style="color:#f00;font-style:italic">// listen for an incoming connection
</span><span style="color:#f00;font-style:italic"></span>    conn, err := listener.<span style="color:#c34e00">Accept</span>()
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
    
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">if</span> _, err := conn.<span style="color:#c34e00">Write</span>({message}); err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }    
    <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    buf := make([]<span style="color:#00f">byte</span>, 512)
    n, err := conn.<span style="color:#c34e00">Read</span>(buf[0:])
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
</code></pre></div><p>Connecting to a UDP socket</p>
<p>In contrast to a TCP socket, with a UDP socket, the client just sends a datagram to the server. There’s no Accept function, since the server doesn’t need to accept a connection and just waits for datagrams to arrive.
<img src="https://img-blog.csdnimg.cn/img_convert/1bf773f01b80ed9693a4707837ff909e.png" alt="">
udp socket</p>
<p>Other TCP functions have UDP counterparts; just replace TCP with UDP in the functions above.</p>
<p>Client side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    raddr, err := net.<span style="color:#c34e00">ResolveUDPAddr</span>(<span style="color:#009c00">&#34;udp&#34;</span>, address)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
       
    conn, err := net.<span style="color:#c34e00">DialUDP</span>(<span style="color:#009c00">&#34;udp&#34;</span>, <span style="color:#00f">nil</span>, raddr)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        ....... 
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    buffer := make([]<span style="color:#00f">byte</span>, maxBufferSize)
    n, addr, err := conn.<span style="color:#c34e00">ReadFrom</span>(buffer)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
         .......            
    <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    buffer := make([]<span style="color:#00f">byte</span>, maxBufferSize)
    n, err = conn.<span style="color:#c34e00">WriteTo</span>(buffer[:n], addr)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
</code></pre></div><p>Server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    udpAddr, err := net.<span style="color:#c34e00">ResolveUDPAddr</span>(resolver, serverAddr)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
    
    conn, err := net.<span style="color:#c34e00">ListenUDP</span>(<span style="color:#009c00">&#34;udp&#34;</span>, udpAddr)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    buffer := make([]<span style="color:#00f">byte</span>, maxBufferSize)
    n, addr, err := conn.<span style="color:#c34e00">ReadFromUDP</span>(buffer)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
         .......
    <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    buffer := make([]<span style="color:#00f">byte</span>, maxBufferSize)
    n, err = conn.<span style="color:#c34e00">WriteToUDP</span>(buffer[:n], addr)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
</code></pre></div><p>What WebSockets are
The WebSocket communication protocol provides a full-duplex communication channel over a single TCP connection. In contrast to HTTPs, WebSockets don’t require you to send a request in order to get a  response. They allow for bidirectional data flows, so you can just wait for the server to respond. It will send you a message when it’s available.</p>
<p>WebSockets are a good solution for services that require continuous data exchange – for instance, instant messengers, online games, and real-time trading systems. You can find complete information about the WebSocket protocol in the RFC 6455 specification.</p>
<p>WebSocket connections are requested by browsers and are responded to by servers, after which a connection is established. This process is often called a handshake. The special kind of header in WebSockets requires only one handshake between a browser and server for establishing a connection that will remain active throughout its lifetime.</p>
<p>WebSockets solve many of the headaches of real-time web development and have several benefits over traditional HTTP:</p>
<p>The lightweight header reduces data transmission overhead.</p>
<p>Only one TCP connection is required for a single web client.</p>
<p>WebSocket servers can push data to web clients.
<img src="https://img-blog.csdnimg.cn/img_convert/dd102e118e9cb3276e5d7ef43d5b5418.png" alt="">
how websockets work</p>
<p>The WebSocket protocol is relatively simple to implement. It uses the HTTP protocol for the initial handshake. After a successful handshake, a connection is established and the WebSocket essentially uses raw TCP to read/write data.</p>
<p>This is what a client request looks like:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  GET /chat HTTP/1.1
    Host: server.example.com
    Upgrade: websocket
    Connection: Upgrade
    Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
    Sec-WebSocket-Protocol: chat, superchat
    Sec-WebSocket-Version: 13
    Origin: http://example.com
</code></pre></div><p>And here’s the server response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">    HTTP/1.1 101 Switching Protocols
    Upgrade: websocket
    Connection: Upgrade
    Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=
    Sec-WebSocket-Protocol: chat
</code></pre></div><p>How to create WebSocket app in Go
To write a simple WebSocket echo server based on the net/http library, you need to:</p>
<p>Initiate a handshake</p>
<p>Receive data frames from the client</p>
<p>Send data frames to the client</p>
<p>Close the handshake</p>
<p>First, let’s create an HTTP handler with a WebSocket endpoint:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f00;font-style:italic">// HTTP server with WebSocket endpoint
</span><span style="color:#f00;font-style:italic"></span>        <span style="color:#00f">func</span> <span style="color:#c34e00">Server</span>() {
        http.<span style="color:#c34e00">HandleFunc</span>(<span style="color:#009c00">&#34;/&#34;</span>, <span style="color:#00f">func</span>(w http.ResponseWriter, r *http.Request) {
            ws, err := <span style="color:#c34e00">NewHandler</span>(w, r)
            <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
                 <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>            }
            <span style="color:#00f">if</span> err = ws.<span style="color:#c34e00">Handshake</span>(); err != <span style="color:#00f">nil</span> {
                <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>            }
        …
</code></pre></div><p>Then initialize the WebSocket structure.</p>
<p>The initial handshake request always comes from the client. Once the server has defined a WebSocket request, it needs to reply with a handshake response.</p>
<p>Bear in mind that you can’t write the response using the http.ResponseWriter, since it will close the underlying TCP connection once you start sending the response.</p>
<p>So you need to use HTTP Hijacking. Hijacking allows you to take over the underlying TCP connection handler and bufio.Writer. This gives you the possibility to read and write data without closing the TCP connection.</p>
<p>// NewHandler initializes a new handler
func NewHandler(w http.ResponseWriter, req *http.Request) (*WS, error) {
hj, ok := w.(http.Hijacker)
if !ok {
// handle error
}                  &hellip;..
}
To complete the handshake, the server must respond with the appropriate headers.</p>
<p>// Handshake creates a handshake header
func (ws *WS) Handshake() error {</p>
<pre><code>    hash := func(key string) string {
        h := sha1.New()
        h.Write([]byte(key))
        h.Write([]byte(&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;))

    return base64.StdEncoding.EncodeToString(h.Sum(nil))
    }(ws.header.Get(&quot;Sec-WebSocket-Key&quot;))
  .....
</code></pre>
<p>}</p>
<p>“Sec-WebSocket-key” is generated randomly and is Base64-encoded. The server needs to append this key to a fixed string after accepting a request. Assume your have the x3JJHMbDL1EzLkh9GBhXDw== key. In this case, you can use SHA-1 to compute the binary value and use Base64 to encode it. You’ll get HSmrc0sMlYUkAGmm5OPpG2HaGWk=. Use this as the value of the Sec-WebSocket-Accept response header.</p>
<p>Transferring the data frame
When the handshake has been successfully completed, your app can read and write data from and to the client. The WebSocket specification defines a specific frame format that’s used between a client and server. Here is a bit pattern of the frame:
<img src="https://img-blog.csdnimg.cn/img_convert/fa7f0b60b62ea96a80fd5da17c1a8b75.png" alt="">
The bit pattern of the frame</p>
<p>Use the following code to decode the client payload:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f00;font-style:italic">// Recv receives data and returns a Frame
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">func</span> (ws *WS) <span style="color:#c34e00">Recv</span>() (frame Frame, _ <span style="color:#00f">error</span>) {
        frame = Frame{}
        head, err := ws.<span style="color:#c34e00">read</span>(2)
        <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
            <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>        }
</code></pre></div><p>In turn, these lines of code allow for encoding data:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f00;font-style:italic">// Send sends a Frame
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">func</span> (ws *WS) <span style="color:#c34e00">Send</span>(fr Frame) <span style="color:#00f">error</span> {
        <span style="color:#f00;font-style:italic">// make a slice of bytes of length 2
</span><span style="color:#f00;font-style:italic"></span>        data := make([]<span style="color:#00f">byte</span>, 2)
    
        <span style="color:#f00;font-style:italic">// Save fragmentation &amp; opcode information in the first byte
</span><span style="color:#f00;font-style:italic"></span>        data[0] = 0x80 | fr.Opcode
        <span style="color:#00f">if</span> fr.IsFragment {
            data[0] &amp;= 0x7F
        }
        .....
</code></pre></div><p>Closing a handshake
A handshake is closed when one of the parties sends a close frame with a close status as the payload. Optionally, the party sending the close frame can send a close reason in the payload. If closing is initiated by the client, the server should send a corresponding close frame in response.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f00;font-style:italic">// Close sends a close frame and closes the TCP connection
</span><span style="color:#f00;font-style:italic"></span><span style="color:#00f">func</span> (ws *Ws) <span style="color:#c34e00">Close</span>() <span style="color:#00f">error</span> {
    f := Frame{}
    f.Opcode = 8
    f.Length = 2
    f.Payload = make([]<span style="color:#00f">byte</span>, 2)
    binary.BigEndian.<span style="color:#c34e00">PutUint16</span>(f.Payload, ws.status)
    <span style="color:#00f">if</span> err := ws.<span style="color:#c34e00">Send</span>(f); err != <span style="color:#00f">nil</span> {
        <span style="color:#00f">return</span> err
    }
    <span style="color:#00f">return</span> ws.conn.<span style="color:#c34e00">Close</span>()
}
</code></pre></div><p>List of WebSocket libraries
There are several third-party libraries that ease developers’ lives and greatly facilitate working with WebSockets.</p>
<p>STDLIB ( x/net/websocket )</p>
<p>This WebSocket library is part of the standard library. It implements a client and server for the WebSocket protocol, as described in the RFC 6455 specification. It doesn’t need to be installed and has good official documentation. But on the other hand, it still lacks some features that can be found in other WebSocket libraries. Golang WebSocket implementations in the /x/net/websocket package do not allow users to reuse I/O buffers between connections in a clear way.</p>
<p>Let’s check how the STDLIB package works. Here’s an example of code for performing basic functions like creating a connection and sending and receiving messages.</p>
<p>First of all, to install and use this library, you should add this line of code to your:</p>
<p>import &ldquo;golang.org/x/net/websocket&rdquo;</p>
<p>Client side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#f00;font-style:italic">// create connection
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// schema can be ws:// or wss://
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// host, port – WebSocket server
</span><span style="color:#f00;font-style:italic"></span>    conn, err := websocket.<span style="color:#c34e00">Dial</span>(<span style="color:#009c00">&#34;{schema}://{host}:{port}&#34;</span>, <span style="color:#009c00">&#34;&#34;</span>, op.Origin)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    } 
    <span style="color:#00f">defer</span> conn.<span style="color:#c34e00">Close</span>()
             .......
      <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>        <span style="color:#00f">if</span> err = websocket.JSON.<span style="color:#c34e00">Send</span>(conn, {message}); err != <span style="color:#00f">nil</span> {
         <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
              .......
        <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// messageType initializes some type of message
</span><span style="color:#f00;font-style:italic"></span>    message := messageType{}
    <span style="color:#00f">if</span> err := websocket.JSON.<span style="color:#c34e00">Receive</span>(conn, &amp;message); err != <span style="color:#00f">nil</span> {
          <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }  
        .......
</code></pre></div><p>Server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">    // Initialize WebSocket handler + server
    mux := http.NewServeMux()
        mux.Handle(&#34;/&#34;, websocket.Handler(func(conn *websocket.Conn) {
            func() {
                for {
                
                    // do something, receive, send, etc.
                }
            }
            .......    
        // receive message
    // messageType initializes some type of message
    message := messageType{}
    if err := websocket.JSON.Receive(conn, &amp;message); err != nil {
        // handle error
    }
        .......     
    // send message
    if err := websocket.JSON.Send(conn, message); err != nil {
        // handle error
    }    
        ........ 
</code></pre></div><p>GORILLA</p>
<p>The WebSocket package in the Gorilla web toolkit boasts a complete and tested implementation of the WebSocket protocol as well as a stable package API. The WebSocket package is well-documented and easy to use. You can find documentation on the official Gorilla website.</p>
<p>Installation</p>
<p>go get github.com/gorilla/websocket
Examples of code
Client side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"> // init
    // schema – can be ws:// or wss://
    // host, port – WebSocket server  
    u := url.URL{
        Scheme: {schema},
        Host:   {host}:{port},
        Path:   &#34;/&#34;,
    }
    c, _, err := websocket.DefaultDialer.Dial(u.String(), nil)
    if err != nil {
        // handle error
    }
        .......    
    // send message
    err := c.WriteMessage(websocket.TextMessage, {message})
    if err != nil {
        // handle error
    }  
        .......      
    // receive message
    _, message, err := c.ReadMessage()
    if err != nil {
        // handle error
    }
        .......
</code></pre></div><p>Server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    u := websocket.Upgrader{}
    c, err := u.<span style="color:#c34e00">Upgrade</span>(w, r, <span style="color:#00f">nil</span>)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......    
    <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    messageType, message, err := c.<span style="color:#c34e00">ReadMessage</span>()
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......       
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    err = c.<span style="color:#c34e00">WriteMessage</span>(messageType, {message})
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......
</code></pre></div><p>Read also: What projects should you use Go for?</p>
<p>GOBWAS</p>
<p>This tiny WebSocket packahe has a powerful list of features, such as a zero-copy upgrade and a low-level API that allows for building custom packet handling logic. GOBWAS requires no intermediate allocations during I/O. It also boasts high-level wrappers and helpers around the API in the wsutil package, allowing developers to start fast without digging into the internals of the protocol. This library has a flexible API, but that comes at the cost of usability and clarity.</p>
<p>You can check the GoDoc website for the available documentation. The installation is provided by including the following line of code:</p>
<p>go get github.com/gobwas/ws</p>
<p>Client side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// schema – can be ws or wss
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// host, port – ws server
</span><span style="color:#f00;font-style:italic"></span>    conn, _, _, err := ws.DefaultDialer.<span style="color:#c34e00">Dial</span>(ctx, {schema}:<span style="color:#f00;font-style:italic">//{host}:{port})
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    err = wsutil.<span style="color:#c34e00">WriteClientMessage</span>(conn, ws.OpText, {message})
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
    
        .......
    <span style="color:#f00;font-style:italic">// receive message    
</span><span style="color:#f00;font-style:italic"></span>    msg, _, err := wsutil.<span style="color:#c34e00">ReadServerData</span>(conn)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......
</code></pre></div><p>Server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">   <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    listener, err := net.<span style="color:#c34e00">Listen</span>(<span style="color:#009c00">&#34;tcp&#34;</span>, op.Port)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
    conn, err := listener.<span style="color:#c34e00">Accept</span>()
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
    upgrader := ws.Upgrader{}
    <span style="color:#00f">if</span> _, err = upgrader.<span style="color:#c34e00">Upgrade</span>(conn); err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......
    <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">for</span> { 
         reader := wsutil.<span style="color:#c34e00">NewReader</span>(conn, ws.StateServerSide)
         _, err := reader.<span style="color:#c34e00">NextFrame</span>()
         <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
             <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>         }
         data, err := ioutil.<span style="color:#c34e00">ReadAll</span>(reader)
         <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
             <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>         }
            .......
    }   
        .......
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    msg := <span style="color:#009c00">&#34;new server message&#34;</span>
    <span style="color:#00f">if</span> err := wsutil.<span style="color:#c34e00">WriteServerText</span>(conn, {message}); err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......
</code></pre></div><p>GOWebsockets</p>
<p>This tool offers a wide range of easy-to-use features. It allows for concurrency control, data compression, and setting request headers. GoWebsockets supports proxies and subprotocols for emitting and receiving text and binary data. Developers can also enable or disable SSL verification.
You can find documentation for and examples of how to use GOWebsockets on the GoDoc website and on the project’s GitHub page. Install the package by adding the following line of code:</p>
<p>go get github.com/sacOO7/gowebsocket</p>
<p>Client side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// schema – can be ws or wss
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// host, port – ws server
</span><span style="color:#f00;font-style:italic"></span>    socket := gowebsocket.<span style="color:#c34e00">New</span>({schema}:<span style="color:#f00;font-style:italic">//{host}:{port})
</span><span style="color:#f00;font-style:italic"></span>    socket.<span style="color:#c34e00">Connect</span>()
        .......  
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    socket.<span style="color:#c34e00">SendText</span>({message})
    or
    socket.<span style="color:#c34e00">SendBinary</span>({message})
        .......
    <span style="color:#f00;font-style:italic">// receive message
</span><span style="color:#f00;font-style:italic"></span>    socket.OnTextMessage = <span style="color:#00f">func</span>(message <span style="color:#00f">string</span>, socket gowebsocket.Socket) {
        <span style="color:#f00;font-style:italic">// hande received message
</span><span style="color:#f00;font-style:italic"></span>    };
    or
    socket.OnBinaryMessage = <span style="color:#00f">func</span>(data [] <span style="color:#00f">byte</span>, socket gowebsocket.Socket) {
        <span style="color:#f00;font-style:italic">// hande received message
</span><span style="color:#f00;font-style:italic"></span>    };  
        .......  
</code></pre></div><p>Server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#f00;font-style:italic">// init
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// schema – can be ws or wss
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#f00;font-style:italic">// host, port – ws server
</span><span style="color:#f00;font-style:italic"></span>    conn, _, _, err := ws.DefaultDialer.<span style="color:#c34e00">Dial</span>(ctx, {schema}:<span style="color:#f00;font-style:italic">//{host}:{port})
</span><span style="color:#f00;font-style:italic"></span>    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......        
    <span style="color:#f00;font-style:italic">// send message
</span><span style="color:#f00;font-style:italic"></span>    err = wsutil.<span style="color:#c34e00">WriteClientMessage</span>(conn, ws.OpText, {message})
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
        .......       
    <span style="color:#f00;font-style:italic">// receive message    
</span><span style="color:#f00;font-style:italic"></span>    msg, _, err := wsutil.<span style="color:#c34e00">ReadServerData</span>(conn)
    <span style="color:#00f">if</span> err != <span style="color:#00f">nil</span> {
        <span style="color:#f00;font-style:italic">// handle error
</span><span style="color:#f00;font-style:italic"></span>    }
</code></pre></div><p>Comparing existing solutions
We’ve described four of the most widely used WebSocket libraries for Golang. The table below contains a detailed comparison of these tools.
<img src="https://img-blog.csdnimg.cn/img_convert/405ca386824aadd8950b00e1b0946c1b.png" alt="">
websocket libraries</p>
<p>To better analyze their performance, we also conducted a couple of benchmarks.</p>
<p>Read also: Monitoring the Performance of Your Go Application: Why and How You Should Do It</p>
<p>The results are the following:
<img src="https://img-blog.csdnimg.cn/img_convert/d91495feb007d97effa0bdb6a4fe677a.png" alt="">
Benchmark tests</p>
<p>As you can see, GOBWAS has a significant advantage over others libraries. It has fewer allocations per operation and uses less memory and time per allocation. Plus, it has zero I/O allocation. Besides, GOBWAS has all the methods you need to create WebSocket client–server interactions and receive message fragments. You can also use it to easily work with TCP sockets.</p>
<p>If you really don’t like GOBWAS, you can use Gorilla. It’s quite simple and has almost all the same features. You can also use STDLIB, but it’s not as good in production because it lacks many necessary features and, as you can see in the benchmarks, offers weaker performance. GOWebsocket is about the same as STDLIB. But if you need to quickly build a prototype or MVP, it can be a reasonable choice.</p>
<p>Besides these tools, there are also several alternative implementations that allow you to build powerful steaming solutions. Among them there are:</p>
<p>go-socket.io</p>
<p>Apache Thrift</p>
<p>gRPC</p>
<p>Package rpc</p>
<p>The constant development of streaming technologies and the availability of well-documented tools such as WebSockets make it easy for developers to create truly real-time applications. Write us if you need advice on or help with creating a real-time app using WebSockets. We hope, this tutorial helped you a lot.</p>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/go" rel="tag" title="go">#go#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2021/04/03/go-%E4%BD%BF%E7%94%A8protobuf/" rel="next" title="go 使用protobuf">
        <i class="fa fa-chevron-left"></i> go 使用protobuf
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2021/04/03/go%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E6%8E%A8%E8%8D%90%E4%B9%A6%E7%B1%8D/" rel="prev" title="go系统学习推荐书籍">
        go系统学习推荐书籍 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
        <a href="http://shanks.link/post/">
            <span class="site-state-item-name">日志</span>
        </a>
    </div>
    <div class="site-state-item site-state-categories">
        <a href="http://shanks.link/categories/">
            <span class="site-state-item-name">分类</span>
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
            <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>

      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2024</span>
</div>
<div>
  <a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021068940号-1</a>
  <a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302003059" rel="noopener" target="_blank">粤公网安备44011302003059</a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>