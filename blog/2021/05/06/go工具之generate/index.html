<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Go工具之generate - 愿星光伴你左右</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="Go工具之generate">
    <meta property="og:site_name" content="愿星光伴你左右">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Go工具之generate - 愿星光伴你左右" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">愿星光伴你左右</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/prose/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />散文
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/05/06/go%E5%B7%A5%E5%85%B7%E4%B9%8Bgenerate/" itemprop="url">
        Go工具之generate
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-05-06">
    2021-05-06
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/go" itemprop="url" rel="index">
        <span itemprop="name">go</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">1748 字 ~4分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <p>Go语言提供了一系列强大的工具，灵活使用这些工具，能够让我们的项目开发更加容易，工具集包含如下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">bug</span>         <span style="color:#a6e22e">start</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">bug</span> <span style="color:#a6e22e">report</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">build</span>       <span style="color:#a6e22e">compile</span> <span style="color:#a6e22e">packages</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">dependencies</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span>       <span style="color:#a6e22e">remove</span> <span style="color:#a6e22e">object</span> <span style="color:#a6e22e">files</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">cached</span> <span style="color:#a6e22e">files</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doc</span>         <span style="color:#a6e22e">show</span> <span style="color:#a6e22e">documentation</span> <span style="color:#66d9ef">for</span> <span style="color:#f92672">package</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">symbol</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">env</span>         <span style="color:#a6e22e">print</span> <span style="color:#a6e22e">Go</span> <span style="color:#a6e22e">environment</span> <span style="color:#a6e22e">information</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fix</span>         <span style="color:#a6e22e">update</span> <span style="color:#a6e22e">packages</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">use</span> <span style="color:#a6e22e">new</span> <span style="color:#a6e22e">APIs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>         <span style="color:#a6e22e">gofmt</span> (<span style="color:#a6e22e">reformat</span>) <span style="color:#f92672">package</span> <span style="color:#a6e22e">sources</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">generate</span>    <span style="color:#a6e22e">generate</span> <span style="color:#a6e22e">Go</span> <span style="color:#a6e22e">files</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">processing</span> <span style="color:#a6e22e">source</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">get</span>         <span style="color:#a6e22e">add</span> <span style="color:#a6e22e">dependencies</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">current</span> <span style="color:#a6e22e">module</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">them</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">install</span>     <span style="color:#a6e22e">compile</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">packages</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">dependencies</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">list</span>        <span style="color:#a6e22e">list</span> <span style="color:#a6e22e">packages</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">modules</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mod</span>         <span style="color:#a6e22e">module</span> <span style="color:#a6e22e">maintenance</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">run</span>         <span style="color:#a6e22e">compile</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">Go</span> <span style="color:#a6e22e">program</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">test</span>        <span style="color:#a6e22e">test</span> <span style="color:#a6e22e">packages</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tool</span>        <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">specified</span> <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">tool</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">version</span>     <span style="color:#a6e22e">print</span> <span style="color:#a6e22e">Go</span> <span style="color:#a6e22e">version</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vet</span>         <span style="color:#a6e22e">report</span> <span style="color:#a6e22e">likely</span> <span style="color:#a6e22e">mistakes</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">packages</span>
</span></span></code></pre></div><p>工具的源码位于$GOPATH/src/cmd/internal，本篇文章主要讨论Go工具generate。</p>
<p><strong>Go语言的自动化工具</strong></p>
<p>go generate常用于<strong>自动生成代码</strong>，它可以在代码编译之前根据源代码生成代码。当运行go generate时，它将扫描与当前包相关的源代码文件，找出所有包含&quot;// go:generate&quot;的注释语句，提取并执行该注释后的命令，命令为可执行程序。该过程类似于调用执行shell脚本。</p>
<p><strong>使用方法</strong></p>
<ul>
<li>添加特殊注释</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>//go:generate command argument...
</span></span></code></pre></div><ul>
<li>执行generate命令</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ go generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages]
</span></span></code></pre></div><p><strong>注意事项</strong></p>
<ul>
<li>该特殊注释必须包含在.go源码文件中。</li>
<li>每个源码文件可以包含多个generate特殊注释。</li>
<li>go generate不会被类似go build，go get，go test等命令触发执行，必须由开发者显式使用。</li>
<li>命令执行是串行的，如果出错，后续命令不再执行。</li>
<li>特殊注释必须以“//go:generate”开头，双斜线之后没有空格。</li>
<li>执行命令必须是系统PATH（echo $PATH）下的可执行程序。</li>
</ul>
<p><strong>使用示例</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//go:generate echo GoGoGo!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//go:generate go run main.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//go:generate echo $GOARCH $GOOS $GOFILE $GOLINE $GOPACKAGE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;go rum main.go!&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>执行go generate命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ go generate
</span></span><span style="display:flex;"><span>GoGoGo!
</span></span><span style="display:flex;"><span>go rum main.go!
</span></span><span style="display:flex;"><span>amd64 darwin main.go 7 main
</span></span></code></pre></div><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p><strong>为枚举常量实现String方法</strong></p>
<p>看完上述generate的简单介绍，可能读者并没有感受到该工具的强大之处，小菜刀提供一个该工具的经典应用场景：为枚举常量实现String方法。</p>
<p>这里需要提及官方的另外一个工具stringer，它可以自动为整数常量集编写String()方法。由于stringer并不在Go官方发行版的工具集里，我们需要自行安装，执行如下命令。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>go get golang.org/x/tools/cmd/stringer
</span></span></code></pre></div><p>这里引用stringer文档中的一个示例。代码如下，其定义了一组不同Pill类型的整数常量。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">painkiller</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Pill</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Placebo</span> <span style="color:#a6e22e">Pill</span> = <span style="color:#66d9ef">iota</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Aspirin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Ibuprofen</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Paracetamol</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Acetaminophen</span> = <span style="color:#a6e22e">Paracetamol</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>为了进行调试或者其他原因，我们希望这些常量能够打印出来，这意味着Pill要有一个带有签名的方法。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>func (p Pill) String() string
</span></span></code></pre></div><p>**
**</p>
<p>要实现它，非常简单。</p>
<p>**
**</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>func (p Pill) String() string {
</span></span><span style="display:flex;"><span>    switch p {
</span></span><span style="display:flex;"><span>    case Placebo:
</span></span><span style="display:flex;"><span>        return &#34;Placebo&#34;
</span></span><span style="display:flex;"><span>    case Aspirin:
</span></span><span style="display:flex;"><span>        return &#34;Aspirin&#34;
</span></span><span style="display:flex;"><span>    case Ibuprofen:
</span></span><span style="display:flex;"><span>        return &#34;Ibuprofen&#34;
</span></span><span style="display:flex;"><span>    case Paracetamol: // == Acetaminophen
</span></span><span style="display:flex;"><span>        return &#34;Paracetamol&#34;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    return fmt.Sprintf(&#34;Pill(%d)&#34;, p)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>试想，如果我们的Pill名单里新增了一批药品名，每次增加或修改药品名，在相应的签名函数里，也都需要进行更改。这样岂不是很麻烦且很可能遗漏或出错？这时，我们可以通过 go generate + stringer的方案解决该问题。很简单，只需在定义Pill的代码中，增加一句注释语句即可。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>//go:generate stringer -type=Pill
</span></span></code></pre></div><p>上面的命令，代表运行stringer工具来为Pill类型生成String方法，默认输出到pill_string.go文件中，执行如下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">generate</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#a6e22e">cat</span> <span style="color:#a6e22e">pill_string</span>.<span style="color:#66d9ef">go</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Code generated by stringer -type Pill pill.go; DO NOT EDIT.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">painkiller</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">_Pill_name</span> = <span style="color:#e6db74">&#34;PlaceboAspirinIbuprofenParacetamol&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_Pill_index</span> = [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">uint8</span>{<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">34</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">i</span> <span style="color:#a6e22e">Pill</span>) <span style="color:#a6e22e">String</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">Pill</span>(len(<span style="color:#a6e22e">_Pill_index</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Pill(%d)&#34;</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_Pill_name</span>[<span style="color:#a6e22e">_Pill_index</span>[<span style="color:#a6e22e">i</span>]:<span style="color:#a6e22e">_Pill_index</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样，每次我们对Pill类型有修改时，我们所需要做的就是运行以下语句即可。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ go generate
</span></span></code></pre></div><p>当然，你要是觉得这样麻烦，或者担心忘记执行generate语句。那么，可以将go generate语句写入Makefile之中，置于go build命令之前，实现代码生成与编译的自动化。</p>
<p>值得一提的是，在Go源码文档中，大量采用了go generate+stringer的方案实现对枚举常量的String方法。在小菜刀本机Go 1.14.1的源码下，一共有23处使用，具体如下。</p>
<p><img src="http://shanks.link/img/Go%E5%B7%A5%E5%85%B7%E4%B9%8BGenerate/1.png" alt="img"></p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p><strong>总结</strong></p>
<p>本文主要介绍generate是什么，能做什么，如果想深入理解其内在实现逻辑，可以去看Go源码中生成代码的详细过程，例如sort包下通过genzfunc.go实现zfuncversion.go的生成。在Go源码宝库中，可以找到很多相似的实现逻辑，参照如下。</p>
<p><img src="http://shanks.link/img/Go%E5%B7%A5%E5%85%B7%E4%B9%8BGenerate/2.png" alt="img"></p>
<p>它们利用Go编译器提供的库，包括定义抽象语法树的 go/ast、解析抽象语法树的go/parser、解析用于格式化代码的 go/format、用于Go词法标记的go/token等。解析源文件并按照已有的模板生成新的代码，这一过程和Web 服务中利用模板生成 HTML 文件类似。</p>
<p><strong>总结：减少代码的重复编写，保护头发！！</strong></p>
<p>**
**</p>
<p><strong>参考</strong></p>
<p><em><a href="https://golang.org/cmd/go/">https://golang.org/cmd/go/</a></em></p>
<p><em><a href="https://blog.golang.org/generate">https://blog.golang.org/generate</a></em></p>
<p><em><a href="https://godoc.org/golang.org/x/tools/cmd/stringer">https://godoc.org/golang.org/x/tools/cmd/stringer</a></em></p>
<p><em><a href="https://docs.google.com/document/d/1V03LUfjSADDooDMhe-_K59EgpTEm3V8uvQRuNMAEnjg/edit#">https://docs.google.com/document/d/1V03LUfjSADDooDMhe-_K59EgpTEm3V8uvQRuNMAEnjg/edit#</a></em></p>
<ul>
<li></li>
</ul>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/go" rel="tag" title="go">#go#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2021/05/06/go%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%99%A8%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3/" rel="next" title="Go内存分配器的核心思想">
        <i class="fa fa-chevron-left"></i> Go内存分配器的核心思想
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2021/05/06/go%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1map%E7%9A%84/" rel="prev" title="Go是如何设计Map的">
        Go是如何设计Map的 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://shanks.link/post/">
        <span class="site-state-item-count">489</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://shanks.link/categories/">      
         
        <span class="site-state-item-count">32</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
         
        <span class="site-state-item-count">37</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2022</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">愿星光伴你左右</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo v0.101.0</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>