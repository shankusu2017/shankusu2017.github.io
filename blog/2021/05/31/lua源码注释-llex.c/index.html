<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>lua源码注释-llex.c - 愿星光伴你左右</title>
    <meta name="keywords" content="git,Git,Lua,lua,Golang,go">
    
    <meta property="og:title" content="lua源码注释-llex.c">
    <meta property="og:site_name" content="愿星光伴你左右">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="lua源码注释-llex.c - 愿星光伴你左右" />
    <meta name="description" content="愿星光伴你左右"> 
    <link rel="shortcut icon" href="http://shanks.link/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://shanks.link/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://shanks.link/img/apple-touch-icon.png" />
    <link href="http://shanks.link/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://shanks.link/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://shanks.link/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">愿星光伴你左右</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://shanks.link/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/thinking/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />随想录
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/prose/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />散文
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E7%94%9F%E6%B4%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />生活
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/os/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OS
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/lua/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />lua
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/redis/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />redis
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/go/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Golang
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/c/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />C
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openvpn/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenVPN
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/web/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />web
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/openwrt/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />OpenWRT
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/%E8%BF%90%E7%BB%B4/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />运维
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/git/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />Git
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/categories/it/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />IT杂谈
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />About Me
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://shanks.link/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />友情链接
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://shanks.link/blog/2021/05/31/lua%E6%BA%90%E7%A0%81%E6%B3%A8%E9%87%8A-llex.c/" itemprop="url">
        lua源码注释-llex.c
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2021-05-31">
    2021-05-31
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://shanks.link/categories/lua" itemprop="url" rel="index">
        <span itemprop="name">lua</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">2470 字 ~5分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** $Id: llex.c,v 2.20.1.2 2009/11/23 14:58:22 roberto Exp $
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** Lexical Analyzer
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** See Copyright Notice in lua.h
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;ctype.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;locale.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&lt;string.h&gt;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#define llex_c
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#define LUA_CORE
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;lua.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;ldo.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;llex.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;lobject.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;lparser.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;lstate.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;lstring.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;ltable.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#include</span> <span style="color:#f00;font-style:italic">&#34;lzio.h&#34;</span><span style="color:#f00;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#define next(ls) (ls-&gt;current = zgetc(ls-&gt;z))
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#define currIsNewline(ls)	(ls-&gt;current == &#39;\n&#39; || ls-&gt;current == &#39;\r&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* ORDER RESERVED */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">const</span> <span style="color:#00f">char</span> *<span style="color:#00f">const</span> luaX_tokens [] = {
</span></span><span style="display:flex;"><span>    <span style="color:#009c00">&#34;and&#34;</span>, <span style="color:#009c00">&#34;break&#34;</span>, <span style="color:#009c00">&#34;do&#34;</span>, <span style="color:#009c00">&#34;else&#34;</span>, <span style="color:#009c00">&#34;elseif&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#009c00">&#34;end&#34;</span>, <span style="color:#009c00">&#34;false&#34;</span>, <span style="color:#009c00">&#34;for&#34;</span>, <span style="color:#009c00">&#34;function&#34;</span>, <span style="color:#009c00">&#34;if&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#009c00">&#34;in&#34;</span>, <span style="color:#009c00">&#34;local&#34;</span>, <span style="color:#009c00">&#34;nil&#34;</span>, <span style="color:#009c00">&#34;not&#34;</span>, <span style="color:#009c00">&#34;or&#34;</span>, <span style="color:#009c00">&#34;repeat&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#009c00">&#34;return&#34;</span>, <span style="color:#009c00">&#34;then&#34;</span>, <span style="color:#009c00">&#34;true&#34;</span>, <span style="color:#009c00">&#34;until&#34;</span>, <span style="color:#009c00">&#34;while&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#009c00">&#34;..&#34;</span>, <span style="color:#009c00">&#34;...&#34;</span>, <span style="color:#009c00">&#34;==&#34;</span>, <span style="color:#009c00">&#34;&gt;=&#34;</span>, <span style="color:#009c00">&#34;&lt;=&#34;</span>, <span style="color:#009c00">&#34;~=&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#009c00">&#34;&lt;number&gt;&#34;</span>, <span style="color:#009c00">&#34;&lt;name&gt;&#34;</span>, <span style="color:#009c00">&#34;&lt;string&gt;&#34;</span>, <span style="color:#009c00">&#34;&lt;eof&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>    NULL
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#define save_and_next(ls) (save(ls, ls-&gt;current), next(ls))
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 将c存到ls-&gt;buff中 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">save</span> (LexState *ls, <span style="color:#00f">int</span> c) {
</span></span><span style="display:flex;"><span>  Mbuffer *b = ls-&gt;buff;
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (b-&gt;n + 1 &gt; b-&gt;buffsize) {
</span></span><span style="display:flex;"><span>    size_t newsize;
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (b-&gt;buffsize &gt;= MAX_SIZET/2)
</span></span><span style="display:flex;"><span>      luaX_lexerror(ls, <span style="color:#009c00">&#34;lexical element too long&#34;</span>, 0);
</span></span><span style="display:flex;"><span>    newsize = b-&gt;buffsize * 2;
</span></span><span style="display:flex;"><span>    luaZ_resizebuffer(ls-&gt;L, b, newsize);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  b-&gt;buffer[b-&gt;n++] = cast(<span style="color:#00f">char</span>, c);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 构建出关键字 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">void</span> <span style="color:#c34e00">luaX_init</span> (lua_State *L) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">int</span> i;
</span></span><span style="display:flex;"><span>  <span style="color:#00f">for</span> (i=0; i&lt;NUM_RESERVED; i++) {
</span></span><span style="display:flex;"><span>    TString *ts = luaS_new(L, luaX_tokens[i]);
</span></span><span style="display:flex;"><span>    luaS_fix(ts);  <span style="color:#f00;font-style:italic">/* reserved words are never collected */</span>
</span></span><span style="display:flex;"><span>    lua_assert(strlen(luaX_tokens[i])+1 &lt;= TOKEN_LEN);
</span></span><span style="display:flex;"><span>    ts-&gt;tsv.reserved = cast_byte(i+1);  <span style="color:#f00;font-style:italic">/* reserved word */</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#define MAXSRC          80
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">const</span> <span style="color:#00f">char</span> *<span style="color:#c34e00">luaX_token2str</span> (LexState *ls, <span style="color:#00f">int</span> token) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (token &lt; FIRST_RESERVED) {
</span></span><span style="display:flex;"><span>    lua_assert(token == cast(<span style="color:#00f">unsigned</span> <span style="color:#00f">char</span>, token));
</span></span><span style="display:flex;"><span>    <span style="color:#00f">return</span> (iscntrl(token)) ? luaO_pushfstring(ls-&gt;L, <span style="color:#009c00">&#34;char(%d)&#34;</span>, token) :
</span></span><span style="display:flex;"><span>                              luaO_pushfstring(ls-&gt;L, <span style="color:#009c00">&#34;%c&#34;</span>, token);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#00f">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">return</span> luaX_tokens[token-FIRST_RESERVED];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">const</span> <span style="color:#00f">char</span> *<span style="color:#c34e00">txtToken</span> (LexState *ls, <span style="color:#00f">int</span> token) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">switch</span> (token) {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">case</span> TK_NAME:
</span></span><span style="display:flex;"><span>    <span style="color:#00f">case</span> TK_STRING:
</span></span><span style="display:flex;"><span>    <span style="color:#00f">case</span> TK_NUMBER:
</span></span><span style="display:flex;"><span>      save(ls, <span style="color:#009c00">&#39;\0&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#00f">return</span> luaZ_buffer(ls-&gt;buff);
</span></span><span style="display:flex;"><span>    <span style="color:#00f">default</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#00f">return</span> luaX_token2str(ls, token);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">void</span> <span style="color:#c34e00">luaX_lexerror</span> (LexState *ls, <span style="color:#00f">const</span> <span style="color:#00f">char</span> *msg, <span style="color:#00f">int</span> token) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">char</span> buff[MAXSRC];
</span></span><span style="display:flex;"><span>  luaO_chunkid(buff, getstr(ls-&gt;source), MAXSRC);
</span></span><span style="display:flex;"><span>  msg = luaO_pushfstring(ls-&gt;L, <span style="color:#009c00">&#34;%s:%d: %s&#34;</span>, buff, ls-&gt;linenumber, msg);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (token)
</span></span><span style="display:flex;"><span>    luaO_pushfstring(ls-&gt;L, <span style="color:#009c00">&#34;%s near &#34;</span> LUA_QS, msg, txtToken(ls, token));
</span></span><span style="display:flex;"><span>  luaD_throw(ls-&gt;L, LUA_ERRSYNTAX);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">void</span> <span style="color:#c34e00">luaX_syntaxerror</span> (LexState *ls, <span style="color:#00f">const</span> <span style="color:#00f">char</span> *msg) {
</span></span><span style="display:flex;"><span>  luaX_lexerror(ls, msg, ls-&gt;t.token);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TString *<span style="color:#c34e00">luaX_newstring</span> (LexState *ls, <span style="color:#00f">const</span> <span style="color:#00f">char</span> *str, size_t l) {
</span></span><span style="display:flex;"><span>  lua_State *L = ls-&gt;L;
</span></span><span style="display:flex;"><span>  TString *ts = luaS_newlstr(L, str, l);
</span></span><span style="display:flex;"><span>  TValue *o = luaH_setstr(L, ls-&gt;fs-&gt;h, ts);  <span style="color:#f00;font-style:italic">/* entry for `str&#39; */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (ttisnil(o)) {
</span></span><span style="display:flex;"><span>    setbvalue(o, 1);  <span style="color:#f00;font-style:italic">/* make sure `str&#39; will not be collected */</span>
</span></span><span style="display:flex;"><span>    luaC_checkGC(L);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#00f">return</span> ts;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 读到单个换行符\n，\r，再多读一个字符，看是否是双字符的换行\n\r,\r\n */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">inclinenumber</span> (LexState *ls) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">int</span> old = ls-&gt;current;
</span></span><span style="display:flex;"><span>  lua_assert(currIsNewline(ls));	<span style="color:#f00;font-style:italic">/* 当前是换行符 */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 往后再读一个字符，看看不是不是\n\r和\r\n这种双字符的换行符（仅算一次换行） */</span>
</span></span><span style="display:flex;"><span>  next(ls);  <span style="color:#f00;font-style:italic">/* skip `\n&#39; or `\r&#39; */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (currIsNewline(ls) &amp;&amp; ls-&gt;current != old)
</span></span><span style="display:flex;"><span>    next(ls);  <span style="color:#f00;font-style:italic">/* skip `\n\r&#39; or `\r\n&#39; */</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (++ls-&gt;linenumber &gt;= MAX_INT)
</span></span><span style="display:flex;"><span>    luaX_syntaxerror(ls, <span style="color:#009c00">&#34;chunk has too many lines&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 初始化LexState，初始化ls-&gt;buf,从ZIO读取第一个字符 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">void</span> <span style="color:#c34e00">luaX_setinput</span> (lua_State *L, LexState *ls, ZIO *z, TString *source) {
</span></span><span style="display:flex;"><span>  ls-&gt;decpoint = <span style="color:#009c00">&#39;.&#39;</span>;
</span></span><span style="display:flex;"><span>  ls-&gt;L = L;
</span></span><span style="display:flex;"><span>  ls-&gt;lookahead.token = TK_EOS;  <span style="color:#f00;font-style:italic">/* no look-ahead token */</span>
</span></span><span style="display:flex;"><span>  ls-&gt;z = z;
</span></span><span style="display:flex;"><span>  ls-&gt;fs = NULL;	<span style="color:#f00;font-style:italic">/* 尚未开始编译函数，这里置NULL */</span>
</span></span><span style="display:flex;"><span>  ls-&gt;linenumber = 1;	<span style="color:#f00;font-style:italic">/* 当前在第一行，亲 */</span>
</span></span><span style="display:flex;"><span>  ls-&gt;lastline = 1;
</span></span><span style="display:flex;"><span>  ls-&gt;source = source;
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 申请属于ls-&gt;buff的私有buff */</span>
</span></span><span style="display:flex;"><span>  luaZ_resizebuffer(ls-&gt;L, ls-&gt;buff, LUA_MINBUFFER);  <span style="color:#f00;font-style:italic">/* initialize buffer */</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  next(ls);  <span style="color:#f00;font-style:italic">/* read first char */</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** =======================================================
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** LEXICAL ANALYZER
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** =======================================================
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* ls-&gt;current和set字符集中的某个字符匹配吗 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">int</span> <span style="color:#c34e00">check_next</span> (LexState *ls, <span style="color:#00f">const</span> <span style="color:#00f">char</span> *set) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (!strchr(set, ls-&gt;current))	
</span></span><span style="display:flex;"><span>    <span style="color:#00f">return</span> 0;
</span></span><span style="display:flex;"><span>  save_and_next(ls);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">return</span> 1;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 将ls-&gt;buff中的from字符替换层to字符 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">buffreplace</span> (LexState *ls, <span style="color:#00f">char</span> from, <span style="color:#00f">char</span> to) {
</span></span><span style="display:flex;"><span>  size_t n = luaZ_bufflen(ls-&gt;buff);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">char</span> *p = luaZ_buffer(ls-&gt;buff);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">while</span> (n--)
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> (p[n] == from) p[n] = to;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 数字字符串转换为数字时失败，尝试更换成本地区的数字字符小数点后再次尝试转换 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">trydecpoint</span> (LexState *ls, SemInfo *seminfo) {
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* format error: try to update decimal point separator */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">struct</span> lconv *cv = localeconv();
</span></span><span style="display:flex;"><span>  <span style="color:#00f">char</span> old = ls-&gt;decpoint;
</span></span><span style="display:flex;"><span>  ls-&gt;decpoint = (cv ? cv-&gt;decimal_point[0] : <span style="color:#009c00">&#39;.&#39;</span>);
</span></span><span style="display:flex;"><span>  buffreplace(ls, old, ls-&gt;decpoint);  <span style="color:#f00;font-style:italic">/* try updated decimal separator */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (!luaO_str2d(luaZ_buffer(ls-&gt;buff), &amp;seminfo-&gt;r)) {
</span></span><span style="display:flex;"><span>    <span style="color:#f00;font-style:italic">/* format error with correct decimal point: no more options */</span>
</span></span><span style="display:flex;"><span>    buffreplace(ls, ls-&gt;decpoint, <span style="color:#009c00">&#39;.&#39;</span>);  <span style="color:#f00;font-style:italic">/* undo change (for error message) */</span>
</span></span><span style="display:flex;"><span>    luaX_lexerror(ls, <span style="color:#009c00">&#34;malformed number&#34;</span>, TK_NUMBER);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* LUA_NUMBER 
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** .123这种  123或者科学计数法形式(1.99714E+13)的数字
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">read_numeral</span> (LexState *ls, SemInfo *seminfo) {
</span></span><span style="display:flex;"><span>  lua_assert(isdigit(ls-&gt;current));	<span style="color:#f00;font-style:italic">/* 属于 [0,9] 集合？*/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 读取第一部分 1.99714 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">do</span> {
</span></span><span style="display:flex;"><span>    save_and_next(ls);
</span></span><span style="display:flex;"><span>  } <span style="color:#00f">while</span> (isdigit(ls-&gt;current) || ls-&gt;current == <span style="color:#009c00">&#39;.&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 读取第二部分 E+ */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (check_next(ls, <span style="color:#009c00">&#34;Ee&#34;</span>))  <span style="color:#f00;font-style:italic">/* `E&#39;? */</span>
</span></span><span style="display:flex;"><span>    check_next(ls, <span style="color:#009c00">&#34;+-&#34;</span>);  <span style="color:#f00;font-style:italic">/* optional exponent sign */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 读取第三部分 13 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">while</span> (isalnum(ls-&gt;current) || ls-&gt;current == <span style="color:#009c00">&#39;_&#39;</span>)	<span style="color:#f00;font-style:italic">/* 这里的_不太明白其含义 */</span>
</span></span><span style="display:flex;"><span>    save_and_next(ls);
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 主动补\0,关闭字符串 */</span>
</span></span><span style="display:flex;"><span>  save(ls, <span style="color:#009c00">&#39;\0&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 不同国家不同的小数点 */</span>
</span></span><span style="display:flex;"><span>  buffreplace(ls, <span style="color:#009c00">&#39;.&#39;</span>, ls-&gt;decpoint);  <span style="color:#f00;font-style:italic">/* follow locale for decimal point */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (!luaO_str2d(luaZ_buffer(ls-&gt;buff), &amp;seminfo-&gt;r))  <span style="color:#f00;font-style:italic">/* format error? */</span>
</span></span><span style="display:flex;"><span>    trydecpoint(ls, seminfo); <span style="color:#f00;font-style:italic">/* try to update decimal point separator */</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 尝试读取多行字符串的开头或结尾 --[{=}[ 或者 ]{=}] */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">int</span> <span style="color:#c34e00">skip_sep</span> (LexState *ls) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">int</span> count = 0;
</span></span><span style="display:flex;"><span>  <span style="color:#00f">int</span> s = ls-&gt;current;
</span></span><span style="display:flex;"><span>  lua_assert(s == <span style="color:#009c00">&#39;[&#39;</span> || s == <span style="color:#009c00">&#39;]&#39;</span>);
</span></span><span style="display:flex;"><span>  save_and_next(ls);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">while</span> (ls-&gt;current == <span style="color:#009c00">&#39;=&#39;</span>) {
</span></span><span style="display:flex;"><span>    save_and_next(ls);
</span></span><span style="display:flex;"><span>    count++;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#00f">return</span> (ls-&gt;current == s) ? count : (-count) - 1;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 读取一个长字符串和&#34;结尾控制符&#34;(长注释或String的token)(同时更新linenumber) */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">read_long_string</span> (LexState *ls, SemInfo *seminfo, <span style="color:#00f">int</span> sep) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">int</span> cont = 0;
</span></span><span style="display:flex;"><span>  (<span style="color:#00f">void</span>)(cont);  <span style="color:#f00;font-style:italic">/* avoid warnings when `cont&#39; is not used */</span>
</span></span><span style="display:flex;"><span>  save_and_next(ls);  		<span style="color:#f00;font-style:italic">/* skip 2nd `[&#39; */</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (currIsNewline(ls))  	<span style="color:#f00;font-style:italic">/* string starts with a newline? */</span>
</span></span><span style="display:flex;"><span>    inclinenumber(ls);  <span style="color:#f00;font-style:italic">/* skip it */</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#00f">for</span> (;;) {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">switch</span> (ls-&gt;current) {
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> EOZ:
</span></span><span style="display:flex;"><span>        luaX_lexerror(ls, (seminfo) ? <span style="color:#009c00">&#34;unfinished long string&#34;</span> :
</span></span><span style="display:flex;"><span>                                   <span style="color:#009c00">&#34;unfinished long comment&#34;</span>, TK_EOS);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">break</span>;  <span style="color:#f00;font-style:italic">/* to avoid warnings */</span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#if defined(LUA_COMPAT_LSTR)
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;[&#39;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (skip_sep(ls) == sep) {
</span></span><span style="display:flex;"><span>          save_and_next(ls);  <span style="color:#f00;font-style:italic">/* skip 2nd `[&#39; */</span>
</span></span><span style="display:flex;"><span>          cont++;
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#if LUA_COMPAT_LSTR == 1
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>          <span style="color:#00f">if</span> (sep == 0)
</span></span><span style="display:flex;"><span>            luaX_lexerror(ls, <span style="color:#009c00">&#34;nesting of [[...]] is deprecated&#34;</span>, <span style="color:#009c00">&#39;[&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;]&#39;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (skip_sep(ls) == sep) {
</span></span><span style="display:flex;"><span>          save_and_next(ls);  <span style="color:#f00;font-style:italic">/* skip 2nd `]&#39; */</span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#if defined(LUA_COMPAT_LSTR) &amp;&amp; LUA_COMPAT_LSTR == 2
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>          cont--;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">if</span> (sep == 0 &amp;&amp; cont &gt;= 0) <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic"></span>          <span style="color:#00f">goto</span> endloop;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\n&#39;</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\r&#39;</span>: {
</span></span><span style="display:flex;"><span>        save(ls, <span style="color:#009c00">&#39;\n&#39;</span>);	
</span></span><span style="display:flex;"><span>        inclinenumber(ls);	<span style="color:#f00;font-style:italic">/* 注释的业务中也不能忘了linenumber */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (!seminfo) luaZ_resetbuffer(ls-&gt;buff);  <span style="color:#f00;font-style:italic">/* avoid wasting space */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">default</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (seminfo) save_and_next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> next(ls);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  } endloop:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* seminfo为null是注释逻辑，注释不用管里面的具体String，否则是一个正常的String的token，需将String保存 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (seminfo) {
</span></span><span style="display:flex;"><span>  	<span style="color:#f00;font-style:italic">/* 2+sep:[{=}[ */</span>
</span></span><span style="display:flex;"><span>    seminfo-&gt;ts = luaX_newstring(ls, luaZ_buffer(ls-&gt;buff) + (2 + sep),	
</span></span><span style="display:flex;"><span>                                     luaZ_bufflen(ls-&gt;buff) - 2*(2 + sep));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 读一个&#34;字符串&#34;或&#39;字符串&#39;格式的字符串 */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">void</span> <span style="color:#c34e00">read_string</span> (LexState *ls, <span style="color:#00f">int</span> del, SemInfo *seminfo) {
</span></span><span style="display:flex;"><span>  save_and_next(ls);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">while</span> (ls-&gt;current != del) {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">switch</span> (ls-&gt;current) {
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> EOZ:
</span></span><span style="display:flex;"><span>        luaX_lexerror(ls, <span style="color:#009c00">&#34;unfinished string&#34;</span>, TK_EOS);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">continue</span>;  <span style="color:#f00;font-style:italic">/* to avoid warnings */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\n&#39;</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\r&#39;</span>:
</span></span><span style="display:flex;"><span>        luaX_lexerror(ls, <span style="color:#009c00">&#34;unfinished string&#34;</span>, TK_STRING);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">continue</span>;  <span style="color:#f00;font-style:italic">/* to avoid warnings */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\\&#39;</span>: {	<span style="color:#f00;font-style:italic">/* 可能的转移序列 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">int</span> c;
</span></span><span style="display:flex;"><span>        next(ls);  <span style="color:#f00;font-style:italic">/* do not save the `\&#39; */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">switch</span> (ls-&gt;current) {
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;a&#39;</span>: c = <span style="color:#009c00">&#39;\a&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;b&#39;</span>: c = <span style="color:#009c00">&#39;\b&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;f&#39;</span>: c = <span style="color:#009c00">&#39;\f&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;n&#39;</span>: c = <span style="color:#009c00">&#39;\n&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;r&#39;</span>: c = <span style="color:#009c00">&#39;\r&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;t&#39;</span>: c = <span style="color:#009c00">&#39;\t&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;v&#39;</span>: c = <span style="color:#009c00">&#39;\v&#39;</span>; <span style="color:#00f">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		  <span style="color:#f00;font-style:italic">/* 本身就是一个换行符 */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\n&#39;</span>:  <span style="color:#f00;font-style:italic">/* go through */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\r&#39;</span>: save(ls, <span style="color:#009c00">&#39;\n&#39;</span>); inclinenumber(ls); <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>		  
</span></span><span style="display:flex;"><span>          <span style="color:#00f">case</span> EOZ: <span style="color:#00f">continue</span>;  <span style="color:#f00;font-style:italic">/* will raise an error next loop */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#00f">default</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#00f">if</span> (!isdigit(ls-&gt;current))
</span></span><span style="display:flex;"><span>              save_and_next(ls);  <span style="color:#f00;font-style:italic">/* handles \\, \&#34;, \&#39;, and \? */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00f">else</span> {  <span style="color:#f00;font-style:italic">/* \xxx */</span>
</span></span><span style="display:flex;"><span>              <span style="color:#00f">int</span> i = 0;
</span></span><span style="display:flex;"><span>              c = 0;
</span></span><span style="display:flex;"><span>              <span style="color:#00f">do</span> {
</span></span><span style="display:flex;"><span>                c = 10*c + (ls-&gt;current-<span style="color:#009c00">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>                next(ls);
</span></span><span style="display:flex;"><span>              } <span style="color:#00f">while</span> (++i&lt;3 &amp;&amp; isdigit(ls-&gt;current));
</span></span><span style="display:flex;"><span>              <span style="color:#00f">if</span> (c &gt; UCHAR_MAX)
</span></span><span style="display:flex;"><span>                luaX_lexerror(ls, <span style="color:#009c00">&#34;escape sequence too large&#34;</span>, TK_STRING);
</span></span><span style="display:flex;"><span>              save(ls, c);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        save(ls, c);
</span></span><span style="display:flex;"><span>        next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">default</span>:
</span></span><span style="display:flex;"><span>        save_and_next(ls);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  save_and_next(ls);  <span style="color:#f00;font-style:italic">/* skip delimiter(分隔符) */</span>
</span></span><span style="display:flex;"><span>  seminfo-&gt;ts = luaX_newstring(ls, luaZ_buffer(ls-&gt;buff) + 1,
</span></span><span style="display:flex;"><span>                                   luaZ_bufflen(ls-&gt;buff) - 2);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 从读取下一个字符token 
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">** 从ZIO读取下一个token到seminfo,并返回TokenType(中途可能用到lx-&gt;buff)
</span></span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">static</span> <span style="color:#00f">int</span> <span style="color:#c34e00">llex</span> (LexState *ls, SemInfo *seminfo) {
</span></span><span style="display:flex;"><span>  luaZ_resetbuffer(ls-&gt;buff);
</span></span><span style="display:flex;"><span>  <span style="color:#00f">for</span> (;;) {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">switch</span> (ls-&gt;current) {
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\n&#39;</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\r&#39;</span>: {
</span></span><span style="display:flex;"><span>        inclinenumber(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;-&#39;</span>: {
</span></span><span style="display:flex;"><span>        next(ls);
</span></span><span style="display:flex;"><span>		<span style="color:#f00;font-style:italic">/* 单独的 - */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (ls-&gt;current != <span style="color:#009c00">&#39;-&#39;</span>) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;-&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f00;font-style:italic">/* else is a comment */</span>
</span></span><span style="display:flex;"><span>        next(ls);	<span style="color:#f00;font-style:italic">/* 单行OR多行注释? */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (ls-&gt;current == <span style="color:#009c00">&#39;[&#39;</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#00f">int</span> sep = skip_sep(ls);
</span></span><span style="display:flex;"><span>          luaZ_resetbuffer(ls-&gt;buff);  <span style="color:#f00;font-style:italic">/* `skip_sep&#39; may dirty the buffer */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#00f">if</span> (sep &gt;= 0) {
</span></span><span style="display:flex;"><span>            read_long_string(ls, NULL, sep);  <span style="color:#f00;font-style:italic">/* long comment */</span>
</span></span><span style="display:flex;"><span>            luaZ_resetbuffer(ls-&gt;buff);
</span></span><span style="display:flex;"><span>            <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#f00;font-style:italic">/* else short comment */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">while</span> (!currIsNewline(ls) &amp;&amp; ls-&gt;current != EOZ)
</span></span><span style="display:flex;"><span>          next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;[&#39;</span>: {	<span style="color:#f00;font-style:italic">/* 长字符串: [{=}[ String ]{=}] */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">int</span> sep = skip_sep(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (sep &gt;= 0) {	<span style="color:#f00;font-style:italic">/* 多行字符串开头 [{=}[ */</span>
</span></span><span style="display:flex;"><span>          read_long_string(ls, seminfo, sep);
</span></span><span style="display:flex;"><span>          <span style="color:#00f">return</span> TK_STRING;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> <span style="color:#00f">if</span> (sep == -1) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;[&#39;</span>;	<span style="color:#f00;font-style:italic">/* [,others这样的开头 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> luaX_lexerror(ls, <span style="color:#009c00">&#34;invalid long string delimiter&#34;</span>, TK_STRING);		<span style="color:#f00;font-style:italic">/* [={=},others这样的开头 */</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;=&#39;</span>: {
</span></span><span style="display:flex;"><span>        next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (ls-&gt;current != <span style="color:#009c00">&#39;=&#39;</span>) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;=&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> { next(ls); <span style="color:#00f">return</span> TK_EQ; }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;&lt;&#39;</span>: {
</span></span><span style="display:flex;"><span>        next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (ls-&gt;current != <span style="color:#009c00">&#39;=&#39;</span>) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;&lt;&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> { next(ls); <span style="color:#00f">return</span> TK_LE; }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;&gt;&#39;</span>: {
</span></span><span style="display:flex;"><span>        next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (ls-&gt;current != <span style="color:#009c00">&#39;=&#39;</span>) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;&gt;&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> { next(ls); <span style="color:#00f">return</span> TK_GE; }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;~&#39;</span>: {
</span></span><span style="display:flex;"><span>        next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (ls-&gt;current != <span style="color:#009c00">&#39;=&#39;</span>) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;~&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> { next(ls); <span style="color:#00f">return</span> TK_NE; }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>	  <span style="color:#f00;font-style:italic">/* 短字符串 */</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#00f">case</span> <span style="color:#009c00">&#39;&#34;&#39;</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;\&#39;&#39;</span>: {
</span></span><span style="display:flex;"><span>        read_string(ls, ls-&gt;current, seminfo);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">return</span> TK_STRING;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>	  <span style="color:#f00;font-style:italic">/* 看这个符号的解析，是一个深度优先的解析示例 */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> <span style="color:#009c00">&#39;.&#39;</span>: {
</span></span><span style="display:flex;"><span>        save_and_next(ls);
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (check_next(ls, <span style="color:#009c00">&#34;.&#34;</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#00f">if</span> (check_next(ls, <span style="color:#009c00">&#34;.&#34;</span>))
</span></span><span style="display:flex;"><span>            <span style="color:#00f">return</span> TK_DOTS;   <span style="color:#f00;font-style:italic">/* ... */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#00f">else</span> <span style="color:#00f">return</span> TK_CONCAT;   <span style="color:#f00;font-style:italic">/* .. */</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> <span style="color:#00f">if</span> (!isdigit(ls-&gt;current)) <span style="color:#00f">return</span> <span style="color:#009c00">&#39;.&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> {
</span></span><span style="display:flex;"><span>          read_numeral(ls, seminfo);
</span></span><span style="display:flex;"><span>          <span style="color:#00f">return</span> TK_NUMBER;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">case</span> EOZ: {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">return</span> TK_EOS;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#00f">default</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (isspace(ls-&gt;current)) {
</span></span><span style="display:flex;"><span>          lua_assert(!currIsNewline(ls));	<span style="color:#f00;font-style:italic">/* 换行符在前面就被解析掉了，这里不能再是换行符了,否则就重复了 */</span>
</span></span><span style="display:flex;"><span>          next(ls);
</span></span><span style="display:flex;"><span>          <span style="color:#00f">continue</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> <span style="color:#00f">if</span> (isdigit(ls-&gt;current)) {
</span></span><span style="display:flex;"><span>          read_numeral(ls, seminfo);
</span></span><span style="display:flex;"><span>          <span style="color:#00f">return</span> TK_NUMBER;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> <span style="color:#00f">if</span> (isalpha(ls-&gt;current) || ls-&gt;current == <span style="color:#009c00">&#39;_&#39;</span>) {	<span style="color:#f00;font-style:italic">/* 标识符 */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f00;font-style:italic">/* identifier or reserved word */</span>
</span></span><span style="display:flex;"><span>          TString *ts;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">do</span> {
</span></span><span style="display:flex;"><span>            save_and_next(ls);
</span></span><span style="display:flex;"><span>          } <span style="color:#00f">while</span> (isalnum(ls-&gt;current) || ls-&gt;current == <span style="color:#009c00">&#39;_&#39;</span>);	<span style="color:#f00;font-style:italic">/* 这里和上面的有一点差别 */</span>
</span></span><span style="display:flex;"><span>		  
</span></span><span style="display:flex;"><span>          ts = luaX_newstring(ls, luaZ_buffer(ls-&gt;buff),
</span></span><span style="display:flex;"><span>                                  luaZ_bufflen(ls-&gt;buff));
</span></span><span style="display:flex;"><span>		  <span style="color:#f00;font-style:italic">/* 关键或保留字符串 */</span>
</span></span><span style="display:flex;"><span>          <span style="color:#00f">if</span> (ts-&gt;tsv.reserved &gt; 0)  <span style="color:#f00;font-style:italic">/* reserved word? */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00f">return</span> ts-&gt;tsv.reserved - 1 + FIRST_RESERVED;
</span></span><span style="display:flex;"><span>          <span style="color:#00f">else</span> {
</span></span><span style="display:flex;"><span>            seminfo-&gt;ts = ts;
</span></span><span style="display:flex;"><span>            <span style="color:#00f">return</span> TK_NAME;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#00f">int</span> c = ls-&gt;current;
</span></span><span style="display:flex;"><span>          next(ls);
</span></span><span style="display:flex;"><span>          <span style="color:#00f">return</span> c;  <span style="color:#f00;font-style:italic">/* single-char tokens (+ - / ...) */</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">void</span> <span style="color:#c34e00">luaX_next</span> (LexState *ls) {
</span></span><span style="display:flex;"><span>  ls-&gt;lastline = ls-&gt;linenumber
</span></span><span style="display:flex;"><span>  <span style="color:#f00;font-style:italic">/* 已有一个准备好的lookhead&#39;token,则取出来用 */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">if</span> (ls-&gt;lookahead.token != TK_EOS) {  <span style="color:#f00;font-style:italic">/* is there a look-ahead token? */</span>
</span></span><span style="display:flex;"><span>    ls-&gt;t = ls-&gt;lookahead;  <span style="color:#f00;font-style:italic">/* use this one */</span>
</span></span><span style="display:flex;"><span>    ls-&gt;lookahead.token = TK_EOS;  <span style="color:#f00;font-style:italic">/* and discharge it */</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#00f">else</span> <span style="color:#f00;font-style:italic">/* 读取一个token */</span>
</span></span><span style="display:flex;"><span>    ls-&gt;t.token = llex(ls, &amp;ls-&gt;t.seminfo);  <span style="color:#f00;font-style:italic">/* read next token */</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00;font-style:italic">/* 当前lookhead&#39;token已过期，重新准备lookhead&#39;token */</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">void</span> <span style="color:#c34e00">luaX_lookahead</span> (LexState *ls) {
</span></span><span style="display:flex;"><span>  lua_assert(ls-&gt;lookahead.token == TK_EOS);
</span></span><span style="display:flex;"><span>  ls-&gt;lookahead.token = llex(ls, &amp;ls-&gt;lookahead.seminfo);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://shanks.link/tags/lua" rel="tag" title="lua">#lua#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://shanks.link/blog/2021/06/02/samba-445-%E8%A2%AB%E5%B0%81-%E5%85%AC%E7%BD%91%E8%AE%BF%E9%97%AE/" rel="next" title="samba 445 被封 公网访问">
        <i class="fa fa-chevron-left"></i> samba 445 被封 公网访问
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://shanks.link/blog/2021/05/28/lua%E6%BA%90%E7%A0%81%E6%B3%A8%E9%87%8A-ldo.c/" rel="prev" title="lua源码注释-ldo.c">
        lua源码注释-ldo.c <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     





<script src="https://utteranc.es/client.js"
        repo="shankusu2017@gmail.com/"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://shanks.link/img/logo.jpg"
        alt="shankusu2017@gmail.com" />
    <p class="site-author-name" itemprop="name">shankusu2017@gmail.com</p>
    <p class="site-description motion-element" itemprop="description"> </p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://shanks.link/post/">
        <span class="site-state-item-count">512</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://shanks.link/categories/">      
         
        <span class="site-state-item-count">32</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://shanks.link/tags/">
         
        <span class="site-state-item-count">37</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/shankusu2017" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2022</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">愿星光伴你左右</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo v0.101.0</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://shanks.link/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://shanks.link/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://shanks.link/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://shanks.link/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://shanks.link/js/utils.js"></script>
<script type="text/javascript" src="http://shanks.link/js/motion.js"></script>
<script type="text/javascript" src="http://shanks.link/js/affix.js"></script>
<script type="text/javascript" src="http://shanks.link/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://shanks.link/js/scrollspy.js"></script>
<script type="text/javascript" src="http://shanks.link/js/post-details.js"></script>
<script type="text/javascript" src="http://shanks.link/js/toc.js"></script>

<script type="text/javascript" src="http://shanks.link/js/bootstrap.js"></script>

<script type="text/javascript" src="http://shanks.link/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>